= Configuring System Secrets
:description: By means of the REST API, Secrets-Management can be configured, and the current configuration can be retrieved.

[abstract]
{description}

[#http-methods-and-uris]
== HTTP Method and URI

----
GET /nodes/self/secretsManagement

POST /node/controller/secretsManagement
----

[#description]
== Description
Configures the _encryption service_; which comprises the master password, encryption keys, key storage, and the identification of key-control scripts.

The *Full Admin* role is required.

== Curl Syntax

----
curl -X GET http://<ip-address-or-hostname>:8091/nodes/self/secretsManagement
  -u <username>:<password>

curl -X POST http://<ip-address-or-hostname>:8091/node/controller/secretsManagement
  -u <username>:<password>
  -d "$(cat)" | jq <payload>
----

The `payload` must be a JSON document of the following form:

----
{
  "encryptionService": {
    [<option>: <value>]*
  }
}
----

Each `option` is described below.

* `keyEncrypted`.
Whether encryption keys should be encrypted by means of the master password.
The value can be either `true` (the default) or `false`.

* `keyPath`.
Specifies whether the encryption keys are stored at the default or at a custom location.
The value can be  either `auto` (which is the default) or `custom`.
If the value is `auto`, the default location is used.
If the value is `custom`, the path provided by `customKeyPath` is used.
Note that this option is used only if `keyStorageType` has the value `file`.

* `customKeyPath`.
A file-path that specifies a custom location at which the encryption keys are stored.
This file-path is used only if the value of `keyPath` is `custom`.

* `keyStorageType`.
The value can be `file` (which is the default) or `script`.
If the value is `file`, the system stores the encryption keys in a file.
If the value is `script`, a user-specified script is called, when keys are to be written, read, or deleted.
These scripts must be specified by `writeCmd`, `readCmd`, and `deleteCmd`, respectively.

* `passwordSource`.
The value can be `env` (which is the default) or `script`.
If the value is `env`, the master password is read from the environment variable specified by `passwordEnv`.
If the value is `script`, the master password is provided by the script specified by `passwordCmd`.

* `passwordEnv`.
The name of the environment variable from which the master password is read (provided that the value of `passwordSource` is `env`).
By default, the value of `passwordEnv` is `CB_MASTER_PASSWORD`.

* `passwordCmd`.
The script to be executed for provision of the master password.
This script is only executed when the value of `passwordSource` is `script`.

* `passwordState`.
Shows the state of the encryption-service master password and encryption keys.
The value can be:

** `default`.
The encryption password is not set.

** `user_configured`.
The master password is set

** `password_not_used`.
The encryption keys are not encrypted.

+
This is a read-only setting, and so cannot be used with the `POST` method.

* `readCmd`.
The script to be executed for the reading of encryption keys (when the value of `keyStorageType` is `script`).

* `writeCmd`.
The script to be executed for the writing of encryption keys (when the value of `keyStorageType` is `script`).

* `deleteCmd`.
The script to be executed for the deletion of encryption keys (when the value of `keyStorageType` is `script`).
