= Setting a Target-Cluster Reference
:description: pass:q[The REST API can be used to create an XDCR reference to a destination cluster.]
:page-topic-type: reference

[abstract]
{description}

== Description

On the cluster that is intended to be a _source_ for XDCR, a _reference_ to an intended _target_ cluster must first be defined.
The target cluster is typically a different cluster from the source cluster; but they may be the same cluster.

A source cluster's references can be defined by means of the REST API.

== HTTP method and URI

----
POST /pools/default/remoteClusters

POST /pools/default/remoteClusters/<target-cluster-local-name>
----

== Curl Syntax

----
curl -v -u <source-cluster-username>:<source-cluster-password>
  http://<source-cluster-ip-address-or-domain-name>]:8091/pools/default/remoteClusters/[<target-cluster-local-name>]
  -d name=<target-cluster-local-name>
  -d hostname=<target-cluster-ip-address-or-domain-name][:<port-number>]
  -d network_type='external'
  -d username=<target-cluster-username>
  -d password=<target-cluster-password>
  -d demandEncryption=[ 0 | 1 ]
  -d secureType=[ 'half' | 'full'] --data-urlencode "certificate=$(cat <local-pathname-to-target-root-certificate>)"
----

The value of `name`, `target-cluster-local-name`, is for local reference only, and so need not correspond to any network-visible name established for the target cluster.
If an existing reference is being edited, the value of `name` should be specified as a path parameter that terminates the endpoint.

The value of the `target-cluster-ip-address-or-domain-name` parameter determines the target cluster to which the connection will be made.
This value can specify either the _internal_ or (if one has been configured) the _external_ address of the target cluster.
For information on using DNS SRV in this context, see xref:xdcr-reference:xdcr-security-and-networking.adoc[XDCR Security and Networking].

The value of the optional `network_type` parameter must be `external`.
If this is specified, and an external network has been configured for the target cluster, use of the target cluster's external address is enforced, irrespective of values established for `target-cluster-ip-address-or-domain-name` or any other parameter.
If no external network has been configured, and the hostname consists of a valid internal address for the cluster, the internal address is used.

The values specified for the `username` and `password` parameters must be the username and password for the _target_ cluster, respectively.

If `1`, the value of the `demandEncryption` parameter enforces a fully encrypted connection; overriding other settings.
The default value is `0`.

The `secureType` parameter can be `none` (which is the default), `half`, or `full`; and thus specifies the type of security to be used for the connection.
If `demandEncryption` is specified with a value of `1`, `secureType` does not need to be specified, and is enforced as `full`.
For information, see xref:manage:manage-security/secure-xdcr-replication.adoc[Secure a Replication].

== Responses

== Example

Credentials are provided for the source cluster and information, including credentials and UUID for the destination cluster.

Curl request example:

----
curl -v -u Administrator:password1 \
  http://10.4.2.4:8091/pools/default/remoteClusters \
  -d 'uuid=9eee38236f3bf28406920213d93981a3' \
  -d 'name=remote1' \
  -d 'hostname=10.4.2.6:8091' \
  -d 'username=admin' \
  -d 'password=password2'
----

Raw HTTP request example:

----
POST /pools/default/remoteClusters HTTP/1.1
Authorization: Basic QWRtaW5pc3RyYXRvcjpwYXNzd29yZA==
User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4 \
     OpenSSL/0.9.8r zlib/1.2.5
Host: 10.4.2.4:8091
Accept: */*
Content-Length: 114
Content-Type: application/x-www-form-urlencoded
----

== Response

If successful, Couchbase Server responds with a JSON response similar to the following:

----
{"name":"remote1","uri":"/pools/default/remoteClusters/remote1",
"validateURI":"/pools/default/remoteClusters/remote1?just_validate=1",
"hostname":"10.4.2.6:8091",
"username":"Administrator",
"uuid":"9eee38236f3bf28406920213d93981a3",
"deleted":false}
----

The following describes the response elements:

* (String) name: Name of the destination cluster referenced for XDCR.
* (String) validateURI: URI to validate details of cluster reference.
* (String) hostname: Hostname/IP (and :port) of the remote cluster.
* (String) username: Username for the destination cluster administrator.
* (String) uuid: UUID of the remote cluster reference.
* (Boolean) deleted: Indicates whether the reference to the destination cluster has been deleted or not.
