= Collections via REST

[abstract]
_Collections_ can be managed by means of the Couchbase REST API.

[#Using the REST API]
== Using the REST API

The following sequence of commands assumes that Couchbase Server has been installed, initialized, and provisioned on a _Ubuntu_ system.
Note, however, that the sequence should work identically on other Linux systems; as well as on MacOS and Windows systems.

At the command-line prompt, proceed as follows:

. Create a bucket, named `testBucket`, using the `/pools/default/buckets` REST method:
+
----
curl -X POST -u Administrator:password \
http://localhost:8091//pools/default/buckets \
-d name=testBucket \
-d bucketType=couchbase \
-d autoCompactionDefined=false \
-d evictionPolicy=valueOnly \
-d threadsNumber=3 \
-d replicaNumber=1 \
-d compressionMode=passive \
-d maxTTL=0 \
-d replicaIndex=0 \
-d conflictResolutionType=seqno \
-d ramQuotaMB=100 \
-d flushEnabled=0
----
+
For information on this REST call and its parameters, see xref:rest-api:rest-bucket-create.adoc[Creating and Editing Buckets].

. Create a scope. This is a POST operation, using the `/pools/default/buckets/_<bucket>_/collections` endpoint, and specifying the `-name` parameter.
+
----
curl -u Administrator:password -X POST \
http://localhost:8091/pools/default/buckets/testBucket/collections \
-d name=my_scope
----
+
If successful, the command returns a _uid_ for the action (this is principally for internal use, and need not be tracked by the user):
+
----
{"uid":1}
----
+
Now, examine the collections _manifest_ for the specified bucket.
This is a GET operation, using the same endpoint as the previous POST, with no parameter.
+
----
curl -u Administrator:password -X GET \
http://localhost:8091/pools/default/buckets/testBucket/collections
----
+
This returns the following output:
+
----
{"my_scope":{},"_default":{"_default":{}}}
----
+
Formatted, this output is as follows:
+
----
{
  "my_scope": {},
  "_default": {
    "_default": {}
  }
}
----
+
This output shows that the bucket now contains two scopes, which are `my_scope` and `_default`.
The `_default` scope contains a single collection, which is also named `_default`.

. Create two collections, within the created scope.
This requires a POST operation, specifying the created scope as endpoint, and using the -name parameter to specify the new collection-name.
For the first collection, enter the following command:
+
----
curl -u Administrator:password -X POST \
http://localhost:8091/pools/default/buckets/testBucket/collections/my_scope \
-d name=my_collection_in_my_scope_1
----
+
If successful, the operation returns a uid.
+
----
{"uid":2}
----
+
Create the second collection as follows:
+
----
curl -u Administrator:password -X POST \
http://localhost:8091/pools/default/buckets/testBucket/collections/my_scope \
-d name=my_collection_in_my_scope_2
----
+
Again, success returns a uid:
+
----
{"uid":3}
----
+
Now, re-examine the collections manifest for the bucket.
+
----
curl -u Administrator:password -X GET \
http://localhost:8091/pools/default/buckets/testBucket/collections
----
+
The unformatted output is as follows:
+
----
{"my_scope":{"my_collection_in_my_scope_2":{},"my_collection_in_my_scope_1":{}},"_default":{"_default":{}}}
----
+
When formatted, the output takes the following appearance:
+
----
{
  "my_scope": {
    "my_collection_in_my_scope_2": {},
    "my_collection_in_my_scope_1": {}
  },
  "_default": {
    "_default": {}
  }
}
----
+
This indicates that the collections `my_collection_in_my_scope_1` and `my_collection_in_my_scope_2` have been successfully created in `my_scope`.

. Create a collection in the default scope.
This is a POST operation, specifying the _default scope as endpoint, and the `-name` parameter to specify the new collection-name.
+
----
curl -u Administrator:password -X POST \
http://localhost:8091/pools/default/buckets/testBucket/collections/_default \
-d name=my_collection_in_default_scope
----
+
A uid is returned:
+
----
{"uid":4}
----
+
Now, re-examine the collections manifest for the bucket.
+
----
curl -u Administrator:password -X GET \
http://localhost:8091/pools/default/buckets/testBucket/collections
----
+
When formatted the output is as follows:
+
----
{
  "my_scope": {
    "my_collection_in_my_scope_2": {},
    "my_collection_in_my_scope_1": {}
  },
  "_default": {
    "my_collection_in_default_scope": {},
    "_default": {}
  }
}
----
+
This indicates that the collection my_collection_in_default_scope has been successfully created in the `_default` scope, and so appears alongside the `_default` collection.
