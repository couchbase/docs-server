= Function: Basic Binary KV
:description: pass:q[Show Basic Bucket Op Binary Write and Read.]
:page-edition: Enterprise Edition
:tabs:

*Goal*: {description}

* This function *basicBinaryKV* demonstrates creating, marshalling and unmarshalling binary docs.
* Requires a metadata bucket, a source bucket, and a destination bucket aliased to "dst_bkt" in mode read+write.
* Will operate on any mutation where the KEY or meta.id starts with "basicbinarykv".
* The function will create one binary document and write it then read it back.
* The document written will be read back and verified demonstrating binary marshalling and unmarshalling.

[{tabs}] 
====
basicBinaryKV::
+
--
[source,javascript]
----
function OnUpdate(doc, meta) {
    if (!meta.id.startsWith("basicbinarykv")) return;
    
        var arr = new Uint8Array([1, 0, 2, 3]);
        var bindoc = arr.buffer;
            
        // Write via a Basic Bucket Op, i.e. JavaScript map exposed via a bucket binding
        dst_bkt["bindoc_kvput"] = bindoc;
        
        log ("1. wrote bindoc",bindoc,"unmarshalled ("+new Uint8Array(bindoc)+")");
        
        // Read via a Basic Bucket Op, i.e. JavaScript map exposed via a bucket binding
        var retdoc = dst_bkt["bindoc_kvput"];
        
        log ("2. read retdoc",retdoc)
        log ("3. test bindoc("+
            new Uint8Array(bindoc)+") == retdoc("+
            new Uint8Array(retdoc)+") => " + buffersEqual(bindoc,retdoc));
}

function buffersEqual(buf1, buf2) {
    if (buf1.byteLength != buf2.byteLength) return false;
    var dv1 = new Uint8Array(buf1);
    var dv2 = new Uint8Array(buf2);
    for (var i = 0; i != buf1.byteLength; i++) {
        if (dv1[i] != dv2[i]) return false;
    }
    return true;
}
----
--

Input Data/Mutation::
+
--
[source,json]
----
INPUT: KEY advancedbinarykv:1

{
  "id": 1,
  "type": "basicbinarykv"
}
----
--

Output Data/Logged::
+ 
-- 
[source,json]
----
2021-04-10T13:55:22.969-07:00 [INFO] "1. wrote bindoc" {} "unmarshalled (1,0,2,3)" 

2021-04-10T13:55:22.970-07:00 [INFO] "2. read retdoc" {} 

2021-04-10T13:55:22.970-07:00 [INFO] "3. test bindoc(1,0,2,3) == retdoc(1,0,2,3) => true" 
----
--
====
