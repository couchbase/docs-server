= cbepctl
:page-topic-type: reference

[abstract]
The `cbepctl` tool is used to control the state, the configuration, memory, and disk-persistence of vBuckets.

== Description

The `cbepctl` command provides control of Couchbase-Server memory and storage facilities.
The command must be applied to an individual, named bucket; with the IP address of an individual node also specified.
The command is thus executed on the vBuckets that correspond to the named bucket, on the specified node.
Therefore, to perform this operation for all the vBuckets for the named bucket, execute the command on every node that maintains vBuckets for the bucket.
To perform the operation for an entire cluster, execute the command for every combination of bucket and node that exists for the cluster.

Note that settings made with `cbepctl` are _not_ persisted over a cluster-restart.
Therefore, if necessary, following cluster-restart, the command must be executed again, for every combination of bucket and node, as appropriate.

The `cbepctl` tool is found in the following locations:

[cols="1,3"]
|===
| Operating system | Location

| Linux
| [.path]_/opt/couchbase/bin/cbepctl_

| Windows
| [.path]_C:\Program Files\Couchbase\Server\bin\cbepctl.exe_

| Mac OS X
| [.path]_/Applications/Couchbase Server.app/Contents/Resources/couchbase-core/bin/cbepctl_
|===

== Syntax

The basic syntax for `cbepctl` is as follows:

----
cbepctl [host]:11210 [command] [options]
----

The `host` argument must be the IP address of an individual Couchbase-Server node.
The possible values of `command` (each of which determines the available `options`) are as follows:

[cols="100,441"]
|===
| Command | Description

| `stop`
| Stop persistence.
Incoming data is no longer saved to the on-disk vBuckets for the specified bucket on the specified node.

| `start`
| Start persistence.
Incoming data is again saved to the on-disk vBuckets for the specified bucket on the specified node.

| `drain`
| Wait until queues are drained.
No incoming data is saved to the on-disk vBuckets for the specified bucket on the specified node, until the disk queues for those vBuckets have been emptied of all pending writes.

| `set [type] [param] [value]`
| Establish settings.
Three _types_ of setting are available, which are `checkpoint_param`, `flush_param`, and `tap_param`.
Each type has its own selection of options for `param`, and an accompanying `value`.
|===

For detailed information on setting-_types_, see xref:cli:cbepctl/set-checkpoint_param.adoc[checkpoint_param], xref:cli:cbepctl/set-flush_param.adoc[flush_param], and xref:cli:cbepctl/set-tap_param.adoc[tap_param].

== Main Options

The following command-options are provided :

[cols="100,317"]
|===
| Option | Description

| `-h, --help`
| Show the help message.

| `-a`
| Iterate over all buckets defined for the cluster.

| `-b [bucket-name]`
| Execute on the bucket whose name is `bucket-name`

| `-u [username]`
| Authenticate with the username that is `username`.

| `-p [password]`
| Authenticate with the password that is `password`.

| `-S`
| Prompt for the password at `stdout`, then read the password from `stdin`.
|===

== Examples

The following examples cover uses of the `stop`, `start` and `drain` commands.
For examples of the `set` command, see the documentation for xref:cli:cbepctl/set-checkpoint_param.adoc[checkpoint_param], xref:cli:cbepctl/set-flush_param.adoc[flush_param], and xref:cli:cbepctl/set-tap_param.adoc[tap_param].

=== Stop Persistence

The following command stops persistence for the vBuckets on `localhost` that correspond to the `travel-sample` bucket:

----
/opt/couchbase/bin/cbepctl localhost:11210 \
-u Administrator -p password \
-b travel-sample stop
----

If the command is successful, the following output is displayed:

----
Persistence stopped
----

=== Start Persistence

The following command starts persistence for the vBuckets on `localhost` that correspond to the `travel-sample` bucket:

----
/opt/couchbase/bin/cbepctl localhost:11210 \
-u Administrator -p password \
-b travel-sample start
----

If the command is successful, the following output is displayed:

----
Persistence started
----

=== Wait Until Queues are Drained

The following command waits until the disk queues for the vBuckets on `localhost` that correspond to the `travel-sample` bucket have been drained :

----
/opt/couchbase/bin/cbepctl localhost:11210 \
-u Administrator -p password \
-b travel-sample drain
----

If the command is successful, the following output is displayed:

----
done
----

The following command waits until the disk queues have been drained for _all_ vBuckets on `localhost`:

----
/opt/couchbase/bin/cbepctl 10.143.194.101:11210 \
-u Administrator -p password \
-a drain
----

If successful, the command returns the following:

----
******************************************************************************
travel-sample

done
******************************************************************************
beer-sample

done
----

== Errors

Failure to specify a bucket produces the following error message: `No access to bucket:default - permission denied or bucket does not exist.`
A malformed command produces the error `cbepctl: error: Unknown command`.
Improperly specified credentials return an error message similar to `Authentication error for user:Administrat3or bucket:travel-sample`.
Use of the wrong port-number displays the error `Connection error: [Errno 111] Connection refused`.
