= cbft-bleve for Moss Indexes
:page-topic-type: reference

[abstract]
The `cbft-bleve` tool supports commands that return information on _Moss_ index partitions.

The full top-level syntax for `cbft-bleve` is provided at xref:cli:cbft-bleve.adoc[cbft-bleve].
All commands _except_ `scorch` and `zap` apply to _Moss_ indexes, and are listed in the sections below.

[#flags]
=== Flags

The following flags are optional for all `cbft-bleve` commands for Moss indexes.

* `-c`, `--count` `int`
+
The number of terms within the index that are to be checked.
The default is `100`.

* `-f`, `--field` `string`
A field to which the check should be restricted.
The default is that _all_ fields are checked.

== check

The `check` command checks the contents of a specified _Moss_ index.
Its syntax is as follows.

----
check [index-path] [flags]
----

The `index-path`, which is mandatory, is the filesystem path to the index-file.
The optional xref:cli:cli-bleve-moss.adoc#flags[flags] are those standard for all Moss-related `cbft-bleve` commands.

=== Example: Check Consistency of an Index Partition

In the following example, the `check` command is used to check the consistency of a specified _Moss_ partition-index.
No flags are used.
Only the initial lines of the (substantial) output is represented.

----
/opt/couchbase/bin/cbft-bleve check \
/opt/couchbase/var/lib/couchbase/data/@fts/\
mossIndex_690ef363c7557832_54820232.pindex
----

If successful, the command returns output the initial lines of which are as follows.
Note that the list of fields to be checked is printed first; then, each field and the number of terms it contains is listed, along with the number of problems encountered with the field.

----
2020/01/17 04:20:49 cbauth: key: fts/remoteClients registered for tls config updates
checking fields: [type tz country faa geo.alt geo.lat geo.lon icao id airportname city _all schedule.utc schedule.day schedule.flight sourceairport distance equipment stops airline airlineid destinationairport content phone name address email geo.accuracy hours url activity title free_internet reviews.author reviews.content reviews.date reviews.ratings.Cleanliness reviews.ratings.Location reviews.ratings.Overall reviews.ratings.Rooms reviews.ratings.Service reviews.ratings.Sleep Quality reviews.ratings.Value description free_parking pets_ok vacancy free_breakfast public_likes price state image image_direct_url callsign iata directions reviews.ratings.Check in / front desk reviews.ratings.Business service (e.g., internet access) fax alt reviews.ratings.Business service checkin checkout tollfree alias]
checking field: 'type'
field contains 5 terms
done checking 5 terms, found 0 problems
checking field: 'tz'
field contains 15 terms
done checking 15 terms, found 0 problems
checking field: 'country'
field contains 4 terms
done checking 4 terms, found 0 problems
checking field: 'faa'
field contains 276 terms
  .
  .
  .
----

== count

The `count` commands prints to standard output the total number of documents referred to in the specified index partition.
Its syntax is as follows:

----
cbft-bleve count [index-path] [flags]
----

The `index-path` must be the pathname of a _Moss_ index partition, on the current node.
The optional xref:cli:cli-bleve-moss.adoc#flags[flags] are those standard for all Moss-related `cbft-bleve` commands.

=== Example: Count Documents in an Index Partition

The following example counts the documents referred to in a specified Moss index partition, and uses no flags:

----
/opt/couchbase/bin/cbft-bleve count \
/opt/couchbase/var/lib/couchbase/data/@fts/\
mossIndex_690ef363c7557832_54820232.pindex
----

If successful, the `count` command displays output similar to the following:

----
2020/01/17 04:24:47 cbauth: key: fts/remoteClients registered for tls config updates
5286
----

The total number of documents referred to in the index partition is thereby confirmed as `5286`.

== dictionary

The `dictionary` command prints to standard output the _term dictionary_ for a specified field in a specified _Moss_-index partition.
The syntax is as follows:

----
cbft-bleve dictionary [index-path] [field-name] [flags]
----

The `index-path` must be the pathname of a _Moss_ index partition, on the current node.
The optional `field-name` is the name of a specific field within the index partition, for which term-dictionary content should be returned: if this is is not specified, the default is for term-dictionary content on _all_ fields to be returned.

The optional xref:cli:cli-bleve-moss.adoc#flags[flags] are those standard for all Moss-related `cbft-bleve` commands.

=== Example: Return the Dictionary for All Fields

The following example returns the term dictionary for all fields on a specified index partition.

----
/opt/couchbase/bin/cbft-bleve dictionary \
/opt/couchbase/var/lib/couchbase/data/@fts/\
mossIndex_690ef363c7557832_54820232.pindex name
----

If successful, the command displays output the initial lines of which are as follows:

----
2020/01/17 04:26:12 cbauth: key: fts/remoteClients registered for tls config updates
1 - 1
24 - 1
4 - 1
40 - 1
500 - 1
55 - 1
575 - 1
58 - 1
9 - 1
a16 - 1
abbey - 2
aberdulais - 1
abergele - 1
aberystwyth - 1
absinthe - 1
abu - 1
ace - 1
adobe - 1
african - 1
aiguille - 1
  .
  .
  .
----

== dump

The `dump` command dumps the entire or partial contents of a specified _Moss_-index partition.
The syntax takes two alternative forms:

----
cbft-bleve dump [index-path] [flags]

cbft-bleve dump [command]
----

The `index-path`, which is mandatory, is the filesystem path to the index-partition file: if this is specified, the command dumps the entire contents of the specified index partition.
The optional xref:cli:cli-bleve-moss.adoc#flags[flags] are those standard for all Moss-related `cbft-bleve` commands.

The optional `command` can be one of the following:

* `doc`.
Only the rows relating to a specfied document id are dumped.
This id must follow the `index-path`: thus, the syntax becomes `cbft-bleve dump doc [index-path] [doc-id]`.

* `fields`.
Only the `field` rows from the index partition are dumped.
The complete syntax for the command becomes `cbft-bleve dump fields [index-path]`.

=== Example: Dump an Entire Index Partition

The following command dumps the entire contents of the specified index partition.

----
/opt/couchbase/bin/cbft-bleve dump \
/opt/couchbase/var/lib/couchbase/data/@fts/\
mossIndex_690ef363c7557832_54820232.pindex
----

If successful, the command displays output whose initial lines appear as follows:

----
2020/01/20 06:06:07 cbauth: key: fts/remoteClients registered for tls config updates
Backindex DocId: `airline_10` Terms Entries: [field:0 terms:"airline"  field:53 terms:"mile" terms:"air"  field:2 terms:"united" terms:"states"  field:54 terms:"q5"  field:7 terms:"mla"  field:11 terms:"\\\014" terms:",\006\000H\000\000\000\000\000" terms:"40" terms:"airline" terms:"states" terms:"mla" terms:"P\003\000$" terms:"mile" terms:"air" terms:"L0\004@" terms:"8\030\002 \000\000\000" terms:"@\014\001\020\000\000" terms:"$\014\001\020\000\000\000\000\000\000" terms:"X\001@" terms:"00\004@\000\000\000\000" terms:"T\030\002" terms:"4\003\000$\000\000\000\000" terms:"D`\t\000\000" terms:"<\001@\022\000\000\000" terms:"united" terms:"q5" terms:" \001@\022\000\000\000\000\000\000\000" terms:"H\006\000H\000" terms:"(`\t\000\000\000\000\000\000"  field:8 terms:",\006\000H\000\000\000\000\000" terms:"4\003\000$\000\000\000\000" terms:"<\001@\022\000\000\000" terms:"@\014\001\020\000\000" terms:"P\003\000$" terms:"T\030\002" terms:"\\\014" terms:" \001@\022\000\000\000\000\000\000\000" terms:"H\006\000H\000" terms:"$\014\001\020\000\000\000\000\000\000" terms:"L0\004@" terms:"X\001@" terms:"(`\t\000\000\000\000\000\000" terms:"00\004@\000\000\000\000" terms:"8\030\002 \000\000\000" terms:"D`\t\000\000"  field:24 terms:"air" terms:"40" terms:"mile" ], Stored Entries: []
Key:   62 61 69 72 6c 69 6e 65 5f 31 30
Value: 0a 0b 08 00 12 07 61 69 72 6c 69 6e 65 0a 0d 08 35 12 04
  .
  .
  .
----

=== Example: Dump Rows for a Document

The following command uses the `doc` option to dump the rows that correspond to the document `airline_10`.

----
/opt/couchbase/bin/cbft-bleve dump doc \
/opt/couchbase/var/lib/couchbase/data/@fts/
mossIndex_690ef363c7557832_54820232.pindex airline_10
----

If successful, the command displays output whose initial lines are as follows:

----
2020/01/20 06:10:37 cbauth: key: fts/remoteClients registered for tls config updates
Term: `airline` Field: 0 DocId: `airline_10` Frequency: 1 Norm: 1.000000 Vectors: [Field: 0 Pos: 1 Start: 0 End 7 ArrayPositions: []uint64(nil)]
Key:   74 00 00 61 69 72 6c 69 6e 65 ff 61 69 72 6c 69 6e 65 5f 31 30
Value: 01 80 80 80 fc 03 00 01 00 07 00

Term: `states` Field: 2 DocId: `airline_10` Frequency: 1 Norm: 0.707107 Vectors: [Field: 2 Pos: 2 Start: 7 End 13 ArrayPositions: []uint64(nil)]
Key:   74 02 00 73 74 61 74 65 73 ff 61 69 72 6c 69 6e 65 5f 31 30
Value: 01 f3 89 d4 f9 03 02 02 07 0d 00
  .
  .
  .
----

=== Example: Dump Index Fields

The following command uses the `fields` option to dump only the `fields` rows of the index:

----
/opt/couchbase/bin/cbft-bleve dump fields \
/opt/couchbase/var/lib/couchbase/data/@fts/\
mossIndex_690ef363c7557832_54820232.pindex
----

If successful, the command displays output whose initial lines are as follows:

----
2020/01/20 06:13:00 cbauth: key: fts/remoteClients registered for tls config updates
Field: 0 Name: type
Key:   66 00 00
Value: 74 79 70 65 ff

Field: 1 Name: tz
Key:   66 01 00
Value: 74 7a ff

Field: 2 Name: country
Key:   66 02 00
Value: 63 6f 75 6e 74 72 79 ff
----

== fields

The `fields` command lists the fields in a specified _Moss_-index partition.
The syntax is as follows:

----
cbft--bleve fields [index-path] [flags]
----

The `index-path`, which is mandatory, is the filesystem path to the index-partition file: if this is specified, the command dumps the entire contents of the specified index partition.
The optional xref:cli:cli-bleve-moss.adoc#flags[flags] are those standard for all Moss-related `cbft-bleve` commands.

=== Example: List Fields in an Index

The following command lists the fields in a specified index partition.

----
/opt/couchbase/bin/cbft-bleve fields \
/opt/couchbase/var/lib/couchbase/data/@fts/\
mossIndex_690ef363c7557832_54820232.pindex
----

If successful, the command displays output whose initial lines are as follows:

----
2020/01/20 06:49:20 cbauth: key: fts/remoteClients registered for tls config updates
0 - type
1 - tz
2 - country
3 - faa
4 - geo.alt
5 - geo.lat
6 - geo.lon
7 - icao
8 - id
9 - airportname
10 - city
11 - _all
12 - schedule.utc
13 - schedule.day
14 - schedule.flight
  .
  .
  .
----

== mapping

The `mapping` command prints to standard output the _mapping_ used for a specified _Moss_-index partition.
The syntax is as follows:

----
cbft-bleve mapping [index path] [flags]
----

The `index-path`, which is mandatory, is the filesystem path to the index-partition file: if this is specified, the command dumps the entire contents of the specified index partition.
The optional xref:cli:cli-bleve-moss.adoc#flags[flags] are those standard for all Moss-related `cbft-bleve` commands.

=== Example: Print the Mapping for an Index

The following example prints out the mapping for a specified index partition:

----
/opt/couchbase/bin/cbft-bleve mapping \
/opt/couchbase/var/lib/couchbase/data/@fts/\
mossIndex_690ef363c7557832_54820232.pindex
----

If successful, the command prints out the following:

----
2020/01/17 04:31:20 cbauth: key: fts/remoteClients registered for tls config updates
{
  "default_mapping": {
    "enabled": true,
    "dynamic": true
  },
  "type_field": "_type",
  "default_type": "_default",
  "default_analyzer": "standard",
  "default_datetime_parser": "dateTimeOptional",
  "default_field": "_all",
  "store_dynamic": false,
  "index_dynamic": true,
  "docvalues_dynamic": true,
  "analysis": {}
}
----
