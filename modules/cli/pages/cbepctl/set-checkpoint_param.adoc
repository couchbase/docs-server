= set checkpoint_param
:page-topic-type: reference

[abstract]
The command [.cmd]`set checkpoint_param` sets the _checkpoints_ for the vBuckets on a Couchbase-Server node.

== Description

At all times, the Data Service maintains an active _checkpoint_ for each vBucket on each node.
The checkpoint receives and retains mutations made to documents: these are de-duplicated (in order to remove changes whose sequencing has ultimately left starting values unmodified), and persisted to disk as a batch.
The default and absolute maximum size for the checkpoint is 50,000 mutated documents.
The default maximum duration during which mutations can be accepted into the checkpoint is 5 seconds.
Persistence to disk occurs whenever the maximum duration is reached; or optionally, whenever the maximum size is reached prior to the maximum duration.

After persistence has occurred, the checkpoint is closed, and a new _active_ checkpoint is created: this continues the receiving of changes for the vBucket.
A checkpoint that has been closed can be kept in memory temporarily, so that contents can continue to be retrieved.
The maximum number of checkpoints that can be kept in memory simultaneously can be specified: _one_ of these being the currently active checkpoint, all others being checkpoints previously closed.

The maximum size, maximum duration, maximum number of checkpoints, and other parameters related to the checkpoint can be modified by means of the `set checkpoint_param` options to `cbepctl`.

This and all other `cbepctl` commands are intended for use either _by_ or _under the strict and explicit guidance of_ Couchbase Customer Support.

== Syntax and Examples

The basic syntax for using `set checkpoint_param` is:

----
cbepctl [host]:11210 -b [bucket-name] set checkpoint_param [parameter] [value]
----

The options for `parameter` and its associated `value` are as follows:

=== chk_max_items

The `value` is an integer, specifying the maximum number of items allowed in a checkpoint.
The default and absolute maximum number is 50,000.

The following example resets the maximum number of allowed items to 40,000, for vBuckets that correspond to the bucket `travel-sample` on node `10.143.194.101`:

----
/opt/couchbase/bin/cbepctl 10.143.194.101:11210 \
-u Administrator -p password \
-b travel-sample \
set checkpoint_param chk_max_items 40000
----

If successful, the command returns the following:

----
setting param: chk_max_items 40000
set chk_max_items to 40000
----

=== chk_period

The `value` is an integer, specifying the maximum duration, in seconds, of a checkpoint.
The absolute maximum that can be set is `3600`.

The following example resets the maximum duration of a checkpoint to 8 seconds, for vBuckets that correspond to the bucket `travel-sample` on node `10.143.194.101`:

----
/opt/couchbase/bin/cbepctl 10.143.194.101:11210 \
-u Administrator -p password \
-b travel-sample \
set checkpoint_param chk_period 8
----

If successful, the command returns the following:

----
setting param: chk_period 8
set chk_period to 8
----

=== item_num_based_new_chk

The `value` is a Boolean. If `true`, this indicates that a new checkpoint can be created based on the maximum number of items having been created in the open checkpoint.
If `false`, a new checkpoint _cannot_ be so created; and will be created only when the number of seconds specified by `chk_period` has expired.

The following example sets the value of `item_num_based_new_chk` to `false`.

----
/opt/couchbase/bin/cbepctl 10.143.194.101:11210 \
-u Administrator -p password \
-b travel-sample \
set checkpoint_param item_num_based_new_chk false
----

If successful, the command returns the following:

----
setting param: item_num_based_new_chk false
set item_num_based_new_chk to false
----

=== max_checkpoints

The `value` is an integer that specifies the maximum number of checkpoints that can be maintained simultaneously per vBucket.
The default is `2`.
The absolute maximum permitted is `5`.
Note that only one _active_ checkpoint (that is, one checkpoint receiving changes) can exist at one time; all others being _closed_, and kept in memory to support continued access to data.

The following example sets the maximum number of checkpoints to `3`:

----
/opt/couchbase/bin/cbepctl 10.143.194.101:11210 \
-u Administrator -p password \
-b travel-sample \
set checkpoint_param max_checkpoints 3
----

If successful, the command returns the following:

----
setting param: max_checkpoints 3
set max_checkpoints to 3
----

== Errors

Failure to specify a bucket produces the following error message: `No access to bucket:default - permission denied or bucket does not exist.`
A malformed command produces the error `cbepctl: error: Unknown command`.
Improperly specified credentials return an error message similar to `Authentication error for user:Administrat3or bucket:travel-sample`.
Use of the wrong port-number displays the error `Connection error: [Errno 111] Connection refused`.

Incorrectly specifying a parameter returns the error `Error: Bad parameter <specified-parameter>`.
Specifying a `value` greater than the maximum permitted returns the error `Error: KEY_ENOENT : Not Found :`.
