= Manage Address Families

[abstract]
Couchbase Server Enterprise Edition supports the IPV4 and IPV6 address families.

[#understanding-address-families]
== Understanding Address Families

Couchbase Server Enterprise Edition supports the IPV4 and IPV6 address families.
By default, IPV4 is the address family used.
For IPV6 to be used instead, configuration changes must be made.
The cluster must use _either_ IPV4 _or_ IPV6, for _all_ its nodes.

Note the following:

* Although raw IPV6 addresses _can_ be used with the nodes of a Couchbase Server-cluster, cluster-management is nevertheless easier if each cluster-node is named with a fully qualified domain-name (such as `nodename.clustername.com`).

* Each cluster-node must be operating in _dual stack_ mode, thereby supporting both IPV4 and IPV6 addressing.

* DNS records must have been updated, to ensure appropriate address-resolution, following cluster-reconfiguration.

A Couchbase Server-cluster can be configured to use IPV4 or IPV6 either:

* When the cluster is being created.
For information on using the UI, see the xref:manage:manage-nodes/create-cluster.adoc[Create a Cluster].
For information on using the CLI, xref:manage:manage-nodes/initialize-node.adoc#initialize-a-node-with-the-cli[Initialize a Node with the CLI].

* After the cluster has been created.
This procedure, which uses the CLI, is explained below.

[#changing-address-family-to-ipv6]
== Changing Address Family

Proceed as follows:

. Retrieve the current address-family setting.
+
This can be accomplished means of the xref:cli:cbcli/couchbase-cli-ip-family.adoc[ip-family] CLI command, using the `--get` flag:
+
----
/opt/couchbase/bin/couchbase-cli ip-family \
-c http://node1-devcluster.com:8091 \
-u Administrator \
-p password \
--get
----
+
The output from this command is one of the following three messages:

** `Cluster using IPV4`: Every node in the cluster is using IPV4.
** `Cluster using IPV6`: Every node in the cluster is using IPV6.
** `Cluster is in mixed mode`:  The cluster contains some nodes that are using IPV4, and others that are using IPV6: this situation is indicative of an _error_, likely incurred during a previous, attempted reconfiguration of the address family for the cluster.

+
The remaining steps below assume that the address family of the cluster is to be changed to IPV6.

. Switch off auto-failover.
+
Auto-failover must be disabled, for the address family to be modified.
Use the `setting-autofailover` CLI command, as follows:
+
----
/opt/couchbase/bin/couchbase-cli setting-autofailover \
-c http://node1-devcluster.com:8091 \
-u Administrator \
-p password \
--enable-auto-failover 0
----
+
If successful, this provides the following output:
+
----
SUCCESS: Auto-failover settings modified
----

. Switch off node-to-node encryption, if appropriate.
+
Node-to-node encryption must be _disabled_, before the address family can be changed.
To check the status of node-to-node encryption, use the xref:cli:cbcli/couchbase-cli-node-to-node-encryption.adoc[node-to-node-encryption] CLI command, specifying the `--get` flag:
+
----
/opt/couchbase/bin/couchbase-cli node-to-node-encryption \
-c http://node1-devcluster.com:8091 \
-u Administrator \
-p password \
--get
----
+
The output from this command is one of two messages: either `Node-to-node encryption is disabled`, indicating that it does _not_ need to be disabled; or `Node-to-node encryption is enabled`. which indicates that it _does_.
+
To disable node-to-node encryption, use the xref:cli:cbcli/couchbase-cli-node-to-node-encryption.adoc[node-to-node-encryption] command again, this time with the `--disable` flag:
+
----
/opt/couchbase/bin/couchbase-cli node-to-node-encryption \
-c http://node1-devcluster.com:8091 \
-u Administrator \
-p password \
--disable
----
+
If this command is successful, the output is as follows:
+
----
SUCCESS: Switched node-to-node encryption off
----

. Change the address family for the cluster to IPV6.
+
Use the xref:cli:cbcli/couchbase-cli-ip-family.adoc[ip-family] CLI command, using the `--set` and `--ipv6` flags, as follows:
+
----
/opt/couchbase/bin/couchbase-cli ip-family \
-c http://node1-devcluster.com:8091 \
-u Administrator \
-p password \
--set \
--ipv6
----
+
The `--set` flag indicates that an IP-family setting is to be made.
The `--ipv6` flag specifies that the cluster will from this point use the IPV6 family.
+
If successful, the command provides the following output:
+
----
Switched ip family for node: http://node1-devcluster.com:8091
Switched ip family for node: http://node1-devcluster.com:8091
SUCCESS: Switched ip family of the cluster
----
+
The output indicates that the IP family has been successfully established, and thus changed for each cluster in the node.
