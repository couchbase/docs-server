= Manage Address Families

[abstract]
Couchbase Server Enterprise Edition supports the IPV4 and IPV6 address families.


[#understanding-address-families]
== Understanding Address Families

Couchbase Server Enterprise Edition supports the IPV4 and IPV6 address families.
By default, IPV4 is the address family used.
For IPV6 to be used instead, configuration changes must be made.

Note the following:

* Although raw IPV6 addresses _can_ be used with the nodes of a Couchbase Server-cluster, cluster-management is nevertheless easier if each cluster-node is named with a fully qualified domain-name (such as `nodename.clustername.com`).

* Each cluster-node must be operating in _dual stack_ mode, thereby supporting both IPV4 and IPV6 addressing.

* DNS records must have been updated, to ensure appropriate address-resolution, following cluster-reconfiguration.

A Couchbase Server-cluster can be configured to use IPV6 at either of the following times:

* At cluster-creation.
For information, see xref:manage:manage-nodes/create-cluster.adoc[Create a Cluster].

* After the cluster has been created with IPV4 as its address family.
This is explained by the procedures below.

[#changing-address-family-to-ipv6]
== Changing Address Family to IPV6

Proceed as follows:

. Retrieve the current address-family setting.
This can be accomplished means of the xref:cli:cbcli/couchbase-cli-ip-family.adoc[ip-family] CLI command, using the `--get` flag:
+
----
/opt/couchbase/bin/couchbase-cli ip-family \
-c 127.0.0.1 \
-u Administrator \
-p password \
--get
----
+
This call returns one of the following, three results:

** `Cluster using IPV4`: Every node in the cluster is using IPV4.
** `Cluster using IPV6`: Every node in the cluster is using IPV6.
** `Cluster is in mixed mode`:  The cluster contains some nodes that are using IPV4, and others that are using IPV6: this situation is indicative of an _error_, likely incurred during a previous, attempted reconfiguration of the address family for the cluster.

+
The remaining steps assume that the cluster is to be changed from its state to IPV6.

. Switch off auto-failover.
+
Auto-failover must be disabled, for the address family to be modified.
Use the `setting-autofailover` CLI command, as follows:
+
----
/opt/couchbase/bin/couchbase-cli setting-autofailover \
-c 127.0.0.1 \
-u Administrator \
-p password \
--enable-auto-failover 0
----
+
If successful, this provides the following response:
+
----
SUCCESS: Auto-failover settings modified
----

. Switch off node-to-node encryption, if appropriate.
+
Node-to-node encryption must be _disabled_, before the address family can be changed.
To check the status of node-to-node encryption, use the xref:cli:cbcli/couchbase-cli-node-to-node-encryption.adoc[node-to-node-encryption] CLI command, specifying the `--get` flag:
+
----
/opt/couchbase/bin/couchbase-cli node-to-node-encryption \
-c 127.0.0.1 \
-u Administrator \
-p password \
--get
----
+
The call returns one of two results: either `Node-to-node encryption is disabled`, indicating that it does _not_ need to be disabled; or `Node-to-node encryption is enabled`. which indicates that it _does_.
+
To disable node-to-node encryption, use the `node-to-node-encryption` command again, this time with the `--disable` flag:
+
----
/opt/couchbase/bin/couchbase-cli node-to-node-encryption \
-c 127.0.0.1 \
-u Administrator \
-p password \
--disable
----
+
If this command is successful, the output is as follows:
+
----
SUCCESS: Switched node-to-node encryption off
----
