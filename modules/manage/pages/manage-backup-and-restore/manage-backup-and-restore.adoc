= Manage Backup and Restore
#:page-aliases: backup-restore:backup-restore,backup-restore:incremental-backup

[abstract]
Couchbase Server allows one or more buckets, and selected subsets of their data, to be backed up, restored, and archived.

[#understanding-backup-and-restore]
== Understanding Backup and Restore

The data on a Couchbase-Server cluster can be backed up, restored, and archived by means of either of the following:

* The *Backup Service*.
This can be configured by means of the *Backup* UI provided by Couchbase Web Console.

* The xref:backup-restore:cbbackupmgr.adoc[cbbackupmgr] CLI utility.

The technology that underlies the Backup Service is in fact that provided by `cbbackupmgr`: note, however, that `cbbackupmgr` and the Backup Service differ, in terms of the features they offer (as described below, in xref:manage:manage-backup-and-restore/manage-backup-and-restore.adoc#backup-ui-vs-cli[Backup and Restore: UI versus CLI]).
For use of either the Backup Service or `cbbackupmgr`, the Full Admin or Cluster Admin role must have been assigned.
On Couchbase Server 7.0 and above, both the Backup Service and `cbbackupmgr` are available in both the Enterprise and the Community Edition.
Both the Backup Service and `cbbackupmgr` support use of AWS S3 storage.

Note that two additional tools, xref:cli:cbtools/cbbackup.adoc[cbbackup] and xref:cli:cbtools/cbrestore.adoc[cbrestore], continue to be available in Couchbase Server 7.0: however, both are deprecated.

Detailed information on `cbbackupmgr` is provided in xref:backup-restore:cbbackupmgr.adoc[cbbackupmgr].

[#backup-ui-vs-cli]
=== Backup and Restore: UI versus CLI

The Backup Service, which can be configured by means of the *Backup* facility of Couchbase Web Console, allows backup, restore, and archiving to be configured for the local cluster; and also permits restore to be configured for a remote cluster.
By contrast, `cbbackupmgr` allows backup, restore, and archiving each to be configured either for the local or for a remote cluster: all available options are listed in xref:backup-restore:enterprise-backup-restore.adoc##version-compatibility[Version Compatibility].

Both the UI and `cbbackupmgr` allow either _full_ or _incremental_ backups to be scheduled.
Both allow incremental backups, once created, to be merged, and their data deduplicated.
Both use the same backup archive structure; and allow the contents of backups to be listed, and specific documents to be searched for.

Whereas `cbbackupmgr` performs a specific backup or merge when executed, the Backup Service can be _scheduled_; so that backups and periodic merges are ongoing.
The Backup Service therefore supports additional and modified parameters, to allow scheduling to be configured.

For detailed information on how `cbbackupmgr` works (including a detailed description of incremental backup), see the xref:backup-restore:cbbackupmgr.adoc#discussion[Discussion] provided on the page for xref:backup-restore:cbbackupmgr.adoc[cbbackupmgr].
The page for xref:backup-restore:cbbackupmgr.adoc[cbbackupmgr] also provides a synopsis of the command, and a description of its basic options; and is co-located with additional pages that provide information on specific subcommands for collecting logs, compacting, merging, and more.

The remainder of the current page describes how to configure and use the Backup Service, by means of the UI.

[#node-configuration]
== Assign and Run the Backup Service

For backup, restore, and other related tasks to be scheduled and performed by means of Couchbase Web Console, the Backup Service must be running on an assigned node.
The service (as is the case with all other Couchbase services) can be assigned either when a node is initially provisioned as a one-node cluster (as described in xref:manage:manage-nodes/create-cluster.adoc[Create a Cluster]), or when a node is added to an existing cluster (as described in xref:manage:manage-nodes/add-node-and-rebalance.adoc[Add a Node and Rebalance]).
Provided that at least one node runs the Backup Service, data for the entire cluster can be backed up, restored, and more.
If multiple nodes run the Backup Service, they share the same configuration.

[#access-the-backup-service-ui]
== Access the Backup Service UI

To access the Backup Service UI, proceed as follows:

. On Couchbase Web Console, left-click on the *Backup* tab, in the right-hand, vertical navigation bar:
+
image::manage-backup-restore/accessBackupTab.png[,100,align=left]
+
This brings up the *Respositories* screen of the *Backup* facility.
The initial appearance is as follows:
+
image::manage-backup-restore/backupScreenInitial.png[,720,align=left]
+
The screen features three panels, for *Active*, *Imported*, and *Archived Repositories* respectively.
Currently, all panels are blank.

[#schedule-backups]
== Schedule Backups

To schedule one or more backups, proceed as follows:

. Choose to add a repository.
A _repository_ is a folder into which data will be copied as a backup.
Each defined repository should be given a unique name.
To add a repository, left-click on the *ADD REPOSITORY* tab, at the upper right of the screen:
+
image::manage-backup-restore/addRepositoryTab.png[,140,align=left]
+
This brings up the *Select plan* dialog, which initially appears as follows:
+
image::manage-backup-restore/selectPlanDialog.png[,420,align=left]

. Specify whether to use a default or a custom plan.
A _plan_ determines what kind of backup is to occur, affecting what data, and on what schedule.
Left-click on the control that appears at the right-hand side of the *Select plan* dialog's interactive text-field.
A pull-down menu appears, as follows:
+
image::manage-backup-restore/selectPlanDialogPullDownMenuInitial.png[,420,align=left]
+
Three options are thus provided.
The first two are *_daily_backups* and *_hourly_backups*: these are default plans that, as their names indicate, provide backups that are respectively daily and hourly.
The third option is *+ Create new plan*: select this option:
+
image::manage-backup-restore/selectPlanDialogPullDownMenuSelection.png[,140,align=left]
+
This establishes the string *+ Create new plan* within the interactive text field.
To confirm, left-click on the *Next*, button, at the lower right of the dialog:
+
image::manage-backup-restore/selectPlanDialogPullDownMenuNext.png[,420,align=left]
+
The brings up the *Create Plan* dialog, which appears as follows:
+
image::manage-backup-restore/createPlanDialog.png[,420,align=left]

. Create a custom plan.
In the *Name* field of the *Create Plan* dialog, enter a name for the plan that is to be created.
The name must be unique across the cluster, can only use the characters `[`, `]`, `A` to `Z`, `a` to `z`, `&#95;` and `-`; and must not start with either `&#95;` or `-`.
+
Then, optionally, add a description for the plan in the *Description* field: the description can be up to 140 characters in length.
For example, to specify a plan for hourly backups, the following might be entered:
+
image::manage-backup-restore/createPlanDialogWithInitialInput.png[,420,align=left]
+
Next, specify the services for which data will be backed up.
Left-click on the *Services* control: this expands the dialog, and displays a complete list of Couchbase Services, each being accompanied by a checkbox.
+
image::manage-backup-restore/createPlanServicesListInitial.png[,90,align=left]
+
To specify that only data for the Data and Index Services should be backed up, uncheck the boxes for all the other services.
+
Next, to specify precise details of what should occur when the backup is run, left click on the *Add Tasks* button.
The dialog now expands, to reveal the following fields:
+
image::manage-backup-restore/createPlanDialogAddTaskFields.png[,420,align=left]
+
The fields permit the input of data to specify the details of a particular task, referred to as *Task 1*.
Note that the dialog permits multiple tasks to be specified, by means of the *Add Task* button, at the lower left.
+
In the *Name* field, enter an appropriate name for the task: for example, *hourlyBackup*.
+
The *Period* field allows specification of the frequency of the task.
If the default selection, *Simplified*, is chosen, this specifies a daily backup according to details added lower in the *Task 1* panel.
To choose a specific frequency, access the control at the right-hand of the *Period* field.
A pull-down menu appears:
+
image::manage-backup-restore/periodPullDownMenu.png[,420,align=left]
+
From the pull-down menu, select *Hours*, to indicate that the frequency should be determined in units of hours.
+
In the *Type* field, specify the task to be performed, by accessing the control at the right-hand side of the field.
This displays the following pull-down menu:
+
image::manage-backup-restore/typePullDownMenu.png[,420,align=left]
+
Select *Backup*, from the pull-down menu.
(Note that this duly removes from the dialog the day-specification controls associated with *Simplified*.)
Then, in the *Frequency* field, specify the frequency with which the task should be performed.
The field only accepts integers: these must be between 1 and 200 inclusive.
To specify that the task be performed hourly, enter *1*.
+
In the *Time* field, specify a time of day at which the task is to be run.
The time of day must be specified as hours and minutes, separated by a colon.
Note that when the frequency-unit specified is *Minutes*, this field takes no input.
When the frequency-unit specified is *Hours* (as is the case in the current example), only the numbers signifying minutes (those after the colon) are used.
To ensure that the hourly task is performed on the hour, leave these numbers as *00*.
+
To complete specification of *Task 1*, determine whether the backup to be performed is *Full* or *Incremental*.
If it is to be *Full*, check the *Full Backup* checkbox.
If it is to be *Incremental* (as should be the case in the current example), leave the checkbox unchecked.
+
The dialog now appears as follows:
+
image::manage-backup-restore/taskPanelComplete.png[,420,align=left]
+
At this stage, if another task is to be specified, the *Add Task* button should be clicked on: this expands the dialog further, and provides another set of task-specification fields, for *Task 2*.
If the task already added is to be removed, left-click on the *Cancel* button: this discards the data that has been added for *Task 1*, and closes the task-panel.
If the specification of the plan is to be abandoned, left-click on the *Cancel* tab, at the lower right.
If the specification for *Task 1* is to be retained and used, and no other task is to be specified (as is the case in the current example), left-click on the *Next* button:
+
image::manage-backup-restore/nextButton.png[,90,align=left]
+
This brings up the *Create Repository* dialog, which appears as follows:
+
image::manage-backup-restore/createRepositoryDialogInitial.png[,420,align=left]

. Create a repository.
A _repository_ is a container for backed up data.
Enter data into the *Create Repository* dialog.
+
The *ID* should be a name for the repository.
The name must be unique across the cluster, can only use the characters `[`, `]`, `A` to `Z`, `a` to `z`, `&#95;` and `-`; and must not start with either `&#95;`, `-`, `[`, or ']'.
For example, `hourlyBackupRepo`.
+
The *Couchbase Bucket* should be the name of a _Couchbase_ bucket whose data is to be backed up.
If a bucket-name is entered, only data from this bucket is backed up.
If this field is left empty, data from all Couchbase buckets on the cluster is backed up.
Note that data from _Ephemeral_ buckets cannot be backed up.
Use the control at the right-hand side of the field, to select a bucket.
For the current example, the sample bucket `travel-sample` is assumed to have been installed (see xref:manage:manage-settings/install-sample-buckets.adoc[Sample Buckets]); and will be specified in this field.
+
The *Storage Location* can be specified as *Filesystem* (the default) or *Cloud*.
For the current example, *Filesystem* will be used.
Note that if *Cloud* is selected, allowing AWS S3 storage to be used, the dialog expands, and displays additional options: these are described below.
+
The *Archive* should be the location of the repository.
If on the local filesystem, this location must be a pathname accessible to all nodes within the cluster that are running the Backup Service.
+
When complete, the dialog may look as follows:
+
image::manage-backup-restore/createRepositoryDialogComplete.png[,420,align=left]
+
To confirm, left-click on the *Add* button:
+
image::manage-backup-restore/addButton.png[,120,align=left]

This concludes the process for creating repository and plan.
The *Repositories* screen now appears as follows:

image::manage-backup-restore/newRepository.png[,720,align=left]

The newly created repository, *hourlyBackupRepo*, is thus displayed with its associated plan, `hourlyBackupRepo`, with the affected bucket (`travel-sample`) and the next scheduled backup displayed.
Data Service and Index Service data for `travel-sample` will now be backed up to the specified location on the specified schedule.

[#run-an-immediate-backup]
== Run an Immediate Backup

By means of the Couchbase Web Console UI, an _immediate_ backup can be run: this eliminates the need to wait for a scheduled backup to run at an appointed time.
To run an immediate backup, access the *Repositories* screen, and left-click on the row for an already-defined, active repository.
For example:

image::manage-backup-restore/selectActiveRepository.png[,720,align=left]

This causes the row to expand vertically, as follows:

image::manage-backup-restore/activeRepositoryRowExpanded.png[,720,align=left]

A number of buttons now appear, arranged horizontally across the bottom of the row, permitting a variety of actions.
To perform an immediate backup, left-click on the *Backup* button:

image::manage-backup-restore/backupButton.png[,120,align=left]

This displays the *Trigger Backup* dialog, which appears as follows:

image::manage-backup-restore/triggerBackup.png[,420,align=left]

The immediate backup to be performed will be _incremental_ by default.
To perform a _full_ backup, check the *Perform a full backup* checkbox.

Left-click on the *Backup* button, at the lower right of the dialog.
The dialog disappears, and a notification is displayed at the lower left of the console:

image::manage-backup-restore/immediateBackupNotification.png[,220,align=left]

This duly indicates that an immediate backup has been triggered.

[#inspect-backups]
== Inspect Backups

Using Couchbase Web Console, the history of backups to a specified repository can be reviewed.
Left-click on the row of a repository, to expand it vertically.
Then, left-click on the *Inspect Backups* button:

image::manage-backup-restore/inspectBackupsButton.png[,240,align=left]

This displays the *Backup* facility's *Data* screen, which appears as follows:

image::manage-backup-restore/inspectBackupsScreen.png[,720,align=left]

The screen provides two possible views, which are *Data* and *Tasks*: these can be selected by means of the buttons at the upper right:

image::manage-backup-restore/tasksAndDataButtons.png[,130,align=left]

The *Data* view is selected by default.
(Note the left-clicking the *Tasks* button displays the *Tasks* view: this is the same display as that accessed by means of the *Tasks* button, from the expanded row on the *Respositories* screen; and is described in xref:manage:manage-backup-and-restore/manage-backup-and-restore.adoc#inspect-tasks[Inspect Tasks], below.)

The main, lower panel of the *Data* view provides the ID of the repository (in this case, `56f42a97-6c52-4e32-8597-b0bfed34af29`) and its size (here, `22.856 MB`); and also provides a vertically arranged list of all backups that have occurred, with the earliest at the top.
Each backup has its own row; with its start-time, type (_full_ or _incremental_), and size.
To inspect a particular backup in detail, left-click on the control at the left-hand side of the row:

image::manage-backup-restore/examineBackup.png[,360,align=left]

This causes the row to expand vertically:

image::manage-backup-restore/examineBackupExpanded.png[,720,align=left]

The displayed data includes the UUID for the source cluster.
Also specified are the numbers of *Events* written for the Eventing Service, and the number of *Aliases* for the Search Service (here, the numbers are both zero).

Each bucket that has been backed up (in this case, the `travel-sample` bucket alone), appears on its assigned row in a table that specifies the number of items, mutations, and tombstones that have been included in the backup.
The row also lists the numbers of backed up indexes for the Index, Search, and Analytics Services; and the number of backed up Views.

The upper panel of the *Data* screen provides interactive fields labelled *Key* and *Search Path*.
These can be used to search for a specific document within the repository.
For example, type a known document key into the *Key* field &#8212; such as `airline_10`.
Then, enter the bucket name into the *Search Path* field: note that this requires explicit specification of both _scope_ and _collection_; unless default scope and collection have been used, in which case, explicit specification of the defaults is optional.
For example, `travel-sample._default._default` can be specified.
The panels now appear as follows:

image::manage-backup-restore/searchPanelsForKeyAndBucket.png[,510,align=left]

To run the search, left-click on the *Examine* button.
The *Examine* screen is now displayed:

image::manage-backup-restore/examineScreen.png[,720,align=left]

Note that the controls adjacent to the *Diff* button, near the top of the screen, allow different backups to be selected, so that the differences between the document-versions they contain can be individually examined:

image::manage-backup-restore/diffSelector.png[,420,align=left]

The specified document is thereby shown, in the left and right-hand panels of the main display, in versions that respectively correspond to the backups selected.
When a field has changed, the earlier version appears shaded red, the later shaded green.

By default, a *Side-by-Side Diff* view of the specified document is shown.
To display an *Inline Diff* view, access the control at the upper right of the screen:

image::manage-backup-restore/diffView.png[,120,align=left]

The *Inline Diff* view is now provided:

image::manage-backup-restore/inlineDiffView.png[,720,align=left]

[#inspect-tasks]
== Inspect Tasks

To inspect currently defined tasks, do _either_ of the following:

* Left-click on the *Tasks* button that appears on the expanded row for a repository, on the *Repositories* screen.

* Left-click on the *Tasks* button that appears at the upper-right of the *Data* screen, which has been accessed by means of the *Inspect Backups* button that appears on the expanded row for a repository, on the *Repositories* screen.

The *Tasks* screen appears as follows:

image::manage-backup-restore/tasksScreen.png[,720,align=left]

The screen provides two possible views, which are *Data* and *Tasks*: these can be selected by means of the buttons at the upper right.
The *Tasks* button is currently selected.
(Left-clicking on the *Data* button displays the *Data* screen, described above in xref:manage:manage-backup-and-restore/manage-backup-and-restore.adoc#inspect-backups[Inspect Backups]).

The *Running* field provides information on any tasks currently running.
The *History* button permits a refresh of data shown in the lower panel; which lists the current history of tasks performed.
The *Get Tasks* button allows specific tasks to be identified by search, and displayed.
The earliest date for the task can be specified in the *Since Day* field; and the name of the task in the *Task Name* field, so as to narrow the search.
A limit on the number of tasks displayed can be specified as an integer, between 1 and 100 inclusive, in the *Limit* field.

The main task list, in the lower panel has an *Offset* figure displayed at its head: this indicates the position in the list of the first displayed task; and changes when the *prev batch* and *next batch* controls, at the right-hand side, and left-clicked on.
The task list is presented as a table, which shows, for each task that has been executed, the *Task name*, *Task type* (such as *Backup* or *Merge*), status (such as *done*), the *Elapsed* time for the task, the size of data that was *Transferred* by the task, and the *Start* and *End* times for the task.

To inspect a particular task in detail, left-click on the row for the task.
For example:

image::manage-backup-restore/leftClickOnTaskRow.png[,240,align=left]

The selected row is expanded vertically, as follows:

image::manage-backup-restore/expandedTaskRow.png[,480,align=left]

The details of the task are thus displayed as a JSON document.
The details include counts of items, vBuckets, and bytes received from the operation.
Information is provided in the `node_runs` subdocument for each node in the cluster, each node's unique ID being specified.

[#schedule-merges]
== Schedule Merges

A _merge_ allows multiple backups to be combined as one; with _deduplication_ occurring: when data has been modified, the latest updates are retained, and superseded updates are discarded.

Merges can be scheduled to be applied to backed up data within a defined repository.
Proceed as follows, noting that the initial steps (for adding a repository, creating a new plan, and adding a backup task to the plan) are the same as those described in xref:manage:manage-backup-and-restore/manage-backup-and-restore.adoc#schedule-backups[Schedule Backups], above.

. Access the *Repositories* screen, and left-click on *ADD REPOSITORY*.
When the *Select plan* dialog is displayed, choose *+ Create new plan*.

. In the *Create plan* dialog, specify a *Name* and a *Description* for the plan.
Then, specify the *Services* whose data should be backed up.
+
Note that a merge can only be scheduled as part of a plan that also schedules a backup: the merge will be applied to the data that the backup commits to the defined repository.

. Left-click on *Add Task*, and add a *Backup* task as *Task 1*.
For example:
+
image::manage-backup-restore/backUpTaskForMerging.png[,420,align=left]
+
This task calls for a backup to occur every two minutes.
Next, left-click on *Add Task*:
+
image::manage-backup-restore/addTaskButton.png[,100,align=left]
+
When the fields for *Task 2* appear, specify the task of type *Merge*, with a frequency of *10* minutes.
For example:
+
image::manage-backup-restore/mergeTask.png[,420,align=left]
+
The *Type* of the task *MergeTask* has thus been specified as *Merge*, with a frequency of 10 minutes.
Note the fields *Merge Offset Start* and *Merge Offset End*, which respectively specify the relatively start and end points of each merge that will be performed.
The offset start of *7* indicates that each merge will start with backups that were made 7 days before the current day (that is, 8 days ago), if such backups exist.
The offset end of *0* indicates that each merge with conclude with backups that were made today, if such backups exist.
If backups were not made every day during the specified period, as many as can be found will be merged.
+
Left-click on the *Next* button:
+
image::manage-backup-restore/nextButton.png[,140,align=left]

. When the *Create repository* dialog appears, create a repository.
For example:
+
image::manage-backup-restore/createRepositoryForMerge.png[,420,align=left]
+
Left-click on the *Add* button.
The new repository now appears in the *Repositories* screen:
+
image::manage-backup-restore/newRepositoryConfirmed.png[,720,align=left]

The defined backups and merges will now occur, on the specified schedule.
This can eventally be seen by left-clicking on the row for the new repository, and then left-clicking on *Inspect Backups*.

image::manage-backup-restore/inspectMergedBackup.png[,720,align=left]

The *# Backups merged:* field indicates that *6* backups have been merged into the full backup that appears on the first line.
The first of the next series of continuing incremental backups appears on the second line.

[#perform-an-immediate-merge]
== Perform an Immediate Merge

By accessing a vertically expanded repository display on the *Repositories* screen, an _immediate merge_ can be manually triggered.
The repository does not need to have scheduled merges in its plan; but must already contain multiple backups, so that these can be merged.
Proceed as follows:

. On the *Repositories* screen, select a repository that contains multiple backups, by left-clicking on the row for the repository.
When the row has expanded vertically, left-click on the *Merge* button:
+
image::manage-backup-restore/mergeButton.png[,90,align=left]
+
The *Merge* dialog is now displayed:
+
image:manage-backup-restore/mergeDialog.png[,420,align=left]
+
The dialog allows determination of which backups should be merged, based on specification of the _first_ and the _last_: these backups, and all backups that occurred between them, will be merged.

. To specify the first backup, access the interactive control at the right-hand side of the *Start* field.
This produces a pull-down menu that displays all available backups for this repository:
+
image:manage-backup-restore/start-menu-backups-for-merge.png[,420,align=left]

. Select a backup that will be the starting backup for the merge.
Then, access the control at the right-hand side of the *End* field, and select, from its pull-down menu, a backup that will be the ending backup for the merge.
The dialog now appears as follows:
+
image:manage-backup-restore/mergeDialogComplete.png[,420,align=left]

. Left-click on the *Merge* button, at the lower right of the dialog.
The dialog now disappears, and the following notification appears, at the lower left of the console:
+
image:manage-backup-restore/mergeNotification.png[,220,align=left]
+
The specified merge has now been triggered.

. To check the results, on the *Repositories* screen, left-click on the *Inspect Backups* button, on the expanded row for the selected repository.
This brings up the *Data* screen, on which the history of backups and merges can be reviewed.
(It may be necessary to scroll through multiple screens of information, to find the merge that has been created.)
+
image:manage-backup-restore/dataScreenShowingMergedBackup.png[,720,align=left]
+
Here, the merge of incremental builds just performed is clearly indicated; as `MERGE - INCR`.
To obtain further specifics, left-click on the row for the merge.
The row expands vertically, as follows:
+
image:manage-backup-restore/backupMergeConfirmation.png[,720,align=left]
+
The details in the expanded row confirm that 15 backups were merged by the operation just performed.

[#restore-backups]
== Restore Backups

One or more backups can be _restored_ to the cluster; which means that the data in the backups is copied back into the buckets from which it was originally backed up.
Proceed as follows:

. On the *Repositories* screen, select the repository from which data is to be restored, and left-click on the row for the repository, in order to expand it vertically.
Then, left-click on the *Restore* button:
+
image:manage-backup-restore/restoreButton.png[,140,align=left]
+
The *Restore* dialog is now displayed:
+
image:manage-backup-restore/restoreDialog.png[,420,align=left]

. Use the *Restore* dialog to specify which backup or backups should be restored.
In the *Cluster* field, enter the IP address of the cluster at which the data-restoration is targeted.
Enter username and password for the target cluster in the *User* and *Password* fields, and then use the controls at the right-hand sides of the *Start* and *End* fields to select the first and last backups in the series that is to be restored.
The dialog now appears as follows:
+
image:manage-backup-restore/restoreDialogPartiallyComplete.png[,420,align=left]

. Open the *Services* tab, on the *Restore* dialog, and specify the services whose data is to be restored &#8212; unchecking the checkbox for each service whose data is not required.
For example:
+
image:manage-backup-restore/restoreUncheckCheckboxes.png[,240,align=left]

. Open the *Advanced Restore Options* tab, on the *Restore* dialog.
The dialog expands vertically, revealing the following fields:
+
image:manage-backup-restore/restoreAdvancedOptionsInitial.png[,420,align=left]
+
These fields allow selection of documents to be restored on the basis of the data they contain.
Documents that meet the specified criteria are included in the data-restoration; those that do not are omitted from it.
+
Use of these fields is optional: if all data in the specified backups is to be restored, leave these fields blank.
If only some data should be restored, proceed as follows:
+
In the *Filter Keys* field, add a _regular expression_ that must be matched by a document's _key_, if the document is to be included in the restoration.
For example, `^airline` ensures that only a document whose key begins with the string `airline` is included.
+
In the *Filter Values* field, add a regular expression that must be matched by a _value_ within the document, if the document is to be included in the restoration.
For example, `MIL*` ensures that only a document that contains at least one key-value pair whose value contains the string `MIL` followed by zero of more characters is to be included in the restoration.
+
In the *Map Data* field, indicate whether the data is to be restored to its original or to a different bucket.
If this field is left blank, data is restored to its original bucket: note that this bucket must continue to exist on the cluster.
If data is to be restored to a different bucket, that bucket must either already have been defined on the cluster, or must be created by means of the *Auto-create bucket* option, described below.
+
For example, if data to be restored from `travel-sample` should be restored to `ts`, enter `travel-sample=ts`.
+
Use the *Include Data* and *Exclude Data* fields to indicate the subset of buckets whose data is to be restored.
For example, if backups to be restored were made when the cluster had four buckets defined, named `bucket1`, `bucket2`, `bucket3`, and `bucket4`, entering `bucket1,bucket4` in the *Include Data* field ensures that only data from `bucket1` and `bucket4` is restored; while entering `bucket2,bucket3` in the *Exclude Data* field ensures that data from `bucket2` and `bucket3` is not restored. Note that these options are intended for use on backups that included all buckets on the cluster: they are not required when the backup was made of one bucket only.
+
Check the *Force Updates* field to ensure that data restored from the specified backup  overwrites the current values on the cluster when the current values are the more recent.
If the *Force Updates* checkbox is not checked, current values are not overwritten if more recent.
+
Check the *Auto-remove Collections* checkbox to omit from the restoration any scope or collection that has been removed from the cluster since the backup was performed.
(Note if a data-containing, administrator-created collection is backed up, but is then deleted from the cluster with all its data, the deleted data will not be restored by the *Restore* operation: however, the empty collection _will_ be restored by the *Restore* operation, unless the *Auto-remove Collections* checkbox is checked, prior to the *Restore* operation.)
+
Check the *Auto-create Buckets* checkbox to create any buckets to which the restoration has been mapped that do not yet exist on the target cluster.
+
For example, the *Restore* dialog may now appear as follows:
+
image:manage-backup-restore/restoreDialogComplete.png[,420,align=left]
+
Value are thus specified for filtering documents on a basis of both key and value.
The data to be restored from `travel-sample` is specified to be restored to a bucket named `ts`, which has not previously been created: therefore, the *Auto-create Buckets* checkbox has been checked.

. Left-click on *Restore*.
This triggers the specified restoration.
The dialog disappears; and a green restore-notification appears, at the lower left of the console.

Subsequent to the operation, its results can be checked; by means of the *Buckets* screen of Couchbase Web Console, which might now appear as follows:

image:manage-backup-restore/newBucketWithRestoredData.png[,720,align=left]

A new bucket, named `ts`, has thus been created.
Its item-count indicates that it contains only a subset of the documents contained in `travel-sample`, in accordance with the filtering specified for the restore operation.

[#archive-backups]
== Archive Backups

[#import-repositories]
== Import Repositories

[#inspect-plans]
== Inspect Plans

[#review-scheduling-options]
== Review Scheduling-Options

[#using-cloud-storage]
== Use Cloud Storage
