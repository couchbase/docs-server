= Manage Backup and Restore
#:page-aliases: backup-restore:backup-restore

[abstract]
Couchbase Server allows one or more buckets, and selected subsets of their data, to be backed up, restored, and archived.

[#understanding-backup-and-restore]
== Understanding Backup and Restore

The data on a Couchbase-Server cluster can be backed up, restored, and archived by means of either of the following:

* The UI provided on the *Backup* facility of Couchbase Web Console.

* The `cbbackupmgr` CLI utility.

The technology that underlies the *Backup* facility of Couchbase Web Console is in fact provided by `cbbackupmgr`: note, however, that `cbbackupmgr` provides some features that are not available from the UI.
For use of either interface, the Full Admin role must have been assigned.
On Couchbase Server 7.0 and above, both interfaces are available in both the Enterprise and the Community Edition.
Both support use of AWS S3 storage.

Note that two additional tools, `cbbackup` and `cbrestore`, continue to be available in Couchbase Server 7.0: however, both are deprecated.

[#differences-between-the-ui-and-cbbackupmgr]
=== Backup and Restore: UI versus CLI

The UI provided by the *Backup* facility of Couchbase Web Console allows backup, restore, and archiving to be configured for the local cluster; and also permits restore to be configured for a remote cluster.
By contrast, `cbbackupmgr` allows backup, restore, and archiving each to be configured either for the local or for a remote cluster: all available options are listed in xref:backup-restore:enterprise-backup-restore.adoc##version-compatibility[Version Compatibility].

Both the UI and `cbbackupmgr` allow either _full_ or _incremental_ backups to be scheduled.
Both allow incremental backups, once created, to be merged, and their data deduplicated.
Both use the same backup archive structure; and allow the contents of backups to be listed, and specific documents to be searched for.

For detailed information on how `cbbackupmgr` works (including a detailed description of incremental backup), see the xref:backup-restore:cbbackupmgr.adoc#discussion[Discussion] provided on the page for xref:backup-restore:cbbackupmgr.adoc[cbbackupmgr].
The page for xref:backup-restore:cbbackupmgr.adoc[cbbackupmgr] also provides a synopsis of the command, and a description of its basic options; and is co-located with additional pages that provide information on specific subcommands for collecting logs, compacting, merging, and more.

The remainder of the current page describes how to perform backup, restore, and archiving by means of the UI.

[#performing-backup-management-with-the-ui]
== Performing Backup Management with the UI

Proceed as follows:

. On Couchbase Web Console, left-click on the *Backup* tab, in the right-hand, vertical navigation bar:
+
image::manage-backup-restore/accessBackupTab.png[,100,align=left]
+
This brings up the *Respositories* screen of the *Backup* facility.
The initial appearance is as follows:
+
image::manage-backup-restore/backupScreenInitial.png[,720,align=left]
+
The screen features three panels, for *Active*, *Imported*, and *Archived Repositories* respectively.
Currently, all panels are blank.

. Choose to add a repository.
A _repository_ is a folder into which data will be copied as a backup.
Each defined repository should be given a unique name.
To add a repository, left-click on the *ADD REPOSITORY* tab, at the upper right of the screen:
+
image::manage-backup-restore/addRepositoryTab.png[,140,align=left]
+
This brings up the *Select plan* dialog, which initially appears as follows:
+
image::manage-backup-restore/selectPlanDialog.png[,420,align=left]

. Specify whether to use a default or a custom plan.
A _plan_ determines what kind of backup is to occur, affecting what data, and on what schedule.
Left-click on the control that appears at the right-hand side of the *Select plan* dialog's interactive text-field.
A pull-down menu appears, as follows:
+
image::manage-backup-restore/selectPlanDialogPullDownMenuInitial.png[,420,align=left]
+
Three options are thus provided.
The first two are *_daily_backups* and *_hourly_backups*: these are default plans that, as their names indicate, provide backups that are respectively daily and hourly.
The third option is *+ Create new plan*: select this option:
+
image::manage-backup-restore/selectPlanDialogPullDownMenuSelection.png[,140,align=left]
+
This establishes the string *+ Create new plan* within the interactive text field.
To confirm, left-click on the *Next*, button, at the lower-right of the dialog:
+
image::manage-backup-restore/selectPlanDialogPullDownMenuNext.png[,420,align=left]
+
The brings up the *Create Plan* dialog, which appears as follows:
+
image::manage-backup-restore/createPlanDialog.png[,420,align=left]

. Create a custom plan.
In the *Name* field of the *Create Plan* dialog, enter a name for the plan that is to be created.
The name must be unique across the cluster, can only use the characters `[`, `]`, `A` to `Z`, `a` to `z`, `&#95;` and `-`; and must not start with either `&#95;` or `-`.
+
Then, optionally, add a description for the plan in the *Description* field: the description can be up to 140 characters in length.
For example, to specify a plan for hourly backups, the following might be entered:
+
image::manage-backup-restore/createPlanDialogWithInitialInput.png[,420,align=left]
+
Next, specify the services for which data will be backed up.
Left-click on the *Services* control: this expands the dialog, and displays a complete list of Couchbase Services, each being accompanied by a checkbox.
+
image::manage-backup-restore/createPlanServicesListInitial.png[,90,align=left]
+
To specify that only data for the Data and Index Services should be backed up, uncheck the boxes for all the other services.
+
Next, to specify precise details of what should occur when the backup is run, left click on the *Add Tasks* button.
The dialog now expands, to reveal the following fields:
+
image::manage-backup-restore/createPlanDialogAddTaskFields.png[,420,align=left]
+
The fields permit the input of data to specify the details of a particular task, referred to as *Task 1*.
Note that the dialog permits multiple tasks to be specified, by means of the *Add Task* button, at the lower left.
+
In the *Name* field, enter an appropriate name for the task: for example, *hourlyBackup*.
+
The *Period* field allows specification of the frequency of the task.
If the default selection, *Simplified*, is chosen, this specifies a daily backup according to details added lower in the *Task 1* panel.
To choose a specific frequency, access the control at the right-hand of the *Period* field.
A pull-down menu appears:
+
image::manage-backup-restore/periodPullDownMenu.png[,420,align=left]
+
From the pull-down menu, select *Hours*, to indicate that the frequency should be determined in units of hours.
+
In the *Type* field, specify the task to be performed, by accessing the control at the right-hand side of the field.
This displays the following pull-down menu:
+
image::manage-backup-restore/typePullDownMenu.png[,420,align=left]
+
Select *Backup*, from the pull-down menu.
(Note that this duly removes from the dialog the day-specification controls associated with *Simplified*.)
Then, in the *Frequency* field, specify the frequency with which the task should be performed.
The field only accepts integers.
To specify that the task be performed hourly, enter *1*.
+
In the *Time* field, specify a time of day at which the task is to be run.
The time of day must be specified as hours and minutes, separated by a colon.
Note that when the frequency-unit specified is *Minutes*, this field takes no input.
When the frequency-unit specified is *Hours* (as is the case in the current example), only the numbers signifying minutes (those after the colon) are used.
To ensure that the hourly task is performed on the hour, leave these numbers as *00*.
+
To complete specification of *Task 1*, determine whether the backup to be performed is *Full* or *Incremental*.
If it is to be *Full*, check the *Full Backup* checkbox.
If it is to be *Incremental* (as should be the case in the current example), leave the checkbox unchecked.
+
The dialog now appears as follows:
+
image::manage-backup-restore/taskPanelComplete.png[,420,align=left]
+
At this stage, if another task is to be specified, the *Add Task* button should be clicked on: this expands the dialog further, and provides another set of task-specification fields, for *Task 2*.
If the task already added is to be removed, left-click on the *Cancel* button: this discards the data that has been added for *Task 1*, and closes the task-panel.
If the specification of the plan is to be abandoned, left-click on the *Cancel* tab, at the lower right.
If the specification for *Task 1* is to be retained and used, and no other task is to be specified (as is the case in the current example), left-click on the *Next* button:
+
image::manage-backup-restore/nextButton.png[,90,align=left]
+
This brings up the *Create Repository* dialog, which appears as follows:
+
image::manage-backup-restore/createRepositoryDialogInitial.png[,420,align=left]
