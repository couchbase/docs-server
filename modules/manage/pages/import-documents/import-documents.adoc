= Import Documents

[abstract]
Couchbase Web Console provides a graphical interface for the importing of documents, in both JSON and other formats.

[#importing-documents]
== Options for Importing Documents

Documents can be imported into Couchbase Server by means of the following:

* The *cbimport json* command-line utility, which imports JSON documents.

* The *cbimport csv* command-line utility, which imports documents that contain data in CSV and other similar formats.

* The interactive controls provided in the Couchbase Web Console *Import Documents* panel, itself located on the *Documents* screen; allowing import of both JSON and CSV-like files.

The *cbimport json* and *cbimport csv* command-line utilities should be used in preference to Couchbase Web Console, whenever high-performance importing is required; and especially when the data-set to be imported is greater in size than 100 MB.

For information on the *cbimport* suite of command-line utilities, access the *cbimport* entry, in the *CLI Reference*, in the vertical navigation bar, to the left.
The remainder of this page explains how to import documents by means of Couchbase Web Console.
Note the following prerequisites:

* Documents must be imported into a specific bucket.
Therefore, before attempting to import, ensure that an appropriate bucket exists.
If necessary, create a bucket, following the instructions provided in xref:manage:manage-buckets/create-bucket.adoc[Create a Bucket].
The following instructions assume that a bucket named `testBucket` has been created.

* Before attempting to import documents with Couchbase Web Console, ensure that the *Query Service* has been deployed on the cluster: document-import with Couchbase Web Console depends on this service.

[#access-the-import-documents-panel]
== Accessing the Import Documents Panel

Access the *Import Documents* panel of Couchbase Web Console, as follows:

. Left-click on the *Documents* tab, in the left-hand navigation bar:
+
image::import-documents/accessDocumentsTab.png[,120,align=left]

. When the *Documents* screen appears, select the *Import Documents* tab, on the horizontal navigation bar, near the top:
+
image::import-documents/accessImportDocumentsTab.png[,400,align=left]

The *Import Documents* panel is now displayed:

image::import-documents/importDocumentsPanel.png[,720,align=left]

[#understanding-the-import-documents-panel]
== Understanding the Import Documents Panel

The *Import Documents* panel displays the following interactive graphical elements:

* *Select File to Import...*.
A button that, when left-clicked on, displays a file-selection interface, whereby the file to be imported into Couchbase Server can be retrieved from the filesystem.

* *Parse File As*.
This field displays the _type_ of the imported file.
The displayed, default value is *CSV*.
However, when the user left-clicks on the *Select File to Import...* button, Couchbase Server automatically determines the type of the selected file; and duly displays the file-type in this field, with the number of _records_ found in the file displayed to the right of the field.
+
However, should automatic file-type recognition result in the display of an incorrect file-type, the control at the right-hand side of the field can be used, to display a pulldown menu; which allows user-selection of the correct file-type.
The menu appears as follows:
+
image::import-documents/parseFileAsMenu.png[,300,align=left]
+
The options, *CSV*, *TSV*, xref:manage:import-documents/import-documents.adoc#import-a-json-list[JSON List], and *JSON Lines*, are described in the subsections below.

* *Destination Bucket*.
A pulldown menu, which displays all buckets available on the cluster.
The selected bucket is the one into which import of the select file is to occur.
For example:
+
image::import-documents/destinationBucketSelectTestBucket.png[,320,align=left]

* *Import With Document ID*.
Two radio-buttons, which allow specification of how the _id_ of the newly imported document is to be determined.
The *UUID* option specifies that a _Universal Unique Identifier_ be generated automatically, and used as the document's id.
The *Value of Field* option specifies that the _value_ that corresponds to a particular _field_ within each document should be used as the document's _id_: this option is only activated _after_ a document has been selected for import, such that its fields can be accessed and corresponding values determined.
Selecting this option displays a pulldown menu, which lists those fields that are common to each document within the field.
Only those fields that contain values expected to be _unique_ across the destination bucket should be selected.
+
Both of these options are demonstrated and explained further in the subsections below.

* The *cbimport* command-line display.
This display changes dynamically, to indicate the underlying command that is being prepared for execution; in correspondence with the user's ongoing addition of parameter-values into the UI.

* *File Contents*.
A read-only panel that displays the contents of the imported file.
The panel provides three display options: these are *Raw File*, which displays the unformatted file-contents; *Parse Table*, which shows the file-contents as a table, with rows and columns; and *Parse JSON*, which shows the file as formatted JSON.

* *Import Data*.
This button is to be left-clicked on, when all appropriate details of the file to be imported have been entered: data-import is then commenced.
Status on the operation is displayed immediately below the button.
Note that if the operation takes a long time, the button's label is changed to *Cancel*; at which point, by left-clicking, the user can cancel the import operation.

[#import-a-json-list]
== Importing a JSON List

To import one or more JSON documents, the documents must be specified in a file, and the file then specified as the target for import.
The documents can be specified in either of two ways: as a _list_, or as a series of _lines_.

To import a JSON _list_, proceed as follows.

. Save the following JSON list, as a file named `list.json`:
+
[source,json]
----
[
  {"name": "jane", "age": 22, "height": 5.2, "weight": 97},
  {"name": "jack", "age": 18, "height": 5.9, "weight": 138},
  {"name": "henry", "age": 47},
  {"name": "susan", "age": 35, "height": 5.1, "weight": 110, "birth": {"dayOfBirth": 17, "monthOfBirth": 4}},
  {"name": "david", "age": 43, "height": 5.11, "weight": 195, "birth": {"dayOfBirth": 3, "monthOfBirth": 12}}
]
----
+
The file thus contains a JSON array of six elements.
Each element is a document, containing multiple key-value pairs.

. Within the *Import Documents* panel, left-click on the *Select File to Import...* button:
+
image::import-documents/selectFileToImport.png[,320,align=left]
+
The brings up the file-selection interface specific to the host operating system.
Use this to select the file targeted for import.
For example:
+
image::import-documents/fileSelectionInterface.png[,200,align=left]
+
When the file `list.json` has been selected, the *Import Documents* panel appears as follows:
+
image::import-documents/importDocumentsWithInitialContent.png[,720,align=left]
+
The filename `list.json` now appears to the right of the *Select File to Import...* button.
The *Parse File As* menu displays *JSON List*, indicating that Couchbase Server has correctly recognized the file type.
To the upper right of the *Parse File As* field, the number of records found in the file is displayed.
+
Note that, under *Import With Document ID*, the *Value of Field* option has now become activated; and displays, as a default choice, a common _field_ it has encountered, which is `name`.
+
Note also that the *cbimport* command-line display has changed, to incorporate the information so far entered by means of the user-interface fields.
+
The *File Contents* field now shows the file contents &#8212; by default, as a *Parsed Table*.

. Specify a destination bucket, using the *Destination Bucket* menu.
In this case, `testBucket` is selected:
+
image::import-documents/destinationBucketSelectTestBucket.png[,320,align=left]
+
The selection is then duly represented in the *Destination Bucket* field:
+
image::import-documents/destinationBucketAfterBucketSelection.png[,320,align=left]

. Select a form of _id_ for the documents to be imported.
The *Import With Document ID* field provides two radio buttons.
*UUID* specifies that an id is automatically generated for each document, by Couchbase Server.
*Value of Field* allows choice of a field, common to all the listed documents: the value of the field, as it appears in each individual document, will be used as that document's id.
+
Note that *Value of Field* should only be used if each value for the field is expected to be unique across the bucket into which the documents are imported: if the value is _not_ unique, the document previously stored in Couchbase Server is overwritten by any newly imported document that has the same id.
+
Leave the default selection, *UUID*, unchanged.
+
The *Import Documents* panel now appears as follows:
+
image::import-documents/importDocumentsWithSubsequentContent.png[,720,align=left]
+
Note that the *cbimport* command-line display now confirms `testBucket` as the bucket into which the data will be imported.
+
Optionally, the *File Contents* can now be displayed in the available, alternative forms.
To display `list.json` as unformatted JSON, left-click on the *Raw File* tab:
+
image::import-documents/rawFileTab.png[,190,align=left]
+
The file `list.json` now appears, unformatted, in the *File Contents* panel:
+
image::import-documents/fileContentsRawFile.png[,600,align=left]
+
Alternatively, left-click on the *Parsed JSON* tab:
+
image::import-documents/parsedJSONTab.png[,190,align=left]
+
The *File Contents* pane now shows a parsed version of the file `list.json`, the initial section of which appears as follows:
+
image::import-documents/fileContentsAsParsedJSON.png[,600,align=left]

. Import the file.
Left-click on the *Import Data* button, located in the lower center area of the *Import Documents* panel.
+
image::import-documents/leftClickOnImportButton.png[,190,align=left]
+
The documents in the specified file are now imported.
If the operation is successful, a notification appears immediately below the *Import Data* button:
+
image::import-documents/importButtonWithNotification.png[,190,align=left]

. Check the imported documents.
Left-click on the *Document Editor* tab, on the horizontal, upper navigation bar:
+
image::import-documents/leftClickOnDocumentEditorTab.png[,380,align=left]
+
This brings up the *Document Editor* panel, which now appears as follows:
+
image::import-documents/documentEditorWithImportedDocuments.png[,720,align=left]
+
The five documents contained in the file `list.json` have been successfully imported.
Each has been automatically assigned an id.
The documents can now be inspected and edited, by means of the facilities of the *Document Editor*.

[#importing-json-lines]
== Importing JSON Lines

A _JSON Lines_ file is one that contains one or more JSON documents, each on a separate line; with the carriage return being the only separator.
To import such a file, proceed as follows:

. Save the following JSON lines file, as `lines.json`:
+
----
{"lastName": "smith", "employeeNumber": "0003456"}
{"lastName": "roberts", "employeeNumber": "0007584"}
{"lastName": "jones", "employeeNumber": "0005811"}
{"lastName": "davis", "employeeNumber": "0009324"}
----
+
The file thus contains three objects, each is which appears on its own line.
Two of the objects contain the same six fields.
The third object contains five of those fields &#8212; missing the field `homeWorker`.

. Access the *Import Documents* panel of the *Documents* screen.

. Left-click on the *Select File to Import...* button, and select the `lines.json` file.
On selection, the *Parse File As* field reads *JSON Lines*, and the *File Contents* field displays the following:
+
image::import-documents/fileContentsWithJSONlinesParsedTable.png[,680,align=left]

. Select `testBucket` as the value of *Destination Bucket*.

. In the *Import With Document ID* panel, select the *Value of Field* option, and display the pulldown menu.
This appears as follows:
+
image::import-documents/importWithEmployeeNumber.png[,440,align=left]
+
Select *employeeNumber*, as the value to be used for each document's id.

. Import the document, by left-clicking on the *Import Data* button.

. Examine the imported documents, by accessing the *Document Editor* tab.
The documents appear as follows:
+
image::import-documents/importedDocumentsWithEmployeeNumberID.png[,720,align=left]

Thus, each document has been imported, with its `employeeNumber` value as the id of the document.

[#importing-csv-and-tsv-files]
== Importing CSV and TSV Files

To import a CSV (_comma-separated values_) file, proceed as follows:

. Save the following, as `employees.csv`:
+
----
lname,empno
smith,0003456
roberts,0007584
jones,0005811
davis,0009324
----

. Access the *Import Documents* panel, and use the select `employees.csv` for import, by means of the *Select File to Import...* button.
The panel now appears as follows:
+
image::import-documents/importDocumentsWithCSVprepared.png[,720,align=left]

. Specify `testBucket` as *Destination Bucket*, and, under *Import With Document ID*, specify `empno` as *Value of Field*.

. Left-click on the *Import Data* button.
The documents are imported, with the value of `empno` used as the id for each.

. Check the appearance of the documents, in the *Document Editor* panel.

To import a TSV (_tab-separated values_) file, follow the same procedure, with a file named `employees.tsv`, containing the following:

----
lname     empno
smith     0003456
roberts	  0007584
jones	  0005811
davis	  0009324
----

[#handling-errors]
== Handling Errors

If the contents of a file select for import are inconsistent, Couchbase Server displays an error notification.
For example:

* *JSON Parse Errors*.
+
image::import-documents/jsonParseErrors.png[,420,align=left]
+
Displayed when the JSON within a file is incorrect.
For example, the JSON of a particular document is flawed (possibly due to a missing or redundant comma, or a missing curly brace); or the JSON array with a _list_ file is missing a square bracket; or more than one document within a _lines_ file appears on the same line.

* *Import Warning: No Records Found*
+
image::import-documents/importWarning.png[,420,align=left]
+
Displayed when no records can be found within the specified file.
This may be due to a file-naming error: for example, a JSON _list_ has been saved as a `*.lines` file.

* *Import Warning: Data-Type Unrecognized*
+
image::import-documents/importWarning2.png[,420,align=left]
+
Displayed when Couchbase Server cannot identify the data within the file as being of any supported type.

In each case, to remedy the problem, inspect the data within the file, ensure that it is properly formatted per document, and correctly laid out in accordance with the file-type; then retry.
