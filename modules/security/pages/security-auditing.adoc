= Auditing

[abstract]
Actions performed on Couchbase Server can be _audited_.
This allows a full administrator to ensure that system-management tasks are being appropriately performed.
This potentially facilitates compliance with regulatory standards.

== Audit Records and their Content

The records created by the Couchbase Auditing facililty capture information on _who_ has performed _what_ action, _when_, and _how_ successfully:

* _Who_: The administrator performing actions.
To access the system, each administrator has authenticated, either locally or by means of LDAP: and is therefore identifiable throughout their session.

* _What_: The action performed.
30 different kinds of action are tracked by Couchbase Server.

* _When_: The UTC time stamp that corresponds to each recorded action.

* _How_: The success or failure of the action.

Audit records are created by Couchbase Server-processes, which run asynchronously.
Each record is stored as a JSON file, which can be retrieved and inspected.

Note that event-auditing occurs on a _per node_ basis: each node captures its own events only.
If a cluster-wide record is needed, the individual per node records must be manually consolidated by the administrator.

== Audit Configuration

Only a _Full Administrator_ can configure auditing.
Configuration is performed by means of the Couchbase Web Console.
Proceed as follows.

Access the Couchbase Web Console, and left-click on the [.ui]*Security* tab, in the vertical navigation-bar, at the left-hand side of the Dashboard:

[#security-tab-with-hand-cursor]
image::pict/securityTabWithHandCursor.png[,110,align=left]

This brings up the [.ui]*Security* screen, which appears as follows:

[#security-view-initial-no-users]
image::pict/securityViewInitialNoUsers.png[,820,align=left]

The initial, default view is for [.ui]*Users*.
To select auditing, left-click on the [.ui]*Audit* tab, on the horizontal control-bar, near the top:

[#audit-tab]
image::pict/auditTab.png[,140,align=left]

This brings up the [.ui]*Audit* view:

[#audit-view]
image::pict/auditView.png[,820,align=left]

To enable auditing, check the [.ui]*Enable Auditing* checkbox:

[#enable-auditing]
image::pict/enableAuditing.png[,100,align=left]

This makes the default pathname within the [.ui]*Target Log Directory* text-field editable.
If you wish to modify the pathname, enter the appropriate content.
Records will be saved to the directory you specify.

The [.ui]*Log Rotation Time Interval* determines how often stored log files — referred to as _targets_ — are _rotated_: this means that the current default file, to which records are being written, named `audit.log` is saved under a new name, which features an appended timestamp.
For example: _usermachinename_`.local-2017-03-16T15-42-18-audit.log`.

The number of units is specified by changing the number `1`, which appears in the interactive field by default.
The unit-type is specified by means of the pull-down menu, at the right-hand side of the field:

[#set-rotation-time-interval]
image::pict/setRotationTimeInterval.png[,230,align=left]

Note that the value you establish must be in the range from 15 minutes to 7 days.

== Configuring with CLI

The following CLI syntax is used to configure Couchbase auditing for administrators:

----
couchbase-cli
          setting-audit  OPTIONS
          --audit-log-rotate-interval=[MINUTES]     //log rotation interval
          --audit-log-path=[PATH]                   //target log directory
          --audit-enabled=[0|1]                     //enable auditing or not
----

See xref:cli:cbcli/couchbase-cli-setting-audit.adoc[setting-audit] for details.

== Understanding Audit Events

_Audit events_ are defined by Couchbase, and are automatically generated when auditing is enabled, in correspondence with defined actions.
Corresponding data is written to target-files.
For a complete list of events, see the section xref:security-audit-events.adoc[Audit Events].
