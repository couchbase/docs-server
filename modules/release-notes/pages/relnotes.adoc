= Release Notes for Couchbase Server 5.5.x

Couchbase Server 5.5.x is a significant update of the Couchbase Data Platform.
This release specifically highlights agility, performance, and manageability and includes enhancements to existing services as well as new server and SDK components.

Take a look at xref:introduction:whats-new.adoc[What's New?] for a list of new features and improvements that are available in this release.

[#release-556]
== Release 5.5.6

Couchbase Server 5.5.6, released in November 2019, is the sixth maintenance release in the 5.5.x series for Couchbase Server.
This maintenance release includes bug fixes and improvements on multiple components.

[#fixed-issues-556]
=== Fixed Issues

==== Data Service

[#table_fixedissues_data_556,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-35717[MB-35717^]
| Fixed handling of SSL_ERROR_WANT_WRITE.

| https://issues.couchbase.com/browse/MB-35702[MB-35702^]
| SSL write failures may not reset the connection in the write phase. This has been fixed by propagating SSL write errors from sendmsg.

| https://issues.couchbase.com/browse/MB-35593[MB-35593^]
| Extended logging for SSL read/write failures.
|===

==== Cluster Manager

[#table_fixedissues_cluster-manager_556,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-35748[MB-35748^]
| Fixed an issue where, under unknown circumstances, leader_lease_acquirer would hang trying to shutdown worker. 
 
| https://issues.couchbase.com/browse/MB-29525[MB-29525^]
| Added the ability to filter internal users for logging audit events.
|===

==== Index Service

[#table_fixedissues_index_556,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-36600[MB-36600^]
| Fixed an issue in the index service which caused it to crash continuously. 

| https://issues.couchbase.com/browse/MB-36575[MB-36575^]
| Fixed an issue that caused the Plasma storage engine to grow indefinitely. 

| https://issues.couchbase.com/browse/MB-36298[MB-36298^]
| A StreamEnd message for a vBucket can be processed before a StreamBegin message in feed's backch. This lead to inconsistent book-keeping and caused the index service to enter an infinite loop. This has been fixed.

| https://issues.couchbase.com/browse/MB-36273[MB-36273^]
| The ForestDB reserve bitmap revision number was not set correctly and caused cbbackupmgr merge to fail. This has been fixed.

| https://issues.couchbase.com/browse/MB-36052[MB-36052^]
| Index creation failed as the index service was unable to create index replicas. This has been fixed.

| https://issues.couchbase.com/browse/MB-35804[MB-35804^]
| Running COUNT on an index FullScan returned incorrect results when it included DESC order. This has been fixed by updating the code to handle Inclusion getting flipped due to the DESC order.

| https://issues.couchbase.com/browse/MB-35473[MB-35473^]
| Fixed an issue that caused a Write Bucket Failure and corrupted the vBucket file.

| https://issues.couchbase.com/browse/MB-35323[MB-35323^]
| Fixed an issue in ForestDB where renaming a compacted file led to the file getting deleted.

| https://issues.couchbase.com/browse/MB-34455[MB-34455^]
| Fixed a memory allocation failure in Forestdb that caused a system crash under pressure.

| https://issues.couchbase.com/browse/MB-34167[MB-34167^]
| Fixed an issue where new index builds remained stuck if indexes on MAINT_STREAM were dropped before indexes on INIT_STREAM during rebalance.

| https://issues.couchbase.com/browse/MB-34165[MB-34165^]
| Fixed an issue where the index node crashed with too many open files.
|===

==== Query Service

[#table_fixedissues_query_556,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-36433[MB-36433^]
| Fixed an issue that caused a drop in throughput for array queries.

| https://issues.couchbase.com/browse/MB-35811[MB-35811^]
| Fixed a connection pool leak observed when querying system:indexes.

| https://issues.couchbase.com/browse/MB-35732[MB-35732^]
| Some proactive fixes around covered queries delivered in release 5.5.5 were observed to cause regressions and hence have been reverted in this release. The reverted issues are MB-35392, MB-34666, and MB-34660.

| https://issues.couchbase.com/browse/MB-34750[MB-34750^]
| Avoid IntersectScan when the index is a subset.

| https://issues.couchbase.com/browse/MB-34426[MB-34426^]
| Fixed an issue where the query engine returned incorrect results when using a partition index and the ORDER BY clause.
|===

==== Security

[#table_fixedissues_security_556,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-36391[MB-36391^]
| The Mochiweb acceptors would hang forever if TLS handshake froze. This has been fixed by setting a timeout for TLS handshake. 
|===

==== Tools, Web Console (UI) and REST API

[#table_fixedissues_tools-ui_556,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-36316[MB-36316^]
| The `couchbase-cli` utility now works with secure connection and CA verification.
|===

[#release-555]
== Release 5.5.5

Couchbase Server 5.5.5, released in July 2019, is the fifth maintenance release in the 5.5.x series for Couchbase Server.
This maintenance release includes bug fixes and improvements on multiple components.

[#fixed-issues-555]
=== Fixed Issues

==== Cross Datacenter Replication (XDCR)

[#table_fixedissues_xdcr_555,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-34297[MB-34297^]
| Fixed an issue so that XDCR no longer deletes replication specs incorrectly during transient rebalancing states.
If the target bucket is removed, XDCR will still remove the replication spec using a non-topology-change-detector module. This removal mechanism is more fail-safe.
|===

==== Cluster Manager

[#table_fixedissues_cluster-manager_555,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-34140[MB-34140^]
| Fixed broken rebuild_replicas script.
|===

==== Data Service

[#table_fixedissues_data_555,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-34507[MB-34507^]
| Fixed an issue where documents with a TTL, containing system XATTRs, and which are compressed, may have their datatype metadata incorrectly set. This prevents any subsequent modification of the XATTRs on the deleted document, until the document is re-created.

| https://issues.couchbase.com/browse/MB-34329[MB-34329^]
| Reset snapshot range to be a valid range.

| https://issues.couchbase.com/browse/MB-33906[MB-33906^]
| Fixed an issue where the response to a getReplica command could be significantly delayed.
|===

==== Index Service

[#table_fixedissues_index_555,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-34624[MB-34624^]
| The index service now uses CountTotal for count aggregate on full index scan (leading key, no group by). This improves query performance as the count is precomputed.

| https://issues.couchbase.com/browse/MB-34406[MB-34406^]
| Fixed a memory leak caused by snapshot metadata objects linked list references.
|===

==== Install and Upgrade

[#table_fixedissues_installer_555,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-34638[MB-34638^]
| Fixed an issue that caused Couchbase Server to take > 130% CPU while idle on Mac OS.

| https://issues.couchbase.com/browse/MB-34419[MB-34419^]
| Couchbase Server versions 5.5.3 and 5.5.4 failed to start on Mac OS platform due to an issue in the startup script. The startup script has been updated in version 5.5.5. 

Note that Mac OS packages for versions 5.5.3 and 5.5.4 have been removed from the Downloads page. We recommend that you upgrade to the latest maintenance release on a given series to avail the bug fixes and improvements. 
|===

==== Query Service

[#table_fixedissues_query_555,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-34666[MB-34666^]
| Better identifier handling to determine whether an identifier should be covered or not.

| https://issues.couchbase.com/browse/MB-34665[MB-34665^]
| Avoid IntersectScan when the index is a subset.

| https://issues.couchbase.com/browse/MB-34660[MB-34660^]
| Fixed an issue where the implicit cover of nested array did not work as expected with arbitrary variables.

| https://issues.couchbase.com/browse/MB-34544[MB-34544^]
| The query service now generates a special error for subquery build failures and sets the HTTP error code appropriately.
|===

==== Tools, Web Console (UI) and REST API

[#table_fixedissues_tools-ui_555,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-34224[MB-34224^]
| Updated information on adding roles to a user.

| https://issues.couchbase.com/browse/MB-34126[MB-34126^]
| The `couchbase-cli` tool no longer enforces the 24 character password limit.
|===

[#release-554]
== Release 5.5.4

Couchbase Server 5.5.4, released in April 2019, is the fourth maintenance release in the 5.5.x series for Couchbase Server.
This maintenance release includes fixes to the data, index, and query services, and XDCR, tools, and UI components.

[#fixed-issues-554]
=== Fixed Issues

==== Cross Datacenter Replication (XDCR)

[#table_fixedissues_xdcr_554,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33675[MB-33675^]
| Following an issue on a remote cluster, XDCR failed to recover and threw an exception.

| https://issues.couchbase.com/browse/MB-32658[MB-32658^]
| XDCR failed to replicate files larger than the network usage limit. This has been fixed so the bandwidth throttler can handle large documents with sizes greater than the usage limit.

| https://issues.couchbase.com/browse/MB-32222[MB-32222^]
| Fixed an issue where the XDCR log level setting was not retained when upgrading Couchbase Server from version 4.x to newer version.

| https://issues.couchbase.com/browse/MB-32218[MB-32218^]
| Added timeout to replication startup sequence.

| https://issues.couchbase.com/browse/MB-32217[MB-32217^]
| Fixed the heartbeat mechanism to detect when an XDCR rest server was stuck.
|===

==== Data Service

[#table_fixedissues_data_554,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33853[MB-33853^]
| Fixed a race condition that was exposed when a supervisor that is shutting down normally, is for some reason brutally shutdown leaving an orphan child process. This rogue lease acquirer interfered with the operation of the orchestrator causing, for instance, rebalance to fail.

| https://issues.couchbase.com/browse/MB-33852[MB-33852^]
| Memcached returned ENGINE NOT_STORED to client after trying to perform arithmetic operations and caused a race condition.

| https://issues.couchbase.com/browse/MB-33773[MB-33773^]
| Fixed an issue that caused a race condition between DCP consumer message processing and stream shutdown.

| https://issues.couchbase.com/browse/MB-33351[MB-33351^]
| Fixed an issue where the breakpad did not catch the memcached segfault (exit status 139).

| https://issues.couchbase.com/browse/MB-32840[MB-32840^]
| Fixed an issue where the audit daemon asserted when rotating an empty audit log causing a crash.

| https://issues.couchbase.com/browse/MB-32696[MB-32696^]
| Fixed an issue so that when an on connection error is encountered, certain operations are retried before returning an error.

| https://issues.couchbase.com/browse/MB-32685[MB-32685^]
| Introduced a delay in updating the RBAC database revision number to avoid returning AUTH_STALE during a refresh of the RBAC database.

| https://issues.couchbase.com/browse/MB-32669[MB-32669^]
| Fixed an issue where a chain of events, active compression of an extended attribute value followed by eviction and then expiry, triggered an exception.

| https://issues.couchbase.com/browse/MB-32660[MB-32660^]
| If an append/prepend request contended with another request at the Server, instead of automatically retrying on the Server (as expected), it returned EEXISTs back to the application.

| https://issues.couchbase.com/browse/MB-32656[MB-32656^]
| Added audit trail for the connected bucket.

| https://issues.couchbase.com/browse/MB-32637[MB-32637^]
| Fixed an issue where CAS value 0 was returned for a successful Append response.

| https://issues.couchbase.com/browse/MB-15009[MB-15009^]
| Defragment document StoredValue in addition to blobs to help cases where a large number of documents with a given key size are deleted, and then new documents are allocated with a different key size. In this case the original size class would not be able to be reused, and hence fragmentation could be high in that class.
|===

==== Index Service

[#table_fixedissues_index_554,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33664[MB-33664^]
| It was possible to create an index with fewer replicas than the default num_replicas if you used nodes_list in the WITH clause with fewer nodes than the default number of replicas.

| https://issues.couchbase.com/browse/MB-33653[MB-33653^]
| Fixed an issue where frequent processing of old create tokens caused high CPU usage on index nodes.

| https://issues.couchbase.com/browse/MB-33639[MB-33639^]
| Fixed an issue to terminate all watcher goroutines upon close of MetadataProvider.

| https://issues.couchbase.com/browse/MB-32720[MB-32720^]
| The index service was getting stuck during warmup because of coredumps. This has been fixed.

| https://issues.couchbase.com/browse/MB-32716[MB-32716^]
| Fixed an issue that caused the index service to reach its quota with very few indexed items.

| https://issues.couchbase.com/browse/MB-32657[MB-32657^]
| Fixed an issue to enable creating secondary indexes on binary documents on meta.id(), meta.cas(), and meta.expiration().

| https://issues.couchbase.com/browse/MB-32641[MB-32641^]
| The DCP noop interval has been lowered to 20sec to improve the chances of the projector receiving the noop message early and thus avoiding frequent roll backs.

| https://issues.couchbase.com/browse/MB-32640[MB-32640^]
| Improved the DCP rollback handling mechanism. Instead of ignoring the disk snapshots before rolling back, the index service will now exhaust trying DCP stream requests with all the disk snapshots before rolling back to 0.

| https://issues.couchbase.com/browse/MB-32636[MB-32636^]
| Plasma memory tuner will now increment indexer memory quota only if the indexer process' RSS is below the memory quota.

| https://issues.couchbase.com/browse/MB-32635[MB-32635^]
| In a cluster with duplicate index names across buckets, replica repair failed after a node was added back to the cluster. This has been fixed.
|===

==== Query Service

[#table_fixedissues_query_554,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33208[MB-33208^], https://issues.couchbase.com/browse/MB-33185[MB-33185^]
| Fixed an issue with connection pool leak that caused queries to fail.
|===

==== Security

[#table_fixedissues_security_554,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33040[MB-33040^]
| The builtin Administrator user can now be authenticated via a client certificate.
|===

==== Tools, Web Console (UI) and REST API

[#table_fixedissues_tools-ui_554,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33429[MB-33429^]
| The couchbase-cli setting-alert man page has been updated to include the alert-communication-issue flag.

| https://issues.couchbase.com/browse/MB-33204[MB-33204^]
| The cbbackupmgr backup --resume incorrectly required full administrator privileges. This has been fixed so that any user with back and restore permissions can also resume a backup.

| https://issues.couchbase.com/browse/MB-32671[MB-32671^]
| The `cbimport` key generator did not handle escaped hash(#) or percent(%) characters correctly.

| https://issues.couchbase.com/browse/MB-32659[MB-32659^]
| Fixed an issue where the `Time Interval` checkbox on the Auto-Compaction page was disabled upon initial page load.

| https://issues.couchbase.com/browse/MB-32419[MB-32419^]
| Fixed an issue where `cbrestore` did not restore Views definitions taken using `cbbackup`.
|===

[#release-553]
== Release 5.5.3

Couchbase Server 5.5.3, released in December 2018, is the third maintenance release in the 5.5.x series for Couchbase Server.
This maintenance release includes fixes to the data, index, and query services, and install, XDCR and UI components.

[#fixed-issues-553]
=== Fixed Issues

==== Cross Datacenter Replication (XDCR)

[#table_fixedissues_xdcr_553,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-32045[MB-32045^]
| Fixed an issue where encrypted XDCR was incorrectly using port 8091.

| https://issues.couchbase.com/browse/MB-31763[MB-31763^]
| The unit of interval for XmemSelfMonitorInterval was incorrectly set to millisecond instead of second, causing an increase in the frequency of Xmem self monitor and the spurious `Xmem is stuck` error. This has been fixed.

| https://issues.couchbase.com/browse/MB-31568[MB-31568^]
| Improve XDCR connection management to prevent XDCR replication getting stuck while creating a checkpoint.
|===

==== Data Service

[#table_fixedissues_data_553,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-32181[MB-32181^]
| If one or more Ephemeral buckets were present, then nonIO background tasks could be incorrectly scheduled, potentially resulting in DCP connection instability (premature disconnection). This has been fixed.

| https://issues.couchbase.com/browse/MB-31837[MB-31837^]
| In some cases, the memory allocation failures were not handled causing "Write Commit Failure" errors or corruption in vBucket files.

| https://issues.couchbase.com/browse/MB-31835[MB-31835^]
| When data corruption is detected on a data service node, relevant information that can help troubleshoot is now being logged.

| https://issues.couchbase.com/browse/MB-31585[MB-31585^]
| Fixed an issue where appending to a document reset the expiration value to 0, disabling TTL expiry.

| https://issues.couchbase.com/browse/MB-31454[MB-31454^]
| When IPv6 was enabled, Couchbase Server incorrectly used ports that were outside of the known port range. When firewall rules are in place, requiring the ports to be explicitly whitelisted, this blocked nodes from being added to a cluster.

| https://issues.couchbase.com/browse/MB-31570[MB-31570^]
| The data service engine may not send STREAM_END message to consumers if non-infinity end sequence number and cursor dropping occurs. This could cause clients such as cbbackupmgr to hang indefinitely.
|===

==== Index Service

[#table_fixedissues_index_553,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31745[MB-31745^]
| An error is seen during a SUM aggregate pushdown when the entry value is greater than MaxInt64.

| https://issues.couchbase.com/browse/MB-31696[MB-31696^]
| Fixed an issue so that you can now create secondary indexes on binary documents on meta.id(), meta.cas(), and meta.expiration().

| https://issues.couchbase.com/browse/MB-31559[MB-31559^]
| The index service crashed if the data bucket was flushed while the initial index was being built.
|===

==== Install and Upgrade

[#table_fixedissues_install_553,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31648[MB-31648^]
| On Windows platform, the missing data file (icudtl.dat) caused errors in the Views engine and Eventing service. The data file has been restored.
|===

==== Query Service

[#table_fixedissues_query_553,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-32195[MB-32195^]
| Fixed a race condition caused by the intersect scan incorrectly interpreting the end of a scan as having already processed all the keys from that scan.

| https://issues.couchbase.com/browse/MB-32120[MB-32120^]
| Fixed an issue where the query engine threw an error if the query referenced extended attributes and the result contained non-existent keys.

| https://issues.couchbase.com/browse/MB-31991[MB-31991^], https://issues.couchbase.com/browse/MB-31990[MB-31990^]
| Following a cluster upgrade to version 5.5, the query service failed to retrieve extended attributes from a bucket when the query was run for the first time due to stale connections. This has been fixed to check and establish new working connections before executing a query following an upgrade.

| https://issues.couchbase.com/browse/MB-31615[MB-31615^]
| Fixed an issue where the TRUE predicate was handled incorrectly in the WHERE clause causing incorrect results.
|===

==== Tools, Web Console (UI) and REST API

[#table_fixedissues_tools-ui_553,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-32142[MB-32142^]
| Fixed an issue where the Views UI was unable to process the "undefined" value in a binary JSON document.

| https://issues.couchbase.com/browse/MB-32072[MB-32072^]
| All requests originating from the UI were authenticated using token based authentication, even when client certificate authentication is enabled on the Server and a client certificate is configured in the browser. This has been fixed to use client certificates for authentication in such scenarios.

| https://issues.couchbase.com/browse/MB-31830[MB-31830^]
| The cbbackupmgr utility would hang and not return an error when trying to backup a cluster in which at least one node was down and had not failed over.
|===

[#release-552]
== Release 5.5.2

Couchbase Server 5.5.2, released in October 2018, is the second maintenance release in the 5.5.x series for Couchbase Server.
This maintenance release includes fixes to the index and query services, XDCR, and installer components.

[#fixed-issues-552]
=== Fixed Issues

==== Data Service

[#table_fixedissues_data_552,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30920[MB-30920^]
| Authenticated users with full administrative privileges were able to access the diagnostic endpoint, `/diag/eval` remotely, allowing these users to run arbitrary code on the server host. This issue is addressed by only allowing full administrators to access this endpoint from localhost. This mitigates the issue as users that have access to the server host are already in a position to run arbitrary code.

Note that the `diag/eval` endpoint is authenticated and requires the highest privileges in the system (Full Admin). It is the case that a user with access to this endpoint can already delete, corrupt or coy all the data in the system. Customers can mitigate this issue by tightly controlling access to full administrative privileges.
|===

==== Cross Datacenter Replication (XDCR)

[#table_fixedissues_xdcr_552,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31141[MB-31141^]
| Fixed an issue where replication from version 4.5.x to version 5.5.x caused corruption on deleted documents leading to inability to rebalance.
|===

==== Index Service

[#table_fixedissues_index_552,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30509[MB-30509^]
| In previous releases, the memory consumption of the index service could exceed the index serviceâ€™s RAM quota setting. This caused problems when the quota was set to an amount that was close to the physical RAM on the Server node, for example this could lead to an out of memory error. This issue has been fixed.

| https://issues.couchbase.com/browse/MB-30412[MB-30412^]
| After a rebalance, the index service was stuck waiting for Memcached. This has been fixed by adding a timeout mechanism so the index service does not hang.

| https://issues.couchbase.com/browse/MB-30382[MB-30382^]
| Fixed an issue where the index service threw an error if an index was dropped when index mutation was ongoing.

| https://issues.couchbase.com/browse/MB-29982[MB-29982^]
| The authentication requests from projector to Memcached now have a fixed timeout to avoid infinite wait time.
|===

==== Install and Upgrade

[#table_fixedissues_install_552,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30227[MB-30227^]
| Fixed an issue where in-place (offline) upgrades to Couchbase Server on Windows from 5.0.x or 5.1.x to later releases failed.
|===

==== Query Service

[#table_fixedissues_query_552,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31269[MB-31269^]
| A race condition was observed when deleting a system bucket if the bucket was in use by a system bucket scan.
This is a rare condition where the wrong unlock was used when the scan resumed after the delete operation completed.

| https://issues.couchbase.com/browse/MB-31240[MB-31240^]
| When establishing connections, the cbq-engine would hang if the data node did not respond when trying to establish a handshake packet exchange with the data node.
This has been fixed and the cbq-engine now throws an error if the connection cannot be established.

| https://issues.couchbase.com/browse/MB-31017[MB-31017^]
| An empty array in the index scan caused incorrect results. This was observed when the scan_cap parameter was set to a small number (say 2) and thus, backfill was used.

| https://issues.couchbase.com/browse/MB-30946[MB-30946^]
| Fixed an issue where an empty array from index scan did not work as expected when backfill was used.
|===

[#release-551]
== Release 5.5.1

Couchbase Server 5.5.1, released in August 2018, is the first maintenance release in the 5.5.x series for Couchbase Server.

[#fixed-issues-551]
=== Fixed Issues

==== Data Service

[#table_fixedissues_data_551,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30868[MB-30868^]
| Fixed an issue where the logs collected from the UI did not use the same salt across all nodes even though they were collected at the same time.

| https://issues.couchbase.com/browse/MB-30610[MB-30610^]
| Fixed an issue where the Memcached process was unable to start if IPv6 protocol stack was disabled.
|===

==== Index Service

[#table_fixedissues_index_551,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30870[MB-30870^]
| During warmup, one of the indexes with low number of items triggered an issue and caused the internal garbage collector to run forever.
Thus causing the entire index service to stall during warmup.
This issue was observed when using Plasma storage engine.

| https://issues.couchbase.com/browse/MB-30823[MB-30823^]
| Fixed an issue where the index service crashed with a "slice bounds out of range"  error.

| https://issues.couchbase.com/browse/MB-2xxxx[MB-30672^]
| Fixed an issue where upgrading from 4.x to 5.x version of Couchbase Server caused an outage for GSI standard indexes.
This was observed during rolling upgrade from ForestDB to Plasma.
When the last ForestDB index service node was taken out of the cluster, the cluster compatibility mode changed to Plasma and the index service restarted.
|===

==== Installation

[#table_fixedissues_install_551,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30413[MB-30413^]
| Uninstalling Couchbase Server on a Debian-based systemd distribution such as Ubuntu 16 using "apt-get remove" and then running "systemctl status couchbase-server" reported that the service still exists but is "masked".
This means the service was explicitly disabled in such a way that it could not be started, automatically or by hand.
As a result, subsequent installations of any version of Couchbase Server failed as the service was rendered unstartable.
|===

==== Tools, Web Console (UI) and REST API

[#table_fixedissues_tools-ui_551,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30636[MB-30636^]
| Fixed an issue where an unexpected token error was seen when accessing the Web Console in Couchbase Server version 5.5.0.

| https://issues.couchbase.com/browse/MB-30589[MB-30589^]
| Fixed an issue where the warning message on the Web Console showed an incorrect flag for the removal of dedicated bucket port as `--remove-port` instead of `--remove-bucket-port`.
|===

[#release-550]
== Release 5.5.0

Couchbase Server 5.5.0 was released in July 2018.

[#changes-in-behavior]
=== Major Behavior Changes

[#table_change-behavior,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-28778[MB-28778^]
| The default number of Data Service worker threads has been increased; from 3/4 of the number of available CPU threads, to 7/8 of the number of available CPU threads (minimum of 4 in both cases).
This makes better use of the available CPU resource, particularly on larger systems, as such users may see an increase in CPU utilization on such systems.

| https://issues.couchbase.com/browse/MB-28417[MB-28417^]
| The permissions assigned to the cluster_admin role have been downgraded.
As a result, The cluster_admin role no longer has FTS write permissions used to create FTS searches.

_Workaround_: Add the *fts_admin* role as required.

| https://issues.couchbase.com/browse/MB-27173[MB-27173^]
| Prior to 5.5, the [.cmd]`mctimings` command defined the _request start_ as the time when the 24 byte request header had been read by the Data Service.
However, many requests contain a _body_ which also needs to be read before a request can be processed.
As such, the reported duration didn't accurately reflect how long the server actually spent processing a request, if it was still waiting for the body to be received from the network.

In 5.5, the definition of _request start_ has been changed to be when the header _and_ body have both been read.
This has the effect of more accurately reflecting the time spent by the Data Service in servicing a request, as the time the body spends in transit over the network is no longer included.
As a result command timings for affected request will have shorter durations compared to how they were measured before 5.5.

| https://issues.couchbase.com/browse/MB-27060[MB-27060^]
| The Couchbase Server 5.5 Windows installer package no longer bundles the DLL [.path]_dbghelp.dll_ which is required by Breakpad to produce dumps on Windows platforms.
Starting version 5.5, Breakpad will pick the DLL (dbghelp.dll) that is shipped with the OS.
|===

[#supported-platforms-550]
=== New Supported Platforms

This release adds support for the Debian 9 platform.
See xref:install:install-platforms.adoc[Supported Platforms] for the complete list of supported platforms.

[#deprecation-550]
=== Deprecated Features and Platforms

The following functionality is deprecated, will be deprecated or is unsupported.

* Server side Moxi or buckets with custom server side Moxi ports are deprecated and may be removed from the product in the future.
* The ability to create a bucket with a Moxi port has been deprecated.
The CLI commands have been updated to remove Moxi ports for bucket create and bucket edit operations.

[#v550-known-issues]
=== Known Issues

// <p><b>Cross Data-center Replication (XDCR)</b></p>
// <table frame="all" rowsep="1" colsep="1" id="table_knownissues_v55-xdcr">
// <tgroup cols="2">
// <colspec colname="c1" colnum="1" colwidth="1*"/>
// <colspec colname="c2" colnum="2" colwidth="2.64*"/>
// <thead>
// <row>
// <entry>Issue</entry>
// <entry>Description</entry>
// </row>
// </thead>
// <tbody>
// <row>
// <entry></entry>
// <entry></entry>
// </row>
// </tbody>
// </tgroup>
// </table>

==== Administration/Cluster Management

[#table_knownissues_v55-cluster,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-23074[MB-23074^]
| *Summary*: Performance issues may be observed when running Couchbase Server on CentOS 7.3 with kernel 3.10.0-514.6.

| https://issues.couchbase.com/browse/MB-17571[MB-17571^]
| *Summary:* On an undersized node, the default memory quota assigned to all the selected services by the server might result in a failure.

*Workaround:* Adjust the memory allocations appropriately to work around this issue.
|===

==== Data Service

[#table_knownissues_v55-kv-data,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30610[MB-30610^]
a|
*Summary*: Memcached process unable to start if IPv6 protocol stack has been disabled.
*Workaround*: There are two generally accepted methods to disable IPv6 on recent Linux distributions:

. Disable the entire IPv6 protocol stack - typically by adding a boot-time grub parameter: `ipv6.disable=1`.
. Disable assignment of IPv6 addresses to interfaces - either by setting the boot-time grub parameter: `ipv6.disable_ipv6=1`, or dynamically by setting the appropriate `net.ipv6.conf` sysctl properties.

Only the first method to disable IPv6 will cause Memcached to not start correctly.
As a workaround you can disable IPv6 using the second method instead.

| https://issues.couchbase.com/browse/MB-30074[MB-30074^]
| *Summary*: The data node is in a pending state after memcached crashes.

| https://issues.couchbase.com/browse/MB-29809[MB-29809^]
| *Summary*: The `last_modified` can be incorrect if a bucket was upgraded and contains old documents.

| https://issues.couchbase.com/browse/MB-29227[MB-29227^]
| *Summary*: Couchbase Server can get into a livelock state due to high checkpoint memory usage.
|===

==== Eventing Service

[#table_knownissues_v55-eventing,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31639[MB-31639^]
| *Summary*: The `cbbackupmgr` utility fails to backup a cluster with Eventing service when the user role is set to 'Data Backup & Restore' role.

| https://issues.couchbase.com/browse/MB-29841[MB-29841^]
| *Summary*: The debugger is unable to apply the source map generated by the transpiler.
A recent update in the Chrome browser version 66.0.3359.181 is causing this issue.
Since Google doesn't allow previous versions of Chrome to be downloaded, you can download previous versions of Chromium.
The debugger works fine with source maps on Chromium version 63.0.3239.0.

Note: Our fix for Chromium is tagged to *69.0.3466.0~157*.
As per the https://www.chromium.org/developers/calendar[Chrome release calendar^], 69.x is set to release on September 4th 2018.
The fix has been merged to Chrome Canary and is available at https://www.google.com/chrome/browser/canary.html[^]

| https://issues.couchbase.com/browse/MB-29360[MB-29360^]
| *Summary*: Multiple mutations are observed for a single document update when using Sync Gateway, leading to the OnUpdate handler being triggered multiple times.

| https://issues.couchbase.com/browse/MB-29308[MB-29308^]
| *Summary*: The eventing service may mark redacted data incorrectly.

| https://issues.couchbase.com/browse/MB-29271[MB-29271^]
| *Summary*: When a rebalance is in progress the Eventing service hangs when memcached is killed on data and eventing nodes.

| https://issues.couchbase.com/browse/MB-28555[MB-28555^]
| *Summary*: The Eventing service currently does not provide the ability to specify a port range.
Instead, the OS arbitrarily allocates a port for the Chrome Debugger.

| https://issues.couchbase.com/browse/MB-28414[MB-28414^]
| *Summary*: The eventing service misses some mutations with non-default vBuckets (535,1001 etc).

| https://issues.couchbase.com/browse/MB-28120[MB-28120^]
| *Summary*: The eventing service rebalance progress jumps from 24% to Finish.

| https://issues.couchbase.com/browse/MB-28010[MB-28010^]
| *Summary*: The `execution_stats.on_update_failure` are not counted in the Failures stats displayed in the Web Console.

| https://issues.couchbase.com/browse/MB-27814[MB-27814^]
| *Summary*: When there are multiple functions being deployed, undeployment does not happen until all functions are deployed.

| https://issues.couchbase.com/browse/MB-27559[MB-27559^]
| *Summary*: Benign panics can be seen in the eventing service logs during undeployment.
|===

==== Full-text Search Service

[#table_knownissues_v55-fts,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-29967[MB-29967^]
| *Summary*: In some circumstances, the Search engine uses more memory than its defined quota.

| https://issues.couchbase.com/browse/MB-28847[MB-28847^]
| *Summary*: The memory usage during index build overshoots the RAM quota.

| https://issues.couchbase.com/browse/MB-27429[MB-27429^]
| *Summary*: Scorch indexes were found to contain duplicate pindexes.

| https://issues.couchbase.com/browse/MB-25714[MB-25714^]
| *Summary*: On Windows platform, a very high memory/CPU usage may be observed when search service is indexing.
|===

==== Indexing Service

[#table_knownissues_v55-gsi-views,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30207[MB-30207^]
| *Summary*: An error is seen during a SUM aggregate pushdown when the entry value is greater than MaxInt64.

| https://issues.couchbase.com/browse/MB-30011[MB-30011^]
| *Summary*: The rebalance progress in percentage during GSI swap rebalance doesn't always increase linearly.

| https://issues.couchbase.com/browse/MB-19869[MB-19869^]
| *Summary*: Rebalance fails when taking out failed over nodes running views, in certain circumstances.
|===

==== Install and Upgrade

[#table_knownissues_v55-installer,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30354[MB-30354^]
| *Summary*: Upgrading from 4.x to 5.x version of Couchbase Server causes an outage for GSI standard indexes.
This is observed during rolling upgrade from ForestDB to Plasma.
When the last ForestDB index service node is taken out of the cluster,  the cluster compatibility mode changes to Plasma and index service restarts.

| https://issues.couchbase.com/browse/MB-30227[MB-30227^]
| *Summary*: In-place (offline) upgrades Server on Windows from 5.0.x or 5.1.x to later releases will fail.

*Workaround*: Manually uninstall 5.0.x / 5.1.x from your Windows machines prior to installing 5.5.0 or later Server releases.
|===

==== Query Service

[#table_knownissues_v55-query,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-29391[MB-29391^], https://issues.couchbase.com/browse/MB-29393[MB-29393^]
| *Summary*:  Large numeric values are reported incorrectly.
For example, the modulo operation or a scan for min int64 value returns an incorrect result in case of int64.
|===

==== Security

[#table_knownissues_v55-security,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-26421[MB-26421^]
| *Summary*: The default "administrator" user doesn't show up in list of local users displayed on the Web Console under the Security \-> Users tab.
|===

==== Tools, Web Console (UI), and REST API

[#table_knownissues_tools_ui_550,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30589[MB-30589^]
| *Summary*: The UI displays an incorrect flag in the warning message about the removal of dedicated port for a bucket.
It displays `--remove-port` instead of `--remove-bucket-port`.
|===

==== Analytics Service (Developer Preview)

[#table_knownissues_v55-analytics,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30007[MB-30007^]
| *Summary*: It is possible for a CONNECT BUCKET statement to fail temporarily with the error message "[.out]``The vbucket belongs to another server(0x7)``" when rebalancing Data nodes.

*Workaround*: Retry the operation.

| https://issues.couchbase.com/browse/MB-29542[MB-29542^]
| *Summary*: The Analytics stats for failed record count was incorrect.

| https://issues.couchbase.com/browse/MB-28544[MB-28544^]
a|
*Summary*: The UNION ALL operation does not work for all query types.
For example, a query of the form shown below is not parsed correctly.

----
(SELECT ... FROM ... WHERE ...)
UNION ALL
  (SELECT ... FROM ... WHERE ...)
----

*Workaround*: Remove the parentheses around the first subquery block.

----
SELECT ... FROM ... WHERE ...
UNION ALL
  (SELECT ...
    FROM ...
    WHERE ...)
----
|===

[#v550-fixed-issues]
=== Fixed Issues

// <p><b>Cross Datacenter Replication</b></p>
// <table frame="all" rowsep="1" colsep="1" id="table_fixedissues_xdcr_550">
// <tgroup cols="2">
// <colspec colname="c1" colnum="1" colwidth="1*"/>
// <colspec colname="c2" colnum="2" colwidth="2.64*"/>
// <thead>
// <row>
// <entry>Issue</entry>
// <entry>Description</entry>
// </row>
// </thead>
// <tbody>
// <row>
// <entry><xref href="https://issues.couchbase.com/browse/MB-xxxxx" format="html"
// scope="external">MB-xxxxx</xref></entry>
// <entry>Fixed  </entry>
// </row>
// </tbody>
// </tgroup>
// </table>

==== Data Service

[#table_fixedissues_data_550,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-29227[MB-29227^]
| Couchbase Server could get into a livelock state due to high checkpoint memory usage.

| https://issues.couchbase.com/browse/MB-29205[MB-29205^]
| There were a number of issues in Couchbase Server which caused rebalance to fail from time to time.
These have been fixed.

| https://issues.couchbase.com/browse/MB-29040[MB-29040^]
| Rebalance failed with an "Invalid Format specified for DCP_DELETION" error when data or eventing nodes were swapped in and out of a cluster.

| https://issues.couchbase.com/browse/MB-28868[MB-28868^]
| The index service went through a race condition in the storage engine which led to a crash.
The crash was most likely to happen if the index service was restarted with existing build indexes and they continued to process mutations after the index service restarted.

| https://issues.couchbase.com/browse/MB-28468[MB-28468^]
| The full-text search service repeatedly attempted to setup DCP streams to non-existing vBuckets.
|===

==== Eventing Service

[#table_fixedissues_eventing_550,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-29235[MB-29235^]
| The Eventing service did not retry bucket operation failures that were determined by the appropriate LCB macro to be retriable.

| https://issues.couchbase.com/browse/MB-29147[MB-29147^]
| Rebalance of KV/Eventing nodes can hang if the cluster contains Eventing nodes due to stale authentication info with the GoCB SDK.

| https://issues.couchbase.com/browse/MB-28968[MB-28968^]
| Rebalance of data or eventing nodes would hang if the cluster contained Eventing nodes.

| https://issues.couchbase.com/browse/MB-28779[MB-28779^]
| If the handler code was not idempotent, the destination bucket contained more docs than expected after a rebalance.

| https://issues.couchbase.com/browse/MB-28775[MB-28775^]
| On Windows, orphan processes with [.path]_.rbf_ extension were found to be running even after uninstalling Couchbase Server.

| https://issues.couchbase.com/browse/MB-28667[MB-28667^]
| Under some circumstances, like a function undergoing bootstrap or buckets referenced by the function (source, metadata, destination) get flushed or deleted, the function could not be undeployed.

| https://issues.couchbase.com/browse/MB-28550[MB-28550^]
| After restoring from an enterprise backup of eventing functions, eventing service would not process mutations in the destination cluster.

| https://issues.couchbase.com/browse/MB-28520[MB-28520^]
| Deployment fails if the size of the handler code is greater than 1MB.

| https://issues.couchbase.com/browse/MB-28315[MB-28315^]
| Redeploying a function resulted in the application log being truncated instead of appending to the existing log.

| https://issues.couchbase.com/browse/MB-27679[MB-27679^]
| The Eventing service can crash when processing documents in source buckets with size is greater than 1 MB.

| https://issues.couchbase.com/browse/MB-27491[MB-27491^]
| Failed rebalance, when retried, could hang.

| https://issues.couchbase.com/browse/MB-27454[MB-27454^]
| Rebalance-in of a data(KV) node after recovery from failover may hang if eventing service is processing mutations.
|===

==== Index Service

[#table_fixedissues_index_550,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-29405[MB-29405^]
| Rebalance would hang during index service rebalance.

| https://issues.couchbase.com/browse/MB-28139[MB-28139^]
| If the index files were corrupted, the index service would continue to crash and required a failover or a manual deletion of the corrupted index files to recover.
|===

==== Query Service

[#table_fixedissues_query_550,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-27815[MB-27815^]
| The array indexing plan incorrectly included filter covers.

| https://issues.couchbase.com/browse/MB-27360[MB-27360^]
| Fixed an issue on Windows platform where a query with more than 1000 characters could be pasted into the cbq shell only the up to 3 times.
Subsequent paste operations resulted in a partial query being pasted.

| https://issues.couchbase.com/browse/MB-25901[MB-25901^]
| Fixed an issue where the ORDER BY operator proceeded to sort even after being stopped and could lead to crashes.
|===

// <p><b>Search Service</b></p>
// <table frame="all" rowsep="1" colsep="1" id="table_fixedissues_search_550">
// <tgroup cols="2">
// <colspec colname="c1" colnum="1" colwidth="1*"/>
// <colspec colname="c2" colnum="2" colwidth="2.64*"/>
// <thead>
// <row>
// <entry>Issue</entry>
// <entry>Description</entry>
// </row>
// </thead>
// <tbody>
// <row>
// <entry></entry>
// <entry></entry>
// </row>
// </tbody>
// </tgroup>
// </table>

==== Tools, Web Console (UI), and REST API

[#table_fixedissues_tools_550,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-29980[MB-29980^]
| The logic to confirm unsafe stop rebalance operation on the Web Console has been resurrected.

| https://issues.couchbase.com/browse/MB-28337[MB-28337^]
| `Cbbackup`, `cbtransfer` and `cbrecovery` can incorrectly timeout and in rare cases cause data corruption.

| https://issues.couchbase.com/browse/MB-27719[MB-27719^]
| The [.cmd]`cbrecovery` command threw an exception when recovering data from a cluster that had failed over nodes.
|===

==== Analytics Service (Developer Preview)

[#table_fixedissues_analytics_550,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-27280[MB-27280^]
a|
It was possible for a rebalance of the Analytics nodes to always fail if:

* a bucket was in the disconnected state, and
* the Analytics nodes were at different DCP states.

In that case a common DCP state (required for rebalancing) could not be achieved as no new DCP mutations were received by the Analytics nodes.
|===

== Release Notes for Older 5.x Versions

* xref:5.1@relnotes.adoc[Release 5.1]
* xref:5.0@relnotes.adoc[Release 5.0]
