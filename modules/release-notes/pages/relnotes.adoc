= Release Notes for Couchbase Server 6.6

Couchbase Server 6.6 adds features and enhancements to improve developer productivity, foster Cloud deployments, and enable operational analytics on globally distributed data. 

Take a look at xref:introduction:whats-new.adoc[What's New?] for a list of new features and improvements in this release.

[#release-660]
== Release 6.6.0 (August 2020)

Couchbase Server 6.6 was released in August 2020.

_Quick Links_: <<supported-platforms-660>> | <<deprecation-660>> | <<known-issues-660>> | <<fixed-issues-660>>

[#changes-in-behavior-660]
=== Major Changes in Behavior from Previous Releases

This section notes major changes in behavior from previous releases.


[#supported-platforms-660]
=== New Supported Platforms

This release adds support for the following platforms:

* Red Hat Enterprise Linux (RHEL) 8.2

See xref:install:install-platforms.adoc[Supported Platforms] for the complete list of supported platforms.

[#deprecation-660]
=== Deprecated Features and Platforms

==== Deprecated and Removed Platforms

Java Runtime Environment(JRE) Version 8 is no longer supported.  The Analytics Service requires JRE Version 11 or later to be installed.

Starting with this release, the following platforms are no longer supported:

* TBD

Starting with this release, the following browsers are no longer supported:

* Microsoft Internet Explorer

==== Deprecated Features

The following functionality is deprecated or is unsupported.

* The 

* Starting this release, the Analytics Service has deprecated the use of OpenJDK 8. 

[#known-issues-660]
=== Known Issues

This section highlights some of the known issues in this release. 

==== Analytics Service

[#table_knownissues_v660-analytics,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-36461[MB-36461^]
| *Summary:* In cases where the input to IN subclause with EVERY quantifier is MISSING or NULL, Analytics and Query engines differ in behavior. The Analytics service treats MISSING or NULL input values(in this case) as equivalent to an empty array, which results in the whole `EVERY … IN …` expression returning TRUE, while the Query service returns MISSING if the input is MISSING (or NULL if the input is NULL).

*Workaround:* Use the IS KNOWN predicate to test whether the IN value is not NULL/MISSING.

`WHERE (x IS KNOWN) AND (EVERY y IN x SATISFIES ... END)`
|===

==== Cluster Manager

[#table_knownissues_v660-cluster-manager,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-37420[MB-37420^]
| *Summary*: Node-to-node encryption with wildcard certs in SAN entries are not supported in this release.
|===

==== Data Service

[#table_knownissues_v660-data,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-32528[MB-32528^]
| *Summary*: When a synchronous durability request is made unrelated operations pipelined on the same socket may be serviced with higher latency, due to https://issues.couchbase.com/browse/MB-10291[MB-10291].

| https://issues.couchbase.com/browse/MB-25982[MB-25982^]
| *Summary*: Compaction of large vbuckets causes a significant increase in memory usage.
|===

==== Eventing Service

[#table_knownissues_v660-eventing,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-38145[MB-38145^]
| *Summary*:  N1QL generated from Eventing uses only indexes that were present at the time of deployment. Ensure all indexes necessary for queries utilized by the function have been created prior to deploying the function. This issue is only observed with Couchbase Server versions 6.0.3 (build 2895) and 6.5.0 (build 4960).

| https://issues.couchbase.com/browse/MB-37042[MB-37042^]
| *Summary*: The CLI and REST tools for exporting and importing Eventing functions do not support cross compatible syntax when using only the command line, however the UI can import either syntax.

| https://issues.couchbase.com/browse/MB-32437[MB-32437^]
| *Summary*: In a multi-bucket scenario approaching the new 30 bucket limit, the Eventing service supports only one function per bucket. An error will be thrown when deploying the second function on a given bucket. 

| https://issues.couchbase.com/browse/MB-31639[MB-31639^]
| *Summary*: The `cbbackupmgr` utility fails to backup a cluster with Eventing service for a user with "Data Backup & Restore" role.
|===

==== Index Service and Views

[#table_knownissues_v660-gsi-views,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31039[MB-31039^]
| *Summary*: A disk usage spike is observed during the initial index build. The disk usage comes down once the log cleaner catches up.
|===

==== Install and Upgrade

[#table_knownissues_v660-install-upgrade,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-38390[MB-38390^]
| *Summary*: It is impossible to directly upgrade Couchbase Server from versions prior to 5.5.0 to version 6.5.0 if any cluster contains deleted documents. 
This is because DCP Deletion V2 packets are sent regardless of whether the DELETE_TIMES feature is negotiated.

*Workaround*: Upgrade to an intermediate version, such as Couchbase Server 6.0.4+, before upgrading to 6.5.0.

| https://issues.couchbase.com/browse/MB-37269[MB-37269^]
| *Summary*: Upgrading from version 6.0.4 to version 6.5.0 using offline upgrade or rolling online upgrade using graceful failover and delta node does not work. Version 6.0.4 included a per-node configuration migration and it was released after 6.5.0 which doesn't recognize the migration.

*Workaround*: To upgrade successfully from version 6.0.4 to 6.5.0, you must use swap rebalance. This will be fixed in the next maintenance release on the 6.5.x series.

| https://issues.couchbase.com/browse/MB-33522[MB-33522^]
| *Summary*: The `cbupgrade` script fails to upgrade single node IPv6 clusters.

| https://issues.couchbase.com/browse/MB-38046[MB-38046^]
| *Summary*: When performing an online upgrade from Couchbase Server 6.0.3 to Couchbase Server 6.5, some active Couchbase SDK 2.x applications may give an exception `4040: No such prepared statement`.

*Workaround:* Refer to xref:install:upgrade-strategy-for-features.adoc#prepared-statements[Prepared Statement Upgrades].
|===

==== Tools, Web Console (UI), and REST API

[#table_knownissues_v660-tools-ui-rest-api,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-37768[MB-37768^]
| *Summary*: On macOS (and OS-X) the `cbc` binary needs @rpath to be manually set on the `cbc` binary, this will allow proper execution of `cbc` (and related symlinked command line tools).
|===

[#fixed-issues-660]
=== Fixed Issues

This section highlights some of the issues fixed in this release. 

==== Analytics Service

[#table_fixedissues_v660-analytics,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-36750[MB-36750^]
| *Summary:* The following values for the format parameter of the Analytics Service API are being deprecated in this release and will be removed in a future release: application/x-adm, application/json, application/json;lossless, text/csv.

| https://issues.couchbase.com/browse/MB-36702[MB-36702^]
| *Summary:* Fixed an issue where an analytics query threw an internal error when using `to_string()` to try to force optimizer to use an index.

| https://issues.couchbase.com/browse/MB-36455[MB-36455^]
| *Summary:* Fixed an issue where the analytics query returned different results (extra 'null' value) when indexnl hint was applied to left outer join.
|===

==== Cluster Manager

[#table_fixedissues_v660-cluster-manager,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33764[MB-33764^]
| *Summary*: In release 6.0.2 and above, only users with "security-admin" role assigned will be allowed to POST an HTTP request to the /controller/uploadClusterCA and /node/controller/reloadCertificate endpoints. In the previous releases, the user had to have "cluster-admin" role assigned in order to POST an HTTP request to /node/controller/reloadCertificate endpoint. 

| https://issues.couchbase.com/browse/MB-30920[MB-30920^]
| *Summary*: Couchbase Server exposes '/diag/eval' endpoint which by default is available on TCP/8091 and/or TCP/18091. Authenticated users that have 'Full Admin' role assigned can send arbitrary Erlang code to 'diag/eval' endpoint of the API. The code will be subsequently executed in the underlying operating system with privileges of the user which was used to start Couchbase.

| https://issues.couchbase.com/browse/MB-30074[MB-30074^]
| *Summary*: If the memcached process crashed while indexes were being rebalanced, the memcached process could be failed to be brought online and the rebalance got stuck. This has been fixed and rebalance is now interrupted by memcached failure.
|===

==== Data Service

[#table_fixedissues_v660-data,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30553[MB-30553^]
| *Summary*: Fixed an issue where requesting the hash statistic severely affects the response times of replicateTo requests.
|===

==== Eventing Service

[#table_fixedissues_v660-eventing,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-28734[MB-28734^]
| *Summary*: Eventing timers can now be cancelled using cancelTimer() function, or by creating a new timer with same reference as an existing timer. In addition, a function that is invoked by a timer callback can create fresh timers.
|===

==== Index Service and Views

[#table_fixedissues_v660-gsi-views,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33478[MB-33478^]
| *Summary*: Any kind of collatejson crash caused a downtime, particularly on the mutation path. This has been fixed to recover only from collatejson crashes. After recovering, the docid is logged and the mutation key is skipped, and every such recovered-skip docid is logged as an error on the console. 

| https://issues.couchbase.com/browse/MB-30207[MB-30207^]
| *Summary*: Fixed SUM aggregate query for large integers.
|===

==== Install and Upgrade

[#table_fixedissues_v660-install-upgrade,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33003[MB-33003^]
| *Summary*: Corrected the port information in the post installation message.  

| https://issues.couchbase.com/browse/MB-30227[MB-30227^]
| *Summary*: Fixed an issue where in-place (offline) upgrades to Couchbase Server on Windows from 5.0.x or 5.1.x to later releases failed.

| https://issues.couchbase.com/browse/MB-27129[MB-27129^]
| *Summary*: The install experience on Mac OS has been improved and starting this release, a disk image installer is available for Mac OS. 
|===

==== Search Service

[#table_fixedissues_v660-search,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-27429[MB-27429^]
| *Summary*: Fixed an issue where Scorch indexes were found to contain duplicate pindexes.
|===

==== Tools, Web Console (UI), and REST API

[#table_fixedissues_v660-tools-ui-rest-api,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-35840[MB-35840^]
| *Summary*: The View index build progress information was missing on the UI and has been fixed.

| https://issues.couchbase.com/browse/MB-33207[MB-33207^]
| *Summary*: Fixed an issue where the `CB_CLUSTER` environment variable doesn't handle the prefix `couchbase://`` or no prefix at all. The fix ensures it behaves the same as using the `--cluster` argument with the `cbbackupmgr` tool.

| https://issues.couchbase.com/browse/MB-29974[MB-29974^]
| *Summary*: Fixed an issue where full-text search index aliases were not backed up with the `cbbackup` tool.

| https://issues.couchbase.com/browse/MB-29962[MB-29962^]
| *Summary*: Fixed an issue where full-text search index aliases were not backed up with the `cbbackupmgr` tool.
|===

== Release Notes for Older 6.x Versions

* xref:6.0@relnotes.adoc[Release 6.0]
