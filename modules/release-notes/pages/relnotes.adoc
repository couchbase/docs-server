= Release Notes for Couchbase Server 7.0

Couchbase Server 7.0 introduces scopes and collections that provide new database organizaion structures within Couchbase. It also brings new capabilities to the Query Service in addition to support for scopes and collections. 

Take a look at xref:introduction:whats-new.adoc[What's New?] for a list of new features and improvements in this release.

[#release-700]
== Release 7.0.0 (July 2021)

Couchbase Server 7.0 was released in July 2021.

_Quick Links_: <<major-changes-in-behavior-700>> | <<supported-platforms-700>> | <<known-issues-700>> | <<fixed-issues-700>> | <<common-vulnerabilities-exposures-700>>

[#major-changes-in-behavior-700]
=== Major Changes in Behavior from Previous Releases

* With the introduction of scopes and collections, Couchbase Server stores documents in a collection, which are contained in a scope, which is in a bucket. A default scope and default collection is used when a named scope and collection is not available or has not yet been created.
When you upgrade to version 7.0 from a previous version, your documents and indexes will be available in the default scope and default collection. The migration guide provides information on how to migrate your data from a previous version of Couchbase to take advantage of named scopes and collections.
** Global secondary indexes need to be created for each collection. 

* Added support for out-of-order execution of operations in Data Service.
+
When an operation takes a long time, this enhancement enables looking ahead in the queue and swapping for an operation that's faster. The durability out-of-order execution behavior is enabled by default and you can choose to disable it. See xref:java-sdk:ref:client-settings.adoc#unordered-executions[Java SDK documentation] for further information.

* Global secondary indexes now supports concurrent creation of indexes. 

* The Internet Engineering Task Force (IETF) have formally deprecated both the TLS 1.0 and 1.1 protocols along with a wider industry movement to use newer, more secure standards. Keeping in line with these changes, we strongly recommend that clients which use TLS encryption use TLS 1.2 or higher, and have updated the default minimum TLS version for all Couchbase Server 7.0 clusters to TLS 1.2.  Currently supported SDKs already support the TLS 1.2 standard, so in most cases no application changes are required.
+ 
If you do need to configure the minimum TLS to a lower version (not recommended), follow the instructions provided in https://docs.couchbase.com/server/current/manage/manage-security/manage-tls.html#set-the-minimum-tls-version.

* Updated license for Community Edition
+
The Community Edition of the product has an updated license with the following changes:
+
** Individual cluster sizes are limited to five (5) cluster nodes.
** Cross datacenter replication (XDCR) will be available only in the Enterprise Edition. 

[#supported-platforms-700]
=== New Supported Platforms

This release adds support for the following platforms:

* macOS Big Sur for development only

See xref:install:install-platforms.adoc[Supported Platforms] for the complete list of supported platforms.

[#deprecation-700]
=== Deprecated Features and Platforms

==== Deprecated and Removed Platforms

The following platforms are deprecated and will be removed in a future release:

* CentOS 8
* macOS 10.14 (Mojave)
* Microsoft Windows Server 2016

The following platforms are removed and no longer available: 

* Ubuntu 16.04 LTS

[#deprecated-features]
==== Deprecated and Removed Features

* The 'cbdocloader' tool used to load sample datasets is deprecated in this release. You can use the 'cbimport' tool with the '--format sample' flag as the 'cbimport' tool provides an equivalent feature set and is collection-aware.

* The MOSS index type, available in the full-text search service, is deprecated in this release.

* Support for passwordless buckets in the query service is deprecated.

* The old bucket `sasl_password` is deprecated in this release.

* The search_query() function is deprecated. We recommend that you use Search() functions instead to run full text search queries directly within a N1QL query. Refer to https://blog.couchbase.com/n1ql-and-search-how-to-leverage-fts-index-in-n1ql-query/ for information on changing the syntax to leverage the Search() function. 

* View indexes in N1QL have been removed in this release.

* The Data-Service histogram 'batch_read' has been removed. Use the existing 'bg_load' histogram instead to monitor background fetch durations.

[#known-issues-700]
=== Known Issues

This section highlights some of the known issues in this release. 

==== Analytics Service

[#table_knownissues_v700-analytics,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-46660[MB-46660^]
| *Summary*: The average disconnect time has increased from 8 seconds to 30 seconds.

| https://issues.couchbase.com/browse/MB-45973[MB-46646^]
| *Summary*: Quorum failover on a remote cluster requires manual intervention. Not performing these manual steps causes the results to vary based on which nodes the Analytics service is talking to, and the state of those nodes.  

*Workaround*: Following a quorum failover on a remote cluster, perform the following manual steps:
. Run `DISCONNECT LINK` if the remote link is still connected.
. Run `ALTER LINK` to update the link to point to a surviving node. This step is needed even if the previously specified host is still in the cluster as it resets the topology maintained in the metadata.
. Run `CONNECT LINK`.

| https://issues.couchbase.com/browse/MB-45996[MB-45996^]
| *Summary*: The Analytics service crashes when ingesting maximum size documents (20MB) with minimally-sized Analytics memory quota as the memory consumed during ingestion is not released until the link is disconnected.

*Workaround*: Using smaller documents, increasing the Analytics service memory quota, or disconnecting the link before running queries can help avoid running into this issue.

| https://issues.couchbase.com/browse/MB-44849[MB-44849^]
| *Summary*: Dangling remote shadows are not connected on permission restoration.

*Workaround*: Re-establish the connection by running `CONNECT LINK` manually.
|===

==== Data Service

[#table_knownissues_v700-data,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-47267[MB-47267^]
| *Summary*: Clusters with a large number of high capacity persistent buckets, delta node recovery may timeout, due to large persistent bucket's warmup tasks being scheduled before the initial tasks of warmup for other buckets.

*Workaround*: Increase the number of reader threads to reduce the likelihood of smaller bucket's warmup tasks being delayed from running.

| https://issues.couchbase.com/browse/MB-38978[MB-38978^]
| *Summary*: Under certain circumstances, such as running a cbcollect_info, requests may take longer than normal. Depending on the system workload and size, this may be even a few seconds, which can trigger the default timeout value from SDKs. 

*Workaround*: We recommend that you avoid gathering these stats or cbcollect_info during higher workload.
|===

==== Eventing Service

[#table_knownissues_v700-eventing,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-45973[MB-45973^]
| *Summary*:  After upgrading a cluster with a single Data node from version 6.6 to 7.0, Eventing timers are not triggered as expected after a swap rebalance to version 7.0. Note that this does not impact clusters with 2 or more data nodes, or when there are no deployed or paused Eventing Functions with timers.

*Workaround*: Undeploy all Eventing Functions that use timers, or add a second Data node before upgrading to version 7.0 (which can be subsequently be removed after the upgrade is complete).


| https://issues.couchbase.com/browse/MB-45785[MB-45785^]
| *Summary*: A race condition exists where an Eventing Function with a Feed Boundary set to "From now" sometimes ignores it's checkpoint and resumes processing form Everything. This issue only impacts the UI and can occur when a user rapidly invokes pause, edit, or resume in succession.

*Workaround*: The issue can be avoided by using the REST APIs to pause and resume Eventing Functions in production.
|===

==== Index Service

[#table_knownissues_v700-gsi,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-46725[MB-46725^]
| *Summary*: In the case of an unsafe failover that removes one or more index nodes from the cluster, the *Rebalance* button on the UI may not be enabled even though some indexes or index partitions are not available because the remaining index node(s) did not have any of their replicas.

*Workaround*: Issue a rebalance command via CLI `couchbase-cli rebalance -c 127.0.0.1:8091 -u Administrator -p xxxxxx`
|===

==== Query Service

[#table_knownissues_v700-query,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-46876[MB-46876^]
| *Summary*: AT_PLUS queries do not work with collections when using scan_vectors. 
|===

==== Views

[#table_knownissues_v700-views,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-47094[MB-47094^]
| *Summary*: Under very high query workload, the audit messages may get into the couchdb INFO logs if auditing for all view query requests is enabled. This is done to prevent the queue from growing unbounded. You can redact the logs during cbcollectinfo.
|===

[#fixed-issues-700]
=== Fixed Issues

The Couchbase JIRA filter https://issues.couchbase.com/issues/?filter=19680[Couchbase Server 7.0.0 Notable Fixed Issues] lists the notable issues fixed in this release. 

[#common-vulnerabilities-exposures-700]
=== Common Vulnerabilities and Exposures

This section lists common vulnerabilities and exposures that are fixed in this release. 

See https://www.couchbase.com/alerts[Couchbase Alerts] for the complete list of common vulnerabilities and exposures.
