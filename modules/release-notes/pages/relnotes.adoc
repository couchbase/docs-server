= Release Notes for Couchbase Server 7.1
:description: pass:q[Couchbase Server 7.1 introduces multiple new features.]

[#release-710]
== Release 7.1 (May 2022)

Couchbase Server 7.1 was released in May 2022.
This release contains new features, enhancements, and fixes.

[#new-features-improvements-710]
=== New Features

This section highlights the notable new features and improvements in this release.

* Analytics shadow data may now be replicated up to 3 times to ensure high availability.
Refer to xref:manage:manage-settings/general-settings.adoc[General Settings].

* Analytics now supports Analytics views and tabular Analytics views.
Refer to xref:analytics:5a_views.adoc[].

* The new Tableau Connector provides integration between tabular Analytics views and the Tableau interactive data visualization platform.
Refer to xref:tableau-connector::index.adoc[].

* The Analytics Service now supports external datasets on Azure Blob storage.
Refer to xref:analytics:manage-links.adoc[] and xref:analytics:rest-links.adoc[].

* Analytics now supports array indexes.
Refer to xref:analytics:7_using_index.adoc[] and xref:analytics:5_ddl.adoc[].

* The cost-based optimizer may now consider different join orders, and can choose the optimal join order based on cost information.
Refer to xref:n1ql:n1ql-language-reference/cost-based-optimizer.adoc#join-enumeration[Join Enumeration].

* The Query service now supports optimizer hints within queries using a specially-formatted hint comment.
Refer to xref:n1ql:n1ql-language-reference/optimizer-hints.adoc[].

* Couchbase Server now permits multiple root certificates to maintained in a _trust store_ for the cluster.
See xref:learn:security/using-multiple-cas.adoc[Using Multiple Root Certificates].

* Couchbase Server now supports _PKCS #1_ and _PKCS #8_ &#8212; in each case, only for use with private keys.
See xref:learn:security/certificates.adoc#private-key-formats[Private Key Formats].

* Use of encrypted private keys is now supported for certificate management.
Registration procedures are provided for encrypted private keys associated with node-certificates.
See xref:rest-api:upload-retrieve-node-cert.adoc#json-passphrase-registration[JSON Passphrase Registration].

* _System Events_ are now provided, to record significant events on the cluster.
See xref:learn:clusters-and-availability/system-events.adoc[System Events].

* New roles are provided for the administration of _Sync Gateway_, especially in the context of Couchbase Capella.
These roles are listed at xref:learn:security/roles.adoc[Roles].

* TLS 1.3 cipher-suites can now by used by all services; and by the Cluster Manager, XDCR, and Views.
See xref:learn:security/on-the-wire-security.adoc[On the Wire Security].

* Heightened security is now provided for adding nodes to clusters.
Once  a cluster is using uploaded certificates, a node that is to be added must itself be provisioned with conformant certificates before addition can be successfully performed.
The new node is now always added over an encrypted connection.
See xref:manage:manage-security/configure-server-certificates.adoc#adding-new-nodes[Adding New Nodes].

* The scalability of indexing is enhanced by the _flattening_ of arrays.
See xref:n1ql:n1ql-language-reference/indexing-arrays.adoc#query-predicate-format[Format of Query Predicate].

* Automatic Failover can now fail several nodes over concurrently; additionally, automatic failover of index services is supported.
See xref:learn:clusters-and-availability/automatic-failover.adoc[Automatic Failover].

* Improvements have been made to rebalancing algorithms so that active buckets, services, and replicas will be spread across different server groups, even when server groups are unequal.
See xref:learn:clusters-and-availability/groups.adoc[Server Group Awareness].

* The Magma Storage Engine has been added to 7.1 as an Enterprise Edition feature, allowing for higher performance with very large datasets.
Magma is a disk-based engine, so is highly suited to datasets that will not fit in available memory.
You can find more details on Magma in xref:learn:buckets-memory-and-storage/storage-engines.adoc[Storage Engines].

[#enhacements-710]
=== Enhancements

The following enhancements are provided in this release:

* The Analytics function `object_concat` has been updated to support dynamic uses, similar to the more general OBJECT constructor functionality that is available in the Query Service.
Refer to xref:analytics:8_builtin.adoc#object_concat[object_concat].

* XDCR checkpointing is now entirely persistent through topology-changes on the source cluster.
This provides improved performance when failover and rebalance occur on the source cluster.

* The Plasma Storage Engine has been enhanced with _per page Bloom filters_ and _in-memory compression_.
For information, see xref:learn:services-and-indexes/indexes/storage-modes.adoc#plasma-memory-enhancements[Plasma Memory Enhancements].

* Root and intermediate certificates can now be managed while node-to-node encryption is enabled.
See xref:learn:clusters-and-availability/node-to-node-encryption.adoc#certificate-rotation-and-node-to-node-encryption[Certificate Management and Node-to-Node Encryption].

[#supported-platforms-710]
=== New Supported Platforms

This release adds support for the following platforms:

* Apple macOS v11.6 (Big Sur) for development only

* Apple macOS v12.x (Monterey) for development only

* Amazon Linux (ARM)

* Debian 11.x

See xref:install:install-platforms.adoc[Supported Platforms] for the complete list of supported platforms.

[#deprecated-features-and-platforms-710]
== Deprecated Features and Platforms

=== Deprecated and Removed Platforms

The following platforms are deprecated and will be removed in a future release:

* Apple macOS v10.14 (Mojave) – removed
* Apple macOS v10.15 (Catalina) – deprecated
* CentOS 7.x – deprecated
* CentOS 8.x – removed
* Debian 9.x – removed
* Microsoft Windows Server 2016 – removed
* Microsoft Windows Server 2016 (64-bit, DataCenter Edition) – removed
* Oracle Linux 7.x – deprecated
* Red Hat Enterprise Linux (RHEL) 7.x – deprecated
* Ubuntu 18.x – deprecated

=== Deprecation of Certificate Upload API

The `POST` method and `/controller/uploadClusterCA` URI, which historically have been used to upload an appropriately configured certificate to the cluster, so that it becomes the root certificate for the cluster, are _deprecated_ in 7.1.

For security reasons, in versions 7.1 and after, by default, this method and URI can continue to be used on _localhost_ only.
However, this default setting can be changed, if required.
For details, see xref:rest-api:deprecated-security-apis/deprecated-certificate-management-apis.adoc[Deprecated Certificate Management APIs].

Note that new methods and URIs for certificate management are summarized on the page xref:rest-api:rest-certificate-management.adoc[Certificate Management API].


=== Fixed Issues

This release contains the fixes listed below.

==== Installation

[#table-known-issues-710-installation, cols="25,66"]
|===
|Issue | Description

| https://issues.couchbase.com/browse/MB-33522[MB-33522^]
| Fix cbupgrade for single node IPv6 clusters

| https://issues.couchbase.com/browse/MB-47806[MB-47806^]
| Windows installer always rollbacks during install

|===

==== Cluster Manager

[#table-known-issues-710-cluster-manager, cols="25,66"]
|===
|Issue | Description

| https://issues.couchbase.com/browse/MB-44777[MB-44777^]
| The old bucket 'sasl_password' should be effectively removed

| https://issues.couchbase.com/browse/MB-44800[MB-44800^]
| The versions REST API should be authenticated

|===

==== Storage

[#table-known-issues-710-storage, cols="25,66"]
|===
|Issue | Description

| https://issues.couchbase.com/browse/MB-49512[MB-49512^]
| Cleaning up of the cluster fails with "Rebalance exited with reason {buckets_shutdown_wait_failed"

|===

==== Data Service

[#table-known-issues-710-data-service, cols="25,66"]
|===
|Issue | Description

| https://issues.couchbase.com/browse/MB-46827[MB-46827^]
| Limit the Checkpoint memory usage

| https://issues.couchbase.com/browse/MB-49977[MB-49977^]
| Cannot make persistent change to num nonio/auxio threads

| https://issues.couchbase.com/browse/MB-50708[MB-50708^]
| Align roles to updated permissions in memcached

|===

==== Views

[#table-known-issues-710-views, cols="25,66"]
|===
|Issue | Description

| https://issues.couchbase.com/browse/MB-50383[MB-50383^]
| ViewEngine doesn't handle the case of empty default-collection

| https://issues.couchbase.com/browse/MB-51045[MB-51045^]
| Views 8092 REST API leaking version info

|===

==== Analytics Service

[#table-known-issues-710-analytics-service, cols="25,66"]
|===
|Issue | Description

| https://issues.couchbase.com/browse/MB-48315[MB-48315^]
| Analytics UI is blank in Mixed mode cluster

| https://issues.couchbase.com/browse/MB-50601[MB-50601^]
| Cbas keeps crashing

| https://issues.couchbase.com/browse/MB-51446[MB-51446^]
| On corrupt remote link details in metakv, analytics cluster becomes permanently unusable on restart

|===

==== Query Service

[#table-known-issues-710-query-service, cols="25,66"]
|===
|Issue | Description

| https://issues.couchbase.com/browse/MB-19101[MB-19101^]
| Query log format

| https://issues.couchbase.com/browse/MB-44757[MB-44757^]
| Support FTS's docid_regexp mode for N1QL

| https://issues.couchbase.com/browse/MB-46802[MB-46802^]
| Mutation fail may not report the error

| https://issues.couchbase.com/browse/MB-47366[MB-47366^]
| Public interface documentation on parsing 12009 DML error

| https://issues.couchbase.com/browse/MB-48402[MB-48402^]
| Like functions escape character should be optional

|===

==== Index Service

[#table-known-issues-710-index-service, cols="25,66"]
|===
|Issue | Description

| https://issues.couchbase.com/browse/MB-33546[MB-33546^]
| Smart Batching Index Builds During Rebalance

| https://issues.couchbase.com/browse/MB-46725[MB-46725^]
| Rebalance button not enabled post Quorum Loss failover even when indexing has partitioned indexes

| https://issues.couchbase.com/browse/MB-46895[MB-46895^]
| Internal Server error is raised while performing backup on a index node using cbbackupmgr

| https://issues.couchbase.com/browse/MB-51196[MB-51196^]
| Index build stuck during rebalance due to large number of pending items

|===

==== Search Service

[#table-known-issues-710-search-service, cols="25,66"]
|===
|Issue | Description

| https://issues.couchbase.com/browse/MB-26024[MB-26024^]
| Rebalance optimisations via index file transfer across nodes

| https://issues.couchbase.com/browse/MB-41195[MB-41195^]
| Bind only to IPv4 addresses when invoked with IPv4-Only cluster-wide setting

| https://issues.couchbase.com/browse/MB-46260[MB-46260^]
| FTS - Apply RBAC only for target collections in a multi-collection index

| https://issues.couchbase.com/browse/MB-46978[MB-46978^]
| n1fty to upgrade to blevesearch/sear for verification phase

| https://issues.couchbase.com/browse/MB-47017[MB-47017^]
| Support encrypted certificate / key / password - Search

| https://issues.couchbase.com/browse/MB-47029[MB-47029^]
| System Event Log - Search

| https://issues.couchbase.com/browse/MB-47177[MB-47177^]
| Multiple Root CA Certs - FTS

| https://issues.couchbase.com/browse/MB-49188[MB-49188^]
| Search UI should be able to accept queries as objects

| https://issues.couchbase.com/browse/MB-49218[MB-49218^]
| Add Croatian language (hr) to the list of supported languages

| https://issues.couchbase.com/browse/MB-51059[MB-51059^]
| SEARCH_META().score behaves different from SEARCH_SCORE() in some N1QL queries

|===

==== Eventing Service

[#table-known-issues-710-eventing-service, cols="25,66"]
|===
|Issue | Description

| https://issues.couchbase.com/browse/MB-45973[MB-45973^]
| Timer not firing after upgrade, worker count change and service crash

| https://issues.couchbase.com/browse/MB-46304[MB-46304^]
| Add ability to enable/disable the cURL functionality

| https://issues.couchbase.com/browse/MB-48702[MB-48702^]
| Eventing consumes large amount of CPU with no functions.

|===

=== Known Issue

This release contains the following known issue.

==== Query Service

[#table-known-issues-710-query-service, cols="25,66"]
|===
|Issue | Description


| https://issues.couchbase.com/browse/MB-50936[MB-50936^]
| *Summary*: Implement defs.CheckMixedModeCallback for mixed mode checks

Any attempt to execute a function with N1QL udfs replicated from a 7.1 node will fail with "no library found in worker" on a 7.0.x node.

*Workaround*: If possible, all nodes in cluster should be running under version 7.1 or higher.
|===
