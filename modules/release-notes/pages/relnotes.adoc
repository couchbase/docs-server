= Release Notes for Couchbase Server 6.0

Couchbase Server 6.0 is an important release that adds the Analytics service to the Couchbase Data Platform.
It also includes enhancements to the Eventing and Search services.

Take a look at xref:introduction:whats-new.adoc[What's New?] for a list of new features and improvements that are available in this release.

[#release-605]
== Release 6.0.5

Couchbase Server 6.0.5, released in January 2021, is the fifth maintenance release in the 6.0.x series for Couchbase Server.
This release includes bug fixes related to many components.

[#fixed-issues-605]
=== Fixed Issues

The notable fixes in this release are listed below.

==== Cross Datacenter Replication (XDCR)

[#table_fixedissues_v605-xdcr,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-43416[MB-43416^]
| *Summary*: In a high bucket density test (with 30 buckets) with replication on, goxdcr process on source cluster data node was observed to exit multiple times with `status 2` and a runtime error.

| https://issues.couchbase.com/browse/MB-40846[MB-40846^]
| *Summary*: Fixed an incorrect XDCR stream request rollback caused by a consumer ahead of producer error.
|===

==== Data Service

[#table_fixedissues_v605-kv-data,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-41804[MB-41804^]
| *Summary*: Fixed an issue where ephemeral buckets set to `auto_delete` with replicas configured could reach a deadlock due to eviction.

| https://issues.couchbase.com/browse/MB-41255[MB-41255^]
| *Summary*: Fixed an issue where the replication of deletes with XATTRS failed if the affected document was non-resident.

| https://issues.couchbase.com/browse/MB-40531[MB-40531^]
| *Summary*: Fixed a performance regression where the HiFi-MRU Item Pager (added in 5.0) would evict more active items compared to previous LRU ItemPager under certain workloads.

| https://issues.couchbase.com/browse/MB-38741[MB-38741^]
| *Summary*: The frequency at which the expiry pager runs can be set using a configuration parameter `exp_pager_stime`. Since the default value of 3600s was seen to impact front-end operations, the default value has been reduced to 600s.

| https://issues.couchbase.com/browse/MB-38283[MB-38283^]
| *Summary*: Fixed an issue where Memcached log wrapped due to excessive DCP "no memory" messages.

| https://issues.couchbase.com/browse/MB-34949[MB-34949^]
| *Summary*:  Fixed a theoretical race condition where if a vBucket changed state away from active at the same time as a Delete operation, the delete could incorrectly report success; but would not be applied to new active vBucket.
|===

==== Index Service

[#table_fixedissues_v605-gsi-views,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-42947[MB-42947^]
| *Summary*: Fixed the memory growth observed when the index service performs many metadata operations.

| https://issues.couchbase.com/browse/MB-41644[MB-41644^]
| *Summary*: Fixed a runtime error in Plasma caused by invalid memory address or nil pointer dereference.

| https://issues.couchbase.com/browse/MB-40917[MB-40917^]
| *Summary*: To safeguard from scenarios like missing TCP notifications, read deadline to connections between Memcached and projector data paths have been set.

| https://issues.couchbase.com/browse/MB-40466[MB-40466^]
| *Summary*: Zero-out memory before returning to Go to avoid sudden increase in disk space usage by the index service.

| https://issues.couchbase.com/browse/MB-40447[MB-40447^]
| *Summary*: The projector incorrectly went into a stream termination loop while trying to stream a near 20 MB document. This has been fixed by removing doc size checks in projector.

| https://issues.couchbase.com/browse/MB-40420[MB-40420^]
| *Summary*: Fixed an issue where Views did not handle compressed raw documents.

| https://issues.couchbase.com/browse/MB-40411[MB-40411^]
| *Summary*: Fixed an issue where index restore failed with a `Duplicate Index Instance` error.

| https://issues.couchbase.com/browse/MB-40410[MB-40410^]
| *Summary*: Fixed an issue where index creation failed in case one or more watchers were not available.ÃŸ

| https://issues.couchbase.com/browse/MB-40407[MB-40407^]
| *Summary*: Increased the size of the change notification channel in leader to avoid possible deadlock in removeListener in gometa leader.

| https://issues.couchbase.com/browse/MB-37931[MB-37931^]
| *Summary*: Fixed an issue where `maxParallelIndexer` did not take effect immediately when the configuration was changed.

| https://issues.couchbase.com/browse/MB-37729[MB-37729^]
| *Summary*: Fixed an issue where a rollback after the compactor finished returned an `index_builder` error.

| https://issues.couchbase.com/browse/MB-37728[MB-37728^]
| *Summary*: Fixed a View index build failure by resetting the index file when writer detects a corrupt file.
|===

==== Query Service

[#table_fixedissues_v605-query,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-41231[MB-41231^]
| *Summary*: Fixed an issue where the LIKE clause with query parameters was observed to be significantly slower than inline.
|===


[#release-604]
== Release 6.0.4

Couchbase Server 6.0.4, released in February 2020, is the fourth maintenance release in the 6.0.x series for Couchbase Server.
This release includes bug fixes related to many components.

[#known-issues-604]
=== Known Issues

Upgrading from version 6.0.4 to version 6.5.0 using offline upgrade or rolling online upgrade using graceful failover and delta node does not work. Version 6.0.4 included a per-node configuration migration (https://issues.couchbase.com/browse/MB-37269[MB-37269^]) and it was released after 6.5.0 which doesn't recognize the migration.

To upgrade successfully from version 6.0.4 to 6.5.0, you must use swap rebalance. This will be fixed in the next maintenance release on the 6.5.x series.

[#fixed-issues-604]
=== Fixed Issues

The notable fixes in this release are listed below.

==== Analytics Service

[#table_fixedissues_v604-analytics,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-37458[MB-37458^]
| *Summary*: On Azure, an analytics cluster with more than one node failed during cluster configuration as the second node was unable to join the cluster. The issue is caused by resolving the name of each node on the node itself, instead of resolving the names to addresses on the caller side. The best-practices document instructs users to assign the public DNS node name to localhost in the hosts file, causing the callers to erroneously attempt to contact nodes on their own loopback interface. This has been fixed.

| https://issues.couchbase.com/browse/MB-37358[MB-37358^]
| *Summary*: The analytics service no longer makes all assigned quota available to the JVM as heap. The service reserves some amount of this quota for JVM overhead, to help prevent the system from becoming unstable due to low memory.

| https://issues.couchbase.com/browse/MB-36702[MB-36702^]
| *Summary*: Fixed an ArrayIndexOutOfBoundsException in BTreeAccessMethod.createIndexSearchPlan() when there's a composite key index and a query predicate that operates on a subset of its key fields. For example,
````
CREATE INDEX ... ON .. (a,b,c);
SELECT ... FROM ... WHERE a = ... AND c = ...
````
|===

==== Cross Datacenter Replication (XDCR)

[#table_fixedissues_v604-xdcr,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-37359[MB-37359^]
| *Summary*: Fixed an issue where a quick replication addition operation after a replication deletion in a large cluster (cluster with > 10 nodes) caused the particular replication to be ineffective in few of the nodes in the cluster.

| https://issues.couchbase.com/browse/MB-36689[MB-36689^]
| *Summary*: Fixed an issue where the Elastic Search Engine and the Couchbase Cluster were sometimes found to have a document count mismatch.
|===

==== Data Service

[#table_fixedissues_v604-kv-data,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-36804[MB-36804^]
| *Summary*: When couchstore writes out modified node elements during document saves, it is supposed to limit the number of bytes written in a single node to a _chunk_threshold - by default 1279 bytes. If the node is larger than the limit, it should be split into multiple sibling nodes.
However, this limit was not respected, resulting in overly-large nodes being written out. In the case of the by-seqno B-Tree (which always writes values to the rightmost leaf as seqnos are increasing), it resulted in all leaf elements residing in a single leaf node. Moreover, this meant that adding another element to the B-Tree effectively re-writes the entire tree, resulting in a massive Write Amplification. This has been fixed

| https://issues.couchbase.com/browse/MB-36802[MB-36802^]
| *Summary*: Fixed an issue where `dcp-vbtakeover` stats were unreliable shortly after replication creation.

| https://issues.couchbase.com/browse/MB-37643[MB-37643^]
| *Summary*: Fixes an issue with bucket-level expiry.  When bucket-level expiry is enabled and the bucket(max) TTL is set to more than 30 days, then it uses an expiry offset based from when the Data Service is started, instead of an offset based from the current time.  This can result in documents that use the bucket TTL being expired prematurely.
|===

==== Eventing Service

[#table_fixedissues_v604-eventing,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-37633[MB-37633^]
| *Summary*: N1QL statements in Eventing were automatically prepared in 6.0.3 but will no longer do so due to the performance impact on statement cache. The option to automatically prepare all statements may be introduced in a future release.

| https://issues.couchbase.com/browse/MB-36928[MB-36928^]
| *Summary*: Fixed an issue where Eventing service returned a JSON parse error and the query metadata was empty.  The service now returns SDK and query errors for N1QL.
|===

==== Index Service

[#table_fixedissues_v604-gsi-views,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-37117[MB-37117^]
| *Summary*: Fixed an issue where view queries were stuck due to merge connection timeouts.

| https://issues.couchbase.com/browse/MB-36579[MB-36579^]
| *Summary*: If the index service received a rollback (either rollback to zero (or) rollback to a seqno), and then a rollback to zero, the rollback to zero was not handled by trying with disk snapshot first. This has been fixed.

| https://issues.couchbase.com/browse/MB-36297[MB-36297^]
| *Summary*: Fixed an issue where a StreamEnd message for a vBucket was processed before a StreamBegin message in feed's backch. This lead to inconsistent book-keeping and caused the index service to enter into a infinite loop.

| https://issues.couchbase.com/browse/MB-36274[MB-36274^]
| *Summary*: Fixed an issue where the Forestdb reserve bitmap revision number was not set correctly.
|===

==== Install and Upgrade

[#table_fixedissues_v604-install,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-37069[MB-37069^]
| *Summary*: The upgrade script (`rpm -U`) now automatically stops Couchbase Server before starting upgrade and brings up the Server once the upgrade process is complete.
|===

==== Search Service

[#table_fixedissues_v604-search,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-37579[MB-37579^]
| *Summary*: A busy persister within scorch can cause the number of files to grow by a lot due to the merger lagging behind. This has been fixed by having the persister remove old files as part of its operation to avoid the situation.
|===

==== Tools, Web Console (UI), and REST API

[#table_fixedissues_v604-tools-ui,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-37498[MB-37498^]
| *Summary*: Fixed an issue where the cluster name setting was lost when adding an index node to the cluster.
|===

[#release-603]
== Release 6.0.3

Couchbase Server 6.0.3, released in October 2019, is the third maintenance release in the 6.0.x series for Couchbase Server.
This release includes updated platform support in addition to bug fixes related to many components.

[#supported-platforms-603]
=== New Supported Platforms

This release adds support for the macOS 10.14 "Mojave" platform.

See xref:install:install-platforms.adoc[Supported Platforms] for the complete list of supported platforms.


[#fixed-issues-603]
=== Fixed Issues

The notable fixes in this release are listed below.

==== Analytics Service

[#table_fixedissues_v603-analytics,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-36177[MB-36177^]
| *Summary*: Fixed an issue so that data files are recreated on ALL keep nodes when failing over datasets and not just the intersection of keep nodes and nodes where the datasets were previously located.

| https://issues.couchbase.com/browse/MB-36177[MB-35940^]
| *Summary*: Added the ability to filter datasets based on document keys and not just fields.

| https://issues.couchbase.com/browse/MB-35688[MB-35688^]
| *Summary*: A cancelled rebalance-in left an Analytics cluster without any metadata replicas. Upon attempt to failover and remove the remaining node, the cluster became permanently unusable unless you removed all Analytics nodes from the cluster and re-added the service, which resulted in an uninitialized Analytics cluster.
This has been fixed so that metadata replica addition is not skipped on a cancelled rebalance-in.


| https://issues.couchbase.com/browse/MB-34798[MB-34798^]
| *Summary*: During node startup, the system latest checkpoint files are read to determine the system state and complete the startup based on that state. If all the checkpoint files found were corrupted, then the node was bootstrapped as a new node and as a result, all data was deleted. This has been fixed to distinguish between a real bootstrap scenario (where there are no checkpoint files) and a scenario where the checkpoint files could not be read successfully, and in the latter case, force recovery from the start of the available transaction logs.
|===

==== Cluster Manager

[#table_fixedissues_v603-ns_server,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-35748[MB-35748^]
| *Summary*: Fixed a race condition around trap_exit.
|===

==== Cross Datacenter Replication (XDCR)

[#table_fixedissues_v603-xdcr,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-35807[MB-35807^]
| *Summary*: XDCR has been enhanced to be aware of target nodes' setups and only restart pipelines if the target and remote cluster reference are both set up for mixed mode encryption, and the target node's mode really changed.

| https://issues.couchbase.com/browse/MB-34298[MB-34298^]
| *Summary*: Fixed an issue so that the topology change detector does not delete the replication spec when a target bucket is not found.
|===

==== Data Service

[#table_fixedissues_v603-kv-data,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-36101[MB-36101^]
| *Summary*: Fixed an issue where DeleteWithMetadata against an XATTR document could result in a mutation.

| https://issues.couchbase.com/browse/MB-36087[MB-36087^]
| *Summary*: Fixed an issue when DeleteWithMeta against a value evicted XATTR document crashed kv-engine.

| https://issues.couchbase.com/browse/MB-35702[MB-35702^]
| *Summary*: SSL write failures may not reset the connection in the write phase. This has been fixed by propagating SSL write errors from sendmsg.

| https://issues.couchbase.com/browse/MB-35195[MB-35195^]
| *Summary*: Fixed an issue where the audit config reload was stuck due to the drive (or path) being unavailable.

| https://issues.couchbase.com/browse/MB-34879[MB-34879^]
| *Summary*: An error was thrown when performing a GET on a document that is both compressed and has extended attributes(XATTRs) if the client supported compression and the uncompressed document is sent to the client with the compressed flag still set. This has been fixed.
|===

==== Index Service

[#table_fixedissues_v603-gsi-views,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-35734[MB-35734^]
| *Summary*: In rebalance_service_manager, the default value of the `isBalanced` flag is set to false. If the index service restarts after rebalance is complete, this flag will be set to false and the rebalance button is activated assuming that the index service requires a rebalance. This is not expected behaviour. This has been fixed by setting the default value of `isBalanced` to true.

| https://issues.couchbase.com/browse/MB-35700[MB-35700^]
| *Summary*: The collatejson package's JoinArray has been optimized to mitigate high memory usage.

| https://issues.couchbase.com/browse/MB-35477[MB-35477^]
| *Summary*: Fixed a rare issue where the Plasma storage log grew indefinitely.

| https://issues.couchbase.com/browse/MB-35473[MB-35473^]
| *Summary*: Fixed an issue that caused a Write Bucket Failure and corrupted the vBucket file.

| https://issues.couchbase.com/browse/MB-35323[MB-35323^]
| *Summary*: Fixed an issue in ForestDB where renaming a compacted file led to the file getting deleted.

| https://issues.couchbase.com/browse/MB-34428[MB-34428^]
| *Summary*: When querying on a ddoc that is deleted, the views query incorrectly returned HTTP error code 500 suggesting an internal sever error. This has been fixed and the views query now returns an error message suggesting that the ddoc has been deleted.

| https://issues.couchbase.com/browse/MB-34158[MB-34158^]
| *Summary*: Fixed a memory allocation failure in Forestdb that caused a system crash under pressure.

| https://issues.couchbase.com/browse/MB-32341[MB-32341^]
| *Summary*: Added the ability to trace operations on a file.
|===

==== Query Service

[#table_fixedissues_v603-query,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-35811[MB-35811^]
| *Summary*: Fixed a connection pool leak observed when querying system:indexes.

| https://issues.couchbase.com/browse/MB-35670[MB-35670^]
| *Summary*: When scanning through all n1ql nodes to perform a distributed command, the query engine memory grew until it crashed. This has been fixed.

| https://issues.couchbase.com/browse/MB-35516[MB-35516^]
| *Summary*: COUNT on an index FullScan returned incorrect results when it included DESC order. This has been fixed by updating the code to handle Inclusion getting flipped due to the DESC order.

| https://issues.couchbase.com/browse/MB-35392[MB-35392^]
| *Summary*: The query service returned incorrect results as the implict covering of ANY predicate did not handle any part that was not covered. This has been fixed.

| https://issues.couchbase.com/browse/MB-34750[MB-34750^], https://issues.couchbase.com/browse/MB-34665[MB-34665^]
| *Summary*: Avoid IntersectScan when the index is a subset.

| https://issues.couchbase.com/browse/MB-34698[MB-34698^]
| *Summary*: Improved performance for count aggregate on full index scan by using CountTotal.

| https://issues.couchbase.com/browse/MB-34667[MB-34667^]
| *Summary*: Better identifier handling to determine whether an identifier should be covered or not.

| https://issues.couchbase.com/browse/MB-34660[MB-34660^]
| *Summary*: Fixed an issue where the implicit cover of nested array did not work as expected with arbitrary variables.

| https://issues.couchbase.com/browse/MB-34616[MB-34616^]
| *Summary*: When schema inferencing is run, document field names are no longer included in the log file.

| https://issues.couchbase.com/browse/MB-34544[MB-34544^]
| *Summary*: The query service now generates a special error for subquery build failures and sets the HTTP error code appropriately.

| https://issues.couchbase.com/browse/MB-34387[MB-34387^]
| *Summary*: Fixed an issue where the query engine returned incorrect results when using a partition index and the ORDER BY clause.
|===

==== Tools, Web Console (UI), and REST API

[#table_fixedissues_v603-tools-ui,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-35840[MB-35840^]
| *Summary*: Fixed the UI to display View index build progress status on the Views page.

| https://issues.couchbase.com/browse/MB-35130[MB-35130^]
| *Summary*: The `couchbase-cli user-manage` help has been corrected to note the valid role `query_manage_index`.

| https://issues.couchbase.com/browse/MB-34224[MB-34224^]
| *Summary*: The `couchbase-cli user-manage` help has been updated with the correct information on adding RBAC roles for multiple buckets.

| https://issues.couchbase.com/browse/MB-31517[MB-31517^]
| *Summary*: Fixed an issue where a `cbbackup` accumulative backup always performed a full backup after the first accumulative backup.
|===

[#release-602]
== Release 6.0.2

Couchbase Server 6.0.2, released in June 2019, is the second maintenance release in the 6.0.x series for Couchbase Server.
This release includes updated platform support and a few improvements in addition to bug fixes related to many components.

[#supported-platforms-602]
=== New Supported Platforms

This release adds support for the Red Hat Enterprise Linux (RHEL) 8 platform.

See xref:install:install-platforms.adoc[Supported Platforms] for the complete list of supported platforms.

[#fixed-issues-602]
=== Fixed Issues

The notable fixes in this release are listed below.

==== Analytics Service

[#table_fixedissues_v602-analytics,cols="25,66"]
|===
| Issue | Description


| https://issues.couchbase.com/browse/MB-33696[MB-33696^]
| *Summary*: The analytics service on one node failed to startup repeatedly due to a failure while performing a rollback and threw an exception. This has been fixed.

| https://issues.couchbase.com/browse/MB-33595[MB-33595^]
| *Summary*: Variables bound by a QuantifiedExpression were incorrectly included when computing free variables for that expression. This has been fixed and these variables will now be excluded from the free variable set.

| https://issues.couchbase.com/browse/MB-33564[MB-33564^]
| *Summary*: Fixed an issue where the predicate in the WHERE clause was incorrectly pushed through the running aggregate operator (AT subclause), which then lead to wrong results.

| https://issues.couchbase.com/browse/MB-33338[MB-33338^]
| *Summary*: It was observed that a rebalance in of new analytics nodes hangs indefinitely on a firewall misconfiguration where newly added nodes were unable to contact the CC. This has been fixed so that rebalance fails if the Keep-Nodes do not join within a reasonable timeframe (2 minutes).

| https://issues.couchbase.com/browse/MB-33025[MB-33025^]
| *Summary*: Fixed an issue where the analytics HTTP server incorrectly assumed that all request payloads are UTF-8 encoded. The analytics HTTP responses are encoded using system-default encoding and the service will now attempt to honor any requested encodings (Accept-Charset), or default to UTF-8.

| https://issues.couchbase.com/browse/MB-33016[MB-33016^]
| *Summary*: Fixed an internal compiler error caused by index selection when the search expression was not constant.

| https://issues.couchbase.com/browse/MB-32777[MB-32777^]
| *Summary*: Fixed an issue where array functions, most notably the array_intersect() function, caused an out of memory exception due to object creations, especially for large datasets.

| https://issues.couchbase.com/browse/MB-32775[MB-32775^]
| *Summary*: Fixed an issue to catch all unexpected exceptions on network threads and close the connection in such cases to avoid attempting to process the message causing the exception forever.

| https://issues.couchbase.com/browse/MB-32745[MB-32745^]
| *Summary*: The analytics service now uses the Couchbase temp directory, which is set to `/var/lib/couchbase/tmp` by default, and no longer requires access to the operating system's temp directory.
|===

==== Cross Datacenter Replication (XDCR)

[#table_fixedissues_v602-xdcr,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33970[MB-33970^]
| *Summary*: By default, XDCR will prevent replications from being created on a source ephemeral bucket with NRU policy. This specific release of Couchbase Server includes a special XDCR internal settings flag, `AllowSourceNRUCreation`, that allows replications to be created on a source ephemeral bucket with NRU policy.

----
curl -X POST -u Administrator:password http://127.0.0.1:9998/xdcr/internalSettings -d AllowSourceNRUCreation="true"
----

WARNING: Changing the internal replication setting will cause all XDCR processes to restart. This causes temporary disruption as all existing replications will have to restart.

| https://issues.couchbase.com/browse/MB-33671[MB-33671^]
| *Summary*: Following an issue on a remote cluster, XDCR failed to recover and threw an exception.

| https://issues.couchbase.com/browse/MB-33582[MB-33582^]
| *Summary*: After upgrading to 6.0.x, it was observed that the compression type field in the UI was not populated automatically. This has been fixed.

| https://issues.couchbase.com/browse/MB-32814[MB-32814^]
| *Summary*: Fixed REST endpoint error handling for settings errors and nil value types.
|===

==== Cluster Manager

[#table_fixedissues_v602-ns_server,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33750[MB-33750^]
| *Summary*: Fixed a race condition that was exposed when a supervisor that is shutting down normally, is for some reason brutally shutdown leaving an orphan child process. This rogue lease acquirer interfered with the operation of the orchestrator causing, for instance, rebalance to fail.

| https://issues.couchbase.com/browse/MB-33321[MB-33321^]
| *Summary*: Fixed an issue to prevent map corruption due to a change in `num_replicas` after an interrupted rebalance operation.
|===

==== Data Service

[#table_fixedissues_v602-kv-data,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-34507[MB-34507^]
| *Summary*: Fixed an issue where documents with a TTL, containing system XATTRs, and which are compressed, may have their datatype metadata incorrectly set. This prevents any subsequent modification of the XATTRs on the deleted document, until the document is re-created.

| https://issues.couchbase.com/browse/MB-34262[MB-34262^]
| *Summary*: Follow-on to MB-33919. Fixed issue where erroneous tombstone delete times could get used when performing a DCP backfill on ephemeral buckets.

| https://issues.couchbase.com/browse/MB-34173[MB-34173^]
| *Summary*: Fixed an issue where recovery failed due to invalid snapshot start (or end) on disk.

| https://issues.couchbase.com/browse/MB-33919[MB-33919^]
| *Summary*: The tombstone `delete-time` could be in the future or in the far past, causing the tombstone to be purged immediately or to remain on the disk for potentially long time. This has been fixed and the tombstone `delete-time` is now set to `ep_real_time` at the point of deletion.

| https://issues.couchbase.com/browse/MB-33918[MB-33918^]
| *Summary*: Fixed excessive triggering cursor dropping issue which caused Couchbase Server to attempt to recover more memory than required.

| https://issues.couchbase.com/browse/MB-33906[MB-33906^]
| *Summary*: Fixed an issue where the response to a getReplica command could be significantly delayed.

| https://issues.couchbase.com/browse/MB-33854[MB-33854^]
| *Summary*: Fixed an issue where the KV-Engine may incorrectly return ENGINE NOT_STORED to the client after trying to perform arithmetic operations if another client concurrently modified the same key.

| https://issues.couchbase.com/browse/MB-33773[MB-33773^]
| *Summary*: Fixed an issue where the KV-Engine may crash due to a race between DCP Consumer message processing and stream shutdown.

| https://issues.couchbase.com/browse/MB-33351[MB-33351^]
| *Summary*: Fixed an issue where the breakpad did not catch the memcached segfault.

| https://issues.couchbase.com/browse/MB-32840[MB-32840^]
| *Summary*: Fixed an issue where the audit daemon asserted when rotating an empty audit log causing a crash.

| https://issues.couchbase.com/browse/MB-32687[MB-32687^]
| *Summary*: Fixed an issue where signalling a connection could result in deadlock.

| https://issues.couchbase.com/browse/MB-32685[MB-32685^]
| *Summary*: Introduced a delay in updating the RBAC database revision number to avoid returning AUTH_STALE during a refresh of the RBAC database.

| https://issues.couchbase.com/browse/MB-32497[MB-32497^]
| *Summary*: Memcached connections may hang due to `Connection::signalIfIdle` triggering a deadlock when used from a different thread

| https://issues.couchbase.com/browse/MB-15009[MB-15009^]
| *Summary*: Improve the effectiveness of the active defragmenter to also defragment Document metadata (StoredValue objects) in addition to document values. This should reduce memory fragmentation for workloads which have multiple document metadata sizes (i.e. a range of key lengths).
|===

==== Eventing Service

[#table_fixedissues_v602-eventing,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33085[MB-33085^]
| *Summary*: The cbevent tool provides a way to recover the eventing service when eventing specific metakv contents and metadata bucket contents were corrupted or lost. This tool clears all the Functions (deployed and undeployed) and restores Eventing service to a clean state. To use the tool, run the following command:
`$ cbevent -<host> -<username> -<password> -flush`
|===

==== Full-Text Search Service

[#table_fixedissues_v602-fts,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33158[MB-33158^]
| *Summary*: Fixed an erratic crash issue observed with the use of queries like facets or sort on a custom field.
|===

==== Index Service

[#table_fixedissues_v602-gsi-views,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-34430[MB-34430^]
| *Summary*: Fixed a race condition on feed cleanup that caused the projector to panic.

| https://issues.couchbase.com/browse/MB-34405[MB-34405^]
| *Summary*: Fixed a memory leak caused by snapshot metadata objects linked list references.

| https://issues.couchbase.com/browse/MB-34385[MB-34385^]
| *Summary*: Fixed an issue where the admin console incorrectly displayed the node UUID instead of name in index definition after upgrade.

| https://issues.couchbase.com/browse/MB-34168[MB-34168^]
| *Summary*: Fixed a race condition while handling an error during move index.

| https://issues.couchbase.com/browse/MB-34166[MB-34166^]
| *Summary*: Fixed an issue where new index builds remained stuck if indexes on MAINT_STREAM were dropped before indexes on INIT_STREAM during rebalance.

| https://issues.couchbase.com/browse/MB-34164[MB-34164^]
| *Summary*: Fixed an issue where the index node crashed with too many open files.

| https://issues.couchbase.com/browse/MB-34003[MB-34003^]
| *Summary*: Index created failed as the index service was unable to create index replicas. This has been fixed.

| https://issues.couchbase.com/browse/MB-33945[MB-33945^]
| *Summary*: Fixed an issue where the Views engine returns a server error when bucket data is compressed and doc is not used in the view definition.

| https://issues.couchbase.com/browse/MB-33666[MB-33666^]
| *Summary*: It was possible to create an index with fewer replicas than the default num_replicas if you used nodes_list in the WITH clause with fewer nodes than the default number of replicas.

| https://issues.couchbase.com/browse/MB-33654[MB-33654^]
| *Summary*: Fixed an issue where frequent processing of old create tokens caused high CPU usage on index nodes.

| https://issues.couchbase.com/browse/MB-33649[MB-33649^]
| *Summary*: Fixed an issue where the projector took a long time to process admin requests if data flow was blocked.

| https://issues.couchbase.com/browse/MB-33640[MB-33640^]
| *Summary*: Fixed an issue to terminate all watcher goroutines upon close of MetadataProvider.

| https://issues.couchbase.com/browse/MB-33497[MB-33497^]
| *Summary*: The index service crashed during index creation if unicode special characters were used. This has been fixed.

| https://issues.couchbase.com/browse/MB-32932[MB-32932^]
| *Summary*: For non-partitioned indexes, the planner did not always use all the indexer nodes in cluster for planning. This has been fixed.

| https://issues.couchbase.com/browse/MB-32824[MB-32824^]
| *Summary*: Fixed an issue where the index planner could end up assigning the same instance id to lost replicas when more than 1 replica was lost.
|===

==== Install and Upgrade

[#table_fixedissues_v602-install,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-32748[MB-32748^]
| *Summary*: Sometimes, the Windows uninstaller left behind registry entries and subsequently this blocked upgrades on these machines. This has been fixed.
|===

==== Query Service

[#table_fixedissues_v602-query,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-34136[MB-34136^]
| *Summary*: Fixed an issue where the query engine returned incorrect results when using a partition index and the ORDER BY clause.

| https://issues.couchbase.com/browse/MB-33827[MB-33827^]
| *Summary*: Fixed an issue so that partition UNNEST scans do not use DISTINCT index aggregation.

| https://issues.couchbase.com/browse/MB-33757[MB-33757^]
| *Summary*: Queries with multiple array indexes caused inconsistent query plans, which then led to inconsistent and sometimes incorrect results. This has been fixed.

| https://issues.couchbase.com/browse/MB-33208[MB-33208^], https://issues.couchbase.com/browse/MB-33185[MB-33185^]
| *Summary*: Fixed an issue with connection pool leak that caused queries to fail.
|===

==== Security

[#table_fixedissues_v602-security,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-33764[MB-33764^]
| *Summary*: Fixed an issue where changing cluster CA and node certificates and incorrectly needed separate RBAC roles.

| https://issues.couchbase.com/browse/MB-33040[MB-33040^]
| *Summary*: The builtin Administrator user can now be authenticated via a client certificate.
|===

==== Tools, Web Console (UI), and REST API

[#table_fixedissues_v602-tools-ui,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-34126[MB-34126^]
| *Summary*: The `couchbase-cli` tool no longer enforces the 24 character password limit.

| https://issues.couchbase.com/browse/MB-33429[MB-33429^]
| *Summary*: The `couchbase-cli setting-alert` man page has been updated to include the `alert-communication-issue` flag.

| https://issues.couchbase.com/browse/MB-33204[MB-33204^]
| *Summary*: The `cbbackupmgr backup --resume` command incorrectly required full administrator privileges. This has been fixed so that any user with back and restore permissions can also resume a backup.

| https://issues.couchbase.com/browse/MB-32671[MB-32671^]
| *Summary*: The `cbimport` key generator did not handle escaped hash(#) or percent(%) characters correctly. This has been fixed.
|===

[#release-601]
== Release 6.0.1

Couchbase Server 6.0.1, released in February 2019, is the first maintenance release in the 6.0.x series for Couchbase Server.

[#supported-platforms-601]
=== New Supported Platforms

This release adds support for the following platforms:

* Amazon Linux 2
* Ubuntu 18.04

See xref:install:install-platforms.adoc[Supported Platforms] for the complete list of supported platforms.

[#deprecation-601]
=== Deprecated and Removed Platforms

Starting with this release, the following platforms are no longer supported:

* Ubuntu 14.04

Support for the following platforms will be removed in a future release:

* macOS 10.12 (Sierra)

[#fixed-issues-601]
=== Fixed Issues

The notable fixes in this release are listed below.

==== Analytics Service

[#table_fixedissues_v601-analytics,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-32466[MB-32466^]
| *Summary*: Index creation on meta fields is not allowed and trying to do so will result in an error.

| https://issues.couchbase.com/browse/MB-32455[MB-32455^]
| *Summary*: Fixed an issue where rebalance failed to complete with a badmatch error.

| https://issues.couchbase.com/browse/MB-32435[MB-32435^]
| *Summary*: Fixed an issue where a rebalance operation could fail due to the reuse of dataset IDs internally.

| https://issues.couchbase.com/browse/MB-32079[MB-32079^]
| *Summary*: When a dataverse was dropped, bucket listeners were not unregistered. Consequently, when the dataverse was re-created, the CONNECT LINK statement failed as it picked up the old bucket listeners. This has been fixed.

| https://issues.couchbase.com/browse/MB-32073[MB-32073^]
| *Summary*: Fixed an issue where the AnalyticsReader role, a read-only role, was incorrectly able to change the metadata and drop dataverses.

| https://issues.couchbase.com/browse/MB-31814[MB-31814^]
| *Summary*: Starting this release, the OpenJDK version 11 is bundled with the service. See xref:install:install-environments.adoc[Additional Requirements] for details.
|===

==== Cross Datacenter Replication (XDCR)

[#table_fixedissues_v601-xdcr,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-32299[MB-32299^]
| *Summary*: XDCR failed to replicate files larger than the network usage limit. This has been fixed so the bandwidth throttler can handle large documents with sizes greater than the usage limit.

| https://issues.couchbase.com/browse/MB-32221[MB-32221^]
| *Summary*: Uncompressed replication from 6.0 nodes to 5.0 nodes failed due to partial information being returned from the parts. This has been fixed to enable accurate detection of compression error code.

| https://issues.couchbase.com/browse/MB-32220[MB-32220^]
| *Summary*: Fixed an issue where replication stops and throws an exception due to a nil error.

| https://issues.couchbase.com/browse/MB-32219[MB-32219^]
| *Summary*: Fixed an issue where the XDCR log level setting was not retained when upgrading Couchbase Server from version 4.x to newer version.

| https://issues.couchbase.com/browse/MB-32042[MB-32042^]
| *Summary*: Fixed an issue where encrypted XDCR was incorrectly using port 8091.

| https://issues.couchbase.com/browse/MB-31857[MB-31857^]
| *Summary*: An error was thrown when DNS alternate addresses were used. This has been fixed so utilities return the hostname even if they can't find the port numbers.

| https://issues.couchbase.com/browse/MB-31764[MB-31764^]
| *Summary*: The unit of interval for XmemSelfMonitorInterval was incorrectly set to millisecond instead of second, causing an increase in the frequency of Xmem self monitor and the spurious Xmem is stuck error. This has been fixed.
|===

==== Data Service

[#table_fixedissues_v601-kv-data,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-32669[MB-32669^]
| *Summary*: Fixed an issue where a chain of events, active compression of an extended attribute value followed by eviction and then expiry, triggered an exception.

| https://issues.couchbase.com/browse/MB-32364[MB-32364^]
| *Summary*: Sub-document API single-path mutation ignored expiry if doc_flags included extras.

| https://issues.couchbase.com/browse/MB-32181[MB-32181^]
| *Summary*: If one or more Ephemeral buckets were present, then nonIO background tasks could be incorrectly scheduled, potentially resulting in DCP connection instability (premature disconnection). This has been fixed.

| https://issues.couchbase.com/browse/MB-32136[MB-32136^]
| *Summary*: When data corruption is detected on a data service node, relevant information that can help troubleshoot is now being logged.

| https://issues.couchbase.com/browse/MB-32135[MB-32135^]
| *Summary*: In some cases, the memory allocation failures were not handled causing "Write Commit Failure" errors or corruption in vBucket files.

| https://issues.couchbase.com/browse/MB-32078[MB-32078^]
| *Summary*: If an append/prepend request contended with another request at the Server, instead of automatically retrying on the Server (as expected), it returned EEXISTs back to the application.

| https://issues.couchbase.com/browse/MB-31968[MB-31968^]
| *Summary*: Audit logging has been updated to capture the user name when documents are created, updated, or deleted from the web console.

| https://issues.couchbase.com/browse/MB-31967[MB-31967^]
| *Summary*: Fixed an issue where the datatype field when using the DCP_OPEN flags incorrectly reflected the contents of the body payload and not the original datatype.

| https://issues.couchbase.com/browse/MB-31410[MB-31410^]
| *Summary*: If bucket memory usage exceeded the high watermark and reached 99% of the bucket quota, a race condition in KV-Engine DCP consumer was exposed. This could result in DCP messages being processed out-of-order.
|===

==== Eventing Service

[#table_fixedissues_v601-eventing,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31924[MB-31924^]
| *Summary*: Reduced excessive logging by Eventing service when the debugger is turned on.

| https://issues.couchbase.com/browse/MB-31923[MB-31923^]
| *Summary*: Following the failover of a vBucket, the Eventing service restarted streams with seqno from the latest failover log entry instead of using the entry where seqnoInFailoverLog <= lastProcessedSeqno. This resulted in missed events.

| https://issues.couchbase.com/browse/MB-31922[MB-31922^]
| *Summary*: Fixed an issue where some events were missing after a source bucket flush operation.
|===

==== Index Service

[#table_fixedissues_v601-gsi-views,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-32717[MB-32717^]
| *Summary*: Fixed an issue where the index service exceeded the memory quota even though only the number of items that were indexed was low.

| https://issues.couchbase.com/browse/MB-32507[MB-32507^]
| *Summary*: In a cluster with duplicate index names across buckets, replica repair failed after a node was added back to the cluster. This has been fixed.

| https://issues.couchbase.com/browse/MB-32433[MB-32433^]
| *Summary*: Plasma memory tuner will now increment indexer memory quota only if the indexer process' RSS is below the memory quota.

| https://issues.couchbase.com/browse/MB-32239[MB-32239^]
| *Summary*: The DCP noop interval has been lowered to 20sec to improve the chances of the projector receiving the noop message early and thus avoiding frequent roll backs.

| https://issues.couchbase.com/browse/MB-32228[MB-32228^]
| *Summary*: During warmup, one of the indexes with low number of items triggered an issue and caused the internal garbage collector to run forever. Thus causing the entire index service to stall during warmup. This issue was observed when using Plasma storage engine.

| https://issues.couchbase.com/browse/MB-31989[MB-31989^]
| *Summary*: Improved the DCP rollback handling mechanism. Instead of ignoring the disk snapshots before rolling back, the index service will now exhaust trying DCP stream requests with all the disk snapshots before rolling back to 0.

| https://issues.couchbase.com/browse/MB-31744[MB-31744^]
| *Summary*: An error is seen during a SUM aggregate pushdown when the entry value is greater than MaxInt64.

| https://issues.couchbase.com/browse/MB-31724[MB-31724^]
| *Summary*: Fixed an issue to enable creating secondary indexes on binary documents on meta.id(), meta.cas(), and meta.expiration().

| https://issues.couchbase.com/browse/MB-31587[MB-31587^]
| *Summary*: The index service would crash under some conditions if the data bucket was flushed while the index was being built.
|===

==== Query Service

[#table_fixedissues_v601-query,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-32366[MB-32366^]
| *Summary*: Starting this release, you can use the UNNEST scan to generate index spans on non-leading keys (non-array-index keys) if appropriate predicates exist on those keys.

| https://issues.couchbase.com/browse/MB-32306[MB-32306^]
| *Summary*: Index creation using the IN clause did not work as expected. This has been fixed.

However, when using the IN clause, ensure that your queries use the same IN terms in the same order as in the index.

| https://issues.couchbase.com/browse/MB-32301[MB-32301^]
| *Summary*: Fixed an issue so that when an on connection error is encountered, certain operations are retried before returning an error.

| https://issues.couchbase.com/browse/MB-32118[MB-32118^]
| *Summary*: Fixed an issue so that connections are properly discarded when an Out of Bound data error is encountered.
|===

==== Tools, Web Console (UI), and REST API

[#table_fixedissues_v601-tools-ui,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-32142[MB-32142^]
| *Summary*: Fixed an issue where the Views UI was unable to process the "undefined" value in a binary JSON document.

| https://issues.couchbase.com/browse/MB-31831[MB-31831^]
| *Summary*: The cbbackupmgr utility would hang and not return an error when trying to backup a cluster in which at least one node was down and had not failed over.

| https://issues.couchbase.com/browse/MB-31558[MB-31558^]
| *Summary*: All requests originating from the UI were authenticated using token based authentication, even when client certificate authentication is enabled on the Server and a client certificate is configured in the browser. This has been fixed to use client certificates for authentication in such scenarios.
|===

[#release-600]
== Release 6.0

Couchbase Server 6.0 was released in October 2018.

[#changes-in-behavior-600]
=== Major Behavior Changes

==== Analytics Service

There are a few significant changes to the production-ready version of the Analytics service.
You'll find this information handy if you've used the Analytics service in any of the Developer Preview versions of Couchbase Server.

* Bucket association is now automatic
+
The Developer Preview versions required you to explicitly associate the Couchbase Server buckets and Analytics buckets.
For example:
+
----
CREATE BUCKET ha WITH {"name":"health"}
----
+
The Analytics service buckets now automatically mirror Couchbase Server buckets and no special configuration is required to be able to create a dataset on a bucket.

* Dataset definitions no longer require the SHADOW keyword
+
The early Developer Preview releases (earlier than Couchbase Server 5.5) required the SHADOW keyword.
+
The Analytics service (Developer Preview version) was integrated with Couchbase Server during release 5.5 and the SHADOW keyword was made optional.
+
Starting with this release, using the SHADOW keyword is no longer allowed, and using it will return an error.
+
----
CREATE DATASET ((dataverse_name.)? dataset_name)? ON bucket_name (WHERE where_exp)?.
----

* `CONNECT/DISCONNECT BUCKET` have been replaced by `CONNECT/DISCONNECT LINK`
+
The `CONNECT` and `DISCONNECT` commands would activate or deactivate the dataset processing of data from Couchbase Server buckets.
+
You can now use the following syntax to connect all datasets in a dataverse:
+
----
CONNECT LINK (dataverse_name.)? Local (, (dataverse_name.)? Local)*
----

[IMPORTANT]
====
Analytics data from Developer Preview releases cannot be upgraded.

If you plan to use the production release of Couchbase Analytics in version 6.0, you must perform a fresh installation of Couchbase Server 6.0 on any existing Analytics nodes that are running a previous version; otherwise, the Analytics Service will not function properly.

When upgrading from Couchbase Server 5.5 to Couchbase Server 6.0 or later, any existing Analytics datasets must be removed before the upgrade and recreated afterwards, and data must be ingested again from the Data Service.
====

==== Full-Text Search Service

The following changes have been made to the Full-Text Search Service:

* Scorch is now the default xref:fts:fts-creating-indexes.adoc#index-type[index type] for all new Full Text Indexes.
+
After upgrading to Couchbase Server 6.0, existing Full Text Indexes will continue to use the Moss index type, while _new_ Full Text Indexes will use the Scorch index type by default.
These Moss indexes can be upgraded to Scorch by updating their respective definitions with the new index type.
+
NOTE: Existing indexes that do not have `indexType` explicitly specified in the index definition are considered to use the default index type.
These indexes will continue to use the Moss index type after upgrading to Couchbase Server 6.0.
However, any further updates to the index definition will result in the index being upgraded to Scorch.
Indexes created through the Couchbase Web Console automatically include the index type, therefore this issue only applies to indexes that were created using the command line.

* In Couchbase Server 6.0 Enterprise Edition, the Search Service explicitly requires encrypted port 18094 (`fts_ssl_port`) for scatter-gather operations between nodes that are running the Search Service (even if you're still using unencrypted port 8094 for client-to-node traffic).
The node-to-node traffic uses the HTTP/2 protocol and is encrypted with either the auto-generated certificate from installation, or with a xref:learn:security/certificates.adoc[custom node certificate] if one has been specified.
+
For more information, refer to xref:install:install-ports.adoc[Network and Firewall Requirements].

[#deprecation-600]
=== Deprecated Platforms and Features

Support for the following platforms will be removed in a future release:

* Amazon Linux AMI 2018.03, 2017.09
* CentOS 6
* macOS 10.11 (El Capitan)
* Oracle Linux 6
* Red Hat Enterprise Linux 6
* SUSE Linux Enterprise Server (SLES) 11
* Ubuntu 14.04
* Windows Server 2012

The use of view indexes is deprecated in N1QL only and will be removed in a future release.

[#supported-platforms-600]
=== New Supported Platforms

There are no new supported platforms in this release.

See xref:install:install-platforms.adoc[Supported Platforms] for the complete list of supported platforms.

[#known-issues-600]
=== Known Issues

==== Administration/Cluster Management

[#table_knownissues_v600-cluster,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-23074[MB-23074^]
| *Summary*: Performance issues may be observed when running Couchbase Server on CentOS 7.3 with kernel 3.10.0-514.6.
|===

==== Analytics Service

[#table_knownissues_v600-analytics,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30637[MB-30637^]
| *Summary:* Backup and restore for the Analytics service artifacts using the `cbbackupmgr` utility is currently not supported.

| https://issues.couchbase.com/browse/MB-30007[MB-30007^]
| *Summary*: It is possible for a CONNECT BUCKET statement to fail temporarily with the error message "The vbucket belongs to another server(0x7)" when rebalancing Data nodes.

*Workaround*: Retry the operation.

| https://issues.couchbase.com/browse/MB-29724[MB-29724^]
| *Summary*: Currently, the Analytics service supports index creation only when a dataset is disconnected.

| https://issues.couchbase.com/browse/MB-28544[MB-28544^]
| *Summary*: The UNION ALL operation does not work for all query types. For example, a query of the form shown below is not parsed correctly.

----
(SELECT ... FROM ... WHERE ...)
                  UNION ALL
                  (SELECT ... FROM ... WHERE ...)
----

*Workaround*: Remove the parentheses around the first subquery block.

----
SELECT ... FROM ... WHERE ...
                      UNION ALL
                      (SELECT ...
                      FROM ...
                      WHERE ...)
----
|===

==== Data Service

[#table_knownissues_v600-kv-data,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31410[MB-31410^]
| *Summary*: If bucket memory usage exceeds the high watermark and reaches 99% of the bucket quota, a race condition in KV-Engine DCP consumer is exposed. This may result in DCP messages being processed out-of-order.

| https://issues.couchbase.com/browse/MB-30074[MB-30074^]
| *Summary*: If the memcached process crashes while indexes are being rebalanced, the memcached process can fail to be brought online and the rebalance can get stuck. Manually stopping rebalance will bring the memcached process online.

| https://issues.couchbase.com/browse/MB-29809[MB-29809^]
| *Summary*: The `last_modified` attribute can be incorrect if a bucket was upgraded and contains old documents.

| https://issues.couchbase.com/browse/MB-37643[MB-37643^]
| *Summary*: When bucket-level expiry is enabled and the bucket(max) TTL is set to more than 30 days, then it uses an expiry offset based from when the Data Service is started, instead of an offset based from the current time.  This can result in documents that use the bucket TTL being expired prematurely.
|===

==== Eventing Service

[#table_knownissues_v600-eventing,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30772[MB-30772^]
| *Summary*: Killing an Eventing process externally may result in a loss of timers that have been dequeued but not run to completion.

| https://issues.couchbase.com/browse/MB-29360[MB-29360^]
| *Summary*: When Sync Gateway is deployed against a bucket, a single document update can be seen over DCP as multiple mutations, some modifying body and others modifying XATTRs. The Eventing service invokes OnUpdate for each such mutation as it does not distinguish at the DCP level if an update modified the body of a document, the XATTRs, or both.

*Workaround*: When both Eventing service and Sync Gateway are deployed against the same bucket, you must ensure that the Eventing code written is idempotent.
|===

==== Full-Text Search Service

[#table_knownissues_v600-fts,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31660[MB-31660^]
| *Summary*: The Search index file deletions take longer time than expected especially when the index is very large and is in a building-up phase while deleting.
This delays the expected freeing up of the actual disk space right after an index deletion. No file leaks have been observed yet.

*Workaround*: If you wait long enough, all the index files will get cleaned up eventually.
Hence in a tight disk space situation, you should be careful of this fact while performing subsequent index deletions and creations. With enough disk space configured, everything ought to work without much perceivable problems.

| https://issues.couchbase.com/browse/MB-31405[MB-31405^]
| *Summary*: This problem becomes a concern when the system is under heavy DGM (Disk Greater than Memory) condition. In such cases, the Search service ends up having too many files in the
system and due to concurrent file compactions, the overall indexing and querying becomes very slow.

*Workaround*: While there is no proper workaround for this issue, lowering the FTS memory quota (< 10GB) seems to help maintain a reasonably high average indexing throughput.

| https://issues.couchbase.com/browse/MB-27429[MB-27429^]
| *Summary*: Scorch indexes were found to contain duplicate pindexes.
|===

==== Index Service

[#table_knownissues_v600-gsi-views,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31039[MB-31039^]
| *Summary*: A disk usage spike is observed during the initial index build. The disk usage comes down once the log cleaner catches up.

| https://issues.couchbase.com/browse/MB-30011[MB-30011^]
| *Summary*: The rebalance progress (in percentage) during a GSI swap rebalance does not always increase linearly. Note that this issue does not persist and the percentage displayed returns to normal quickly.

| https://issues.couchbase.com/browse/MB-19869[MB-19869^]
| *Summary*: Rebalance fails when taking out failed over nodes running views, in certain circumstances.
|===

==== Install and Upgrade

[#table_knownissues_v600-install,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31393[MB-31393^]
| *Summary*: In some instances, the Windows Uninstaller can leave behind registry entries and subsequently block upgrades on these machines.

*Workaround*: Remove the registry entries manually before installing newer versions of Couchbase Server.

| https://issues.couchbase.com/browse/MB-17571[MB-17571^]
| *Summary*: On an undersized node, the default memory quota assigned to all the selected services by the server might result in a failure.

*Workaround*: Manually adjust the memory allocations appropriately.
|===

==== Query Service

[#table_knownissues_v600-query,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-29391[MB-29391^], https://issues.couchbase.com/browse/MB-29393[MB-29393^]
| *Summary*:  Large numeric values are reported incorrectly.
For example, the modulo operation or a scan for min int64 value returns an incorrect result in case of int64.
|===

==== Security

[#table_knownissues_v600-security,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31558[MB-31558^]
| *Summary*: All requests originating from the UI are currently authenticated using token based authentication, even when client certificate authentication is enabled on the Server and a client certificate is configured in the browser.

| https://issues.couchbase.com/browse/MB-26421[MB-26421^]
| *Summary*: The Security > Users tab in the UI does not list the default "administrator" user.Â 
|===

==== Tools, Web Console (UI), and REST API

[#table_knownissues_v600-tools-ui-rest-api,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31680[MB-31680^]
| *Summary*: Unable to log in to the Couchbase Server Web Console (UI) using Internet Explorer 11 or Edge browsers.
|===

[#fixed-issues-600]
=== Fixed Issues

The notable fixes in this release are listed below. See the Couchbase https://issues.couchbase.com/issues/?filter=16883[issue tracker^] for the complete list of enhancements and fixes in this release.

==== Data Service

[#table_fixedissues_v600-kv-data,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31619[MB-31619^]
| *Summary*: The Memcached logs always use Z (UTC) for timezone when logging instead of the current system timezone offset.

| https://issues.couchbase.com/browse/MB-31495[MB-31495^]
| *Summary*: Fetching a random key from the Data service may hang if the bucket contains zero documents.

| https://issues.couchbase.com/browse/MB-31481[MB-31481^]
| *Summary*: The data service engine may not send STREAM_END message to consumers if non-infinity end sequence number and cursor dropping occurs. This could cause clients such as cbbackupmgr to hang indefinitely.

| https://issues.couchbase.com/browse/MB-31175[MB-31175^]
| *Summary*: Ephemeral buckets can have tombstones purged before the configured metadata purge interval.

Ephemeral buckets can prematurely purge (discard) tombstones when under high memory and op/s load. As a consequence, DCP consumers fed by KV-Engine (such as replication, secondary indexing, views) may have tombstones not sent to them, meaning their dataset diverges from the Data Service - documents are not deleted from the DCP consumer.

| https://issues.couchbase.com/browse/MB-30920[MB-30920^]
| Authenticated users with full administrative privileges were able to access the diagnostic endpoint, `/diag/eval` remotely, allowing these users to run arbitrary code on the server host. This issue is addressed by only allowing full administrators to access this endpoint from localhost. This mitigates the issue as users that have access to the server host are already in a position to run arbitrary code.

Note that the `diag/eval` endpoint is authenticated and requires the highest privileges in the system (Full Admin). It is the case that a user with access to this endpoint can already delete, corrupt or coy all the data in the system. Customers can mitigate this issue by tightly controlling access to full administrative privileges.
|===

==== Full-Text Search Service

[#table_closedissues_v600-fts,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-30498[MB-30498^]
| *Summary*: Fixed an issue where documents were missing from the Scorch index but were intact in an upside_down index.

| https://issues.couchbase.com/browse/MB-28847[MB-28847^]
| *Summary*: Fixed an issue where the memory usage during search index build was found to overshoot the RAM quota.

| https://issues.couchbase.com/browse/MB-27429[MB-27429^]
| *Summary*: Scorch indexes were found to contain duplicate pindexes.

| https://issues.couchbase.com/browse/MB-25714[MB-25714^]
| *Summary*: On Windows platform, a very high memory/CPU usage was observed when search service was indexing using the fts index. This issue is not seen with the new default 'Scorch' index.
|===

==== Index Service

[#table_fixedissues_v600-gsi-views,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-31315[MB-31315^]
| *Summary*: Fixed an issue where the index service threw an error if an index was dropped when index mutation was ongoing.
|===
