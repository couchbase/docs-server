[#topic_gbk_tyh_t5]
= Release Notes for Couchbase Server 5.1.x

Couchbase Server 5.1.0 was released in February 2018.
In addition to bug fixes, this release includes enhancements to certificate-based authentication and the [.cmd]`cbbackupmgr` utility.
The following sections list the fixed issues, known issues, and deprecated items in this release.

== Major Changes from Version 5.0

[#ul_ibr_vbs_ycb]
* Support for Debian 9 has been added.
* Certificate-based authentication now supports multiple prefixes.

[#v510-known-issues]
== Known Issues

[#table_knownissues_v510,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-27688[MB-27688]
| The query service does not support http/2 protocol.
Consequently, if you want to use CURL, you must pass "`--http1.1`" as one of the parameters when using CURL to execute the query via the REST API.
|===

[#v510-fixed-issues]
== Fixed Issues

*Cross Datacenter Replication (XDCR)*

[#table_fixedissues_xdcr_510,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-27850[MB-27850]
| Whenever simultaneous replications were set up using XDCR, it was observed that data was not replicated via the second replication stream.
This was basically due to rules enforced to manage the execution of simultaneous mutations to the document.

| https://issues.couchbase.com/browse/MB-25878[MB-25878]
| When the source node was upgraded in a unidirectional replication from 4.1 to 5.x, the GoGC global setting was set to 0 instead of a higher number.
|===

*Data Service*

[#table_fixedissues_data_510,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-26126[MB-26126]
| Statistics for non-resident documents could be incorrect when operating on documents which contained system XATTRs.

When using Couchbase Server 5.0 with Sync Gateway 1.5+ and the Mobile Convergence feature was enabled in Sync Gateway (enable_extended_attributes), the count of documents which are not resident could be under-reported in the UI.

| https://issues.couchbase.com/browse/MB-26037[MB-26037]
| Rebalance failed initially if the destination node for a vBucket required a rollback.

During a rebalance, if the destination node for a particular vBucket already had a previous, outdated version of that vBucket then the rebalance failed initially.

| https://issues.couchbase.com/browse/MB-25938[MB-25938]
| If a document contained Extended Attributes and a Key/Value mutation request changed one of those XATTRs, the previous XATTR values were written to in a non-atomic way.
This means that there was a potential race if another concurrent request was also accessing the same document at the same time - the other request could read a partial or corrupted value for the document.

| https://issues.couchbase.com/browse/MB-25935[MB-25935]
| The data service incorrectly returned TEMP_FAIL for locked keys instead of ERROR_LOCKED.

| https://issues.couchbase.com/browse/MB-25785[MB-25785]
| A backup resume operation on ephemeral buckets failed if there had been a data rollback during the previous backup that failed.
|===

*Index Service*

[#table_fixedissues_index_510,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-26085[MB-26085]
| Rebalancing the index nodes failed with a timeout when the planner took a long time to execute.
|===

*Query Service*

[#table_fixedissues_query_510,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-27360[MB-27360]
| On Windows platform, pasting a 1000+ character query into the cbq shell resulted in a partial query being pasted.
This issue was observed after the query had been pasted a few times (>3).

| https://issues.couchbase.com/browse/MB-25901[MB-25901]
| The ORDER BY operator sometimes continued to sort even after the operation was stopped leading to an exception.
|===

*Search Service*

[#table_fixedissues_fts_510,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-25915[MB-25915]
| Deleting FTS indexes during a rebalance operation may have produced a rare situation that resulted in an unbreakable loop with log message: "[.output]` rebalance: waitAssignPIndexDone, awaiting a stats sample grab for pindex` "
|===

*Tools*

[#table_fixedissues_tools_510,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-27459[MB-27459]
| The cbbackup utility corrupted documents with extended attributes(XATTRs).

| https://issues.couchbase.com/browse/MB-27366[MB-27366]
| The cbbackupmgr utility failed to backup directly from couchstore-files when the bucket was created on a version prior to 4.6 and threw the following error: “[.output]`error: could not read couchstore file due to unsupported file format version; exception: unpack requires a string argument of length 18`”

| https://issues.couchbase.com/browse/MB-27270[MB-27270], https://issues.couchbase.com/browse/MB-27279[MB-27279]
| Couchbase Server version 5.0 introduced a new storage system “plasma” available only in the Enterprise Edition.
When using the Enterprise Edition, you had a choice of “plasma” or “forestDB” for storage and the default was set to “plasma”.
Since “plasma” storage was not available in the Community Edition, no storage was allocated when other services were started.
This has been fixed and the default storage in the Community Edition now points to ForestDB.

| https://issues.couchbase.com/browse/MB-25785[MB-25785]
| A backup resume on ephemeral buckets failed if there had been a data rollback during the prior backup that failed.
|===

*Web Console*

[#table_fixedissues_webconsole_510,cols="25,66"]
|===
| Issue | Description

| https://issues.couchbase.com/browse/MB-27733[MB-27733]
| When creating more than 10 views, the confirmation dialog informing you of the performance impact was not clickable.
This has been fixed and the dialog is now clickable.

| https://issues.couchbase.com/browse/MB-27221[MB-27221]
| From the Query Monitoring tab, sorting the completed requests on the “run at” column did not appear to work as expected.
This was because the “run at” column did not display the date, making the result of the sorting operation appear incorrect, since the same time on two different dates would appear in different spots on the list.
This has been fixed by adding a clickable tooltip to the “run at” time which displays the complete time including the date.

| https://issues.couchbase.com/browse/MB-25959[MB-25959]
| The Query Workbench incorrectly displayed a warning for a valid index creation statement.
This was due to an incorrect handling of the 'bind' expression by the client-side parser.
|===
