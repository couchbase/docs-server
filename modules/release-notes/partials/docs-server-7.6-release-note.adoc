[#new-features]
== New Features and Enhancements

include::introduction:partial$new-features-76.adoc[]

=== Cluster Manager

[#table-new-features-760-cluster-manager, cols="10,40"]
|===
|Feature | Description

| https://issues.couchbase.com/browse/MB-57470[MB-5740]
| New bucket capability for replica reads using sub-document API.

| https://issues.couchbase.com/browse/MB-59068[MB-59068]
| New `pruneAge` audit setting to set the minimum duration to retain audit files.

|===

=== Query Service

[#table-new-features-760-query-service, cols="10,40"]
|===
|Feature | Description

| https://issues.couchbase.com/browse/MB-57500[MB-57500]
| `num_replica` configured for each index can now be found through {sqlpp} statement: `system:indexes`


|===

[#deprecated-features-and-platforms-760]
== Deprecated and Removed Features and Platforms


* Removed support for TLS 1.0 and 1.1.
Both the standards bodies and Couchbase have already deprecated these versions due to their lack of security. (https://issues.couchbase.com/browse/MB-58045[MB-58045])

[#fixed-issues-760]
== Fixed Issues

This release contains the following fixes.

=== Cluster Manager

[#table-fixed-issues-76-cluster-manager,cols="10,40,40]
|===

|Issue | Description | Resolution

| https://issues.couchbase.com/browse/MB-60568[MB-60568]
| CPU utilization rate may be incorrect in a VM. +
When running a VM on a XEN hypervisor,
stats were computed using the number of processors configured for the entire system.
a| Stats now use the number of logical processors online on the system. This correction affects the following stats:

* `sys_cpu_host_cores_available`
* `sys_cpu_utilization_rate`
* `sys_cpu_host_utilization_rate`

|===

=== Storage
[#table-fixed-issues-76-storage, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://issues.couchbase.com/browse/MB-58088[MB-58088]
| KV returns `temporary failure` for invalid unlock request.
| Introduced the `NOT_LOCKED` `(0x0e)` MCBP status code. +
When issuing a second Unlock with the same CAS, the server should return `NOT_LOCKED`, not `TEMPFAIL`.
Clients with `XERROR` support will receive the new status code, and will
use the JSON error map to interpret it.

| https://issues.couchbase.com/browse/MB-59060[MB-59060]
| KV returns "temp fail" in full eviction instead of an `unlock` request for a non-cached document.
The server should return `KEYENOENT` (key/doc does not exist), not `ETMPFAIL`.
| The server now correctly returns `KEYENOENT`. Moreover, when the server issues `unlock` requests for existing documents, such that some of them have been evicted, then the server will return `NOT_LOCKED` for all the requests.

|===

=== XDCR
[#table-fixed-issues-76-xdcr, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://issues.couchbase.com/browse/MB-58671[MB-58671]
| Erroneous network conditions could lead to checkpoint manager slow at stopping.
| Ensure the checkpoint manager stops, even if it has trouble starting due to network issues.

| https://issues.couchbase.com/browse/MB-59233[MB-59233]
| In low-priority replications, it is possible for a Data Service stream to end temporarily and for XDCR to not handle it correctly. This will lead to a hung replication.
| Now, XDCR restarts the pipeline if a data service stream ends. +
  This ensures replication continues.

| https://issues.couchbase.com/browse/MB-59320[MB-59320]
|  Race condition in starting and stopping XDCR source nozzle could lead to a memory leak
| Fixed the race condition

| https://issues.couchbase.com/browse/MB-59416[MB-59416]
|  If the Bandwidth throttler is used, race condition may occur during pipeline shutdown where the `Out` nozzle is unable to exit
| Fix race condition during shutdown to ensure out nozzle closes properly.

| https://issues.couchbase.com/browse/MB-59499[MB-59499]
| In a slow running backfill replication, XDCR could be too aggressive in restarting pipelines.
| Ensure XDCR does not restart backfill pipelines if some progress is observed periodically.

| https://issues.couchbase.com/browse/MB-59669[MB-59669]
|  If a replication is idle without mutations, XDCR is unable to detect that a target bucket failover occurred.
| Ensure target-side failover detection takes place, even if the source has no incoming mutations

| https://issues.couchbase.com/browse/MB-59745[MB-59745]
| When a target document is locked, and a non-optimistic LWW replication is taking place, XDCR will retrieve a "locked CAS" of maxUint. This will cause the source mutation to lose, and lead to scenarios where the mutation is not replicated, even if it should have won conflict resolution.
| XDCR will retry conflict resolution for the duration that the document is locked in pessimistic replication. This will ensure that a valid CAS is used for source-side conflict resolution.

|===


=== Query Service

[#table-fixed-issues-76-query-service, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://issues.couchbase.com/browse/MB-39484[MB-39484]
| Remove N1QL support for password-less buckets.
| Password-less bucket support removed.

| https://issues.couchbase.com/browse/MB-58648[MB-58648]
| Observed a memory leak with multiple executions of the same UDF function.
| Fix the condition whereby UDF functions are being re-loaded into cache from storage every time the function is executed.

| https://issues.couchbase.com/browse/MB-60942[MB-60942]
| ANSI MERGE errors on multiple DELETE operations.
| Fixed the behavior where a target document (to be deleted) matches  multiple source documents.
  Instead of silently ignoring the second deletion, the system will now trigger an error if the target document matches multiple source documents.
|===


=== Index Service

[#table-fixed-issues-76-index-service, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://issues.couchbase.com/browse/MB-59138[MB-59138]
| Index has 0 entries when `NESTED ARRAY FLATTEN_KEYS()`, and one of them has missing entries.
| Null or missing entries are now correctly expanded for nested arrays.

|===

=== Search Service
[#table-fixed-issues-76-search-service, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://issues.couchbase.com/browse/MB-59858[MB-59858]
| When a Search index name is too long, the index silently fails to ingest documents.
|The UI will now flag instances where the chosen index name is too long.

| https://issues.couchbase.com/browse/MB-60718[MB-60718]
| Index alias queries not returning cumulative (duplicate) results from its targets.
| [TBA]

|===

=== Tools

[#table-fixed-issues-76-tools, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://issues.couchbase.com/browse/MB-57988[MB-57988]
| `cli` should allow modifying existing collection's maxTTL
| [TBA]
|===

[#known-issues-760]
== Known Issues

This release contains the following known issues.

=== Query Service

[#table-known-issues-760-query-service, cols="1,2,2"]
|===
|Issue | Description | Workaround

| https://issues.couchbase.com/browse/MB-60958[MB-60958]
| `cbq` and the `query workbench`  will allow a user to edit documents in the system collections,
even if they lack the necessary `RBAC` privileges.
|

|===

