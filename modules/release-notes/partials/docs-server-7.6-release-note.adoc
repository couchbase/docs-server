[#new-features]
== New Features and Enhancements

include::introduction:partial$new-features-76.adoc[]

=== Storage Engine

[#table-new-features-760-storage-engine, cols="10,40"]
|===
|Feature | Description

| https://issues.couchbase.com/browse/MB-52270[MB-52270]
| Prior to the upgrade,  total disk usage stats only tracked the live completed `sstable` files. +
The stats now also include the transient files in progress, state files, and configuration files.

|===

=== Query Service

[#table-new-features-760-query-service, cols="10,40"]
|===
|Feature | Description

| https://issues.couchbase.com/browse/MB-30383[MB-30383]
| The {sqlpp} language adds an OFFSET clause to the DELETE statement.

| https://issues.couchbase.com/browse/MB-49506[MB-49506]
| The {sqlpp} language adds a GROUP AS clause to the GROUP BY clause.

| https://issues.couchbase.com/browse/MB-26683[MB-26683]
| The {sqlpp} language adds a FORMALIZE() function.

| https://issues.couchbase.com/browse/MB-57486[MB-57486]
| The {sqlpp} language adds a NODE_UUID() function.

| https://issues.couchbase.com/browse/MB-57961[MB-57961]
| The {sqlpp} language adds multi-byte aware string functions.

| https://issues.couchbase.com/browse/MB-22424[MB-22424]
| The {sqlpp} language adds support for sequences.

| https://issues.couchbase.com/browse/MB-54197[MB-54197]
| The {sqlpp} language adds support for the LATERAL keyword in ANSI joins, ANSI nests, and comma-separated joins.

| https://issues.couchbase.com/browse/MB-56524[MB-56524]
| The {sqlpp} language adds an EXPLAIN FUNCTION statement.

| https://issues.couchbase.com/browse/MB-11512[MB-11512]
| The WITH clause adds support for recursive CTEs.

| https://issues.couchbase.com/browse/MB-38696[MB-38696]
| The CREATE COLLECTION statement adds support for maxTTL.

| https://issues.couchbase.com/browse/MB-53472[MB-53472]
| The cbq shell adds a `-query_context` command line option.

| https://issues.couchbase.com/browse/MB-56912[MB-56912]
| The cbq shell adds an `-advise` command line option.

| https://issues.couchbase.com/browse/MB-56743[MB-56743]
| The Query Admin REST API adds an `/admin/gc` endpoint to run the garbage collector.

| https://issues.couchbase.com/browse/MB-56372[MB-56372]
| When a query executes a user-defined function, profiling information is now available for any queries within the UDF.

| https://issues.couchbase.com/browse/MB-52634[MB-52634]
| Named parameters can now be prefixed by `$` or `@` in a query.

| https://issues.couchbase.com/browse/MB-51250[MB-51250]
| Users can now create a JavaScript function and the corresponding {sqlpp} function in a single statement.

| https://issues.couchbase.com/browse/MB-57537[MB-57537]
| The Query service adds new command line and UI parameters to support node quotas.

| https://issues.couchbase.com/browse/MB-55036[MB-55036]
| The Query service adds new cluster-level, node-level, and request-level parameters to support reading from replica vBuckets.

| https://issues.couchbase.com/browse/MB-56068[MB-56068]
| The Query service adds cluster-level and node-level parameters to limit the number of CPUs.

| https://issues.couchbase.com/browse/MB-57964[MB-57964]
| The Query service adds cluster-level and node-level parameters to limit the size of explain plans in the completed requests catalog.

| https://issues.couchbase.com/browse/MB-56367[MB-56367]
| The Query service adds cluster-level and node-level parameters to support node quotas.

| https://issues.couchbase.com/browse/MB-52184[MB-52184]
| The Query service adds support for sequential scans, which enables querying without an index.

| https://issues.couchbase.com/browse/MB-52359[MB-52359]
| The node-level and request-level N1QL Feature Control parameters now accept hexadecimal strings or decimal integers.

| https://issues.couchbase.com/browse/MB-57717[MB-57717]
| Optimizer statistics for the Query service are now stored in the `&lowbar;system.&lowbar;query` collection for each bucket.

| https://issues.couchbase.com/browse/MB-57931[MB-57931]
| The `/clusterInit` endpoint in the Nodes and Clusters REST API adds support for Query memory quotas.

| https://issues.couchbase.com/browse/MB-58465[MB-58465]
| If an uncovered query only references specific fields, the fetch operation retrieves just the necessary fields from the Data service, instead of the entire document.

| https://issues.couchbase.com/browse/MB-57496[MB-57496]
| The SORT BY and GROUP BY operations overspill to disk if they exceed the Query service memory quota.

| https://issues.couchbase.com/browse/MB-53384[MB-53384]
| Correlated subqueries can use primary index or sequential scan.

| https://issues.couchbase.com/browse/MB-29708[MB-29708]
| INSERT, DELETE, UPDATE, and UPSERT operations can perform mutations as bulk operations.

|===

[#deprecated-features-and-platforms-760]
== Deprecated and Removed Features and Platforms

* The following operating systems are no longer supported:


[#fixed-issues-760]
== Fixed Issues

This release contains the following fixes.

=== XDCR
[#table-known-issues-76-xdcr, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://issues.couchbase.com/browse/MB-58671[MB-58671]
| Erroneous network conditions could lead to checkpoint manager slow at stopping.
| Ensure the checkpoint manager stops, even if it has trouble starting due to network issues.

| https://issues.couchbase.com/browse/MB-59233[MB-59233]
| In low-priority replications, it is possible for a Data Service stream to end temporarily and for XDCR to not handle it correctly. This will lead to a hung replication.
| Now, XDCR restarts the pipeline if a data service stream is ended. +
  This ensures replication continues

| https://issues.couchbase.com/browse/MB-59320[MB-59320]
|  Race condition in starting and stopping XDCR source nozzle could lead to a memory leak
| Fixed the race condition

| https://issues.couchbase.com/browse/MB-59416[MB-59416]
|  If the Bandwidth throttler is used, race condition may occur during pipeline shutdown where the `Out` nozzle is unable to exit
| Fix race condition during shutdown to ensure out nozzle closes properly.

| https://issues.couchbase.com/browse/MB-59499[MB-59499]
| In a slow running backfill replication, XDCR could be too aggressive in restarting pipelines.
| Ensure XDCR does not restart backfill pipelines if some progress is observed periodically.

| https://issues.couchbase.com/browse/MB-59669[MB-59669]
|  If a replication is idle without mutations, XDCR is unable to detect that a target bucket failover occurred.
| Ensure target-side failover detection takes place, even if the source has no incoming mutations

| https://issues.couchbase.com/browse/MB-59745[MB-59745]
| When a target document is locked, and a non-optimistic LWW replication is taking place, XDCR will retrieve a "locked CAS" of maxUint. This will cause the source mutation to lose, and lead to scenarios where the mutation is not replicated, even if it should have won conflict resolution.
| XDCR will retry conflict resolution for the duration that the document is locked in pessimistic replication. This will ensure that a valid CAS is used for source-side conflict resolution.

|===


=== Query Service

[#table-known-issues-76-query-service, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://issues.couchbase.com/browse/MB-39484[MB-39484]
| Remove {sqlpp} support for password-less buckets.
| Password-less bucket support removed.

| https://issues.couchbase.com/browse/MB-52228[MB-52228]
| CREATE INDEX fails when the index key expression matches the keyspace name.
| If the index key expression matches the keyspace name, the index key expression is no longer converted to SELF.

| https://issues.couchbase.com/browse/MB-60762[MB-60762]
| ANSI MERGE with DELETE does not always generate an error when the target document matches multiple source documents.
| ANSI MERGE with DELETE now always generates an error when the target document matches multiple source documents, in compliance with the SQL standard.

| https://issues.couchbase.com/browse/MB-59501[MB-59501]
| The system catalog allows users to see items without RBAC authentication or authorization.
| Valid RBAC permissions are required to query the system catalog, and to view items stored in the catalog.

|===

=== Search Service

[#table-known-issues-76-search-service, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://issues.couchbase.com/browse/MB-59858[MB-59858]
| When a Search index name is too long, the index silently fails to ingest documents.

|The UI will now flag instances where the chosen index name is too long.

|===


