== Release 7.6.4 (October 2024)

Couchbase Server 7.6.4 was released in October 2024. This maintenance release contains new features and fixes several known issues.

For detailed information on new features and enhancements, please see xref:introduction:whats-new.adoc[].

[#fixed-issues-764]
=== Fixed Issues

This release contains the following fixes:

==== Cluster Manager

[#table-fixed-issues-764-cluster-manager,cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-62219[MB-62219]
| The cluster manager was unable to rotate the root certificate when a new root uses the same private key as the old root.
| Issue resolved.

| https://jira.issues.couchbase.com/browse/MB-62413[MB-62413]
| When a username is extracted from a client certificate, no check was made for its existence on the server.
| The username extracted from the client certificate is checked for its existence in couchbase-server.

|===

==== Storage Engine
[#table-fixed-issues-764-storage-engine,cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-63261[MB-63261]
| An issue occurred caused by a race condition in the index recovery code path, which may result in item count mismatch and wrong query results. +
Prior to Release 7.6.0, this  issue may occur during an Indexer restart.
However, as part of the file-based rebalance process introduced in 7.6.0, a recovery of the index is performed after the index is moved, which increases the likelihood that the race condition might be reached.
| The race condition has been addressed and the issue is resolved.

|===

==== XDCR
[#table-fixed-issues-764-xdcr,cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-62383[MB-62383]
| In rare situations, a document with a very large CAS could be inserted into a bucket. It  was possible for XDCR to replicate this document with malformed CAS to other clusters.
| XDCR now has built-in guardrails to prevent documents with malformed CAS beyond a certain drift threshold from being replicated and then to notify the user if this situation occurs via UI and logs.

| https://jira.issues.couchbase.com/browse/MB-62410[MB-62410]
| Connection Pre-check did support all inputs normally accepted by XDCR
| XDCR connection pre-check now supports alternate addresses, DNS SRV, and works identically to XDCR remote cluster references.

| https://jira.issues.couchbase.com/browse/MB-63738[MB-63738]
| XDCR dashboard on Source cluster now shows a UI alert when a pipeline is stuck due to EACCESS errors while writing to Target cluster.
| Issue resolved.

|===


==== Query Service
[#table-fixed-issues-764-query-service,cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-62932[MB-62932]
| The execution of prepared statements containing (`*`) expressions in the projection can return incorrect results in scenarios where the encoded plans of such statements need to be decoded before execution.

| Issue resolved.

| https://jira.issues.couchbase.com/browse/MB-63016[MB-63016]
| If an index is defined with a `CASE` statement as an index key, and the `CASE` statement contains a not-equal expression, and the same `CASE` statement is used in the projection clause of a query, then the covering index scan is not performed properly.
| The issue is fixed, and we now use covering index scan appropriately.

| https://jira.issues.couchbase.com/browse/MB-63069[MB-63069]
| In versions `7.6.2`, and `7.6.3`, queries with a `FROM` clause containing an `UNNEST` and `ORDER BY` with a `LIMIT` or `LIMIT + OFFSET` clauses, then in some cases incorrect results were observed when the `ORDER` could not be pushed down to the indexer.
| Issue resolved.

|===

==== Eventing Service
[#table-fixed-issues-764-eventing-service,cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-63014[MB-63014]
| In earlier versions of Couchbase, when an eventing function is under deployment or being resumed,
then, if the function has any destination bucket bindings whose LCB instances are to be bootstrapped,
and there were ongoing KV service issues, (e.g., a network partition, firewall on the KV port, etc.),
`Eventing` used to leave these LCB instances in an unhealthy state and skip past them to continue with deployment. +
  Unfortunately, these LCB handles will never be repaired, even if the KV issues are eventually resolved. +
  This resulted in any subsequent operations scheduled on this LCB instance to fail and not return control.
  From the customer's perspective, the eventing function was stuck.

| `Eventing` keeps track of the LCB instances' statuses
and retries bootstrapping the unhealthy LCB instance(s) until the operation timeout. +
The operation timeout is derived from the script timeout. +
This process is described as "lazy" because `Eventing` retries the LCB bootstrap process
when the customer's JavaScript code uses the corresponding bucket binding(s). +
With this change in approach,
Eventing can ensure that the customer's JavaScript code does not get stuck and times out the mutation's processing instead.


|===

==== Index Service
[#table-fixed-issues-764-index-service,cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-61387[MB-61387]
| To speed up the initial process of building the index,
the index service has an optimization that skips checking for existing entries and directly adds new ones.
This optimization is crucial for the initial build but should not be used for updates to existing indexes.
Unfortunately, in a rare sequence of events, all indexes might be enabled for this optimization,
leading to duplicate entries in the storage layer, leading to incorrect results.
| The optimization is now only enabled for those indexes that are undergoing an initial build process.

| https://issues.couchbase.com/browse/MB-62220[MB-62220]
| We have an optimization in place which avoids unnecessary index movements when a swap rebalance is performed.
A minor bug in this optimization interfered with rebuilding user-dropped replicas/lost replicas during such a rebalance
where we didn't consider new nodes coming in when placing lost indexes.
| Adds a sorted pseudo-random order where we give higher priority to new incoming nodes  followed by old nodes staying in the cluster when we try to place lost indexes.
Hence, we can repair lost replicas.

| https://jira.issues.couchbase.com/browse/MB-62919[MB-62919]
| After enabling GSI shard-based rebalance from the Web UI and saving the settings, it is not possible to disable the same setting by unticking the box. The box is greyed out and cannot be interacted with.
| Issue resolved.

| https://jira.issues.couchbase.com/browse/MB-63276[MB-63276]
| An issue in the rebalancer caused several partitions to miss streaming mutations when partitioned indexes were moved during file-based rebalances.  This issue resulted in corrupt indexes as not all data was processed. +
The issue occurred only with partitioned indexes with file-based rebalances enabled.
| Issue resolved

|===


==== Search Service
[#table-fixed-issues-764-search-service,cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-62427[MB-62427]
| The absence of `segmentVersion` within `params.store` of index definitions in `6.x` leads to a situation  of `v11` and `v16` segments being mixed,
which in turn, leads to panics arising while building `v16` segments.

This problem only occurs when `6.x` index definitions survive an upgrade from `6.x` to `7.6.x` but not from `7.x` from `7.[0-2].x` to
`7.6.x` because `segmentVersion` exists by default for indexes introduced in any version `7.0+`.

| Issue resolved.

|===


==== Backup Service
[#table-fixed-issues-764-backup-service,cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-61013[MB-61013]
| The Backup service should not allow backups to be created in the data directory
because the server could delete the backup files.
| The server will not allow archives to be created in the data directory.

|===



[#known-issues-764]
=== Known Issues

This release contains the following known issues:

==== Query Service

[#table-known-issues-764-query-service, cols="10,40,40"]
|===
|Issue | Description | Workaround

| https://jira.issues.couchbase.com/browse/MB-63414[MB-63414]
| If `memory_quota` is set to a value and Query uses a non-covered array index, it can result in `Request has exceeded memory quota` error.
a| Disable memory quota or https://www.couchbase.com/support/working-with-technical-support/[contact support] for alternatives.

NOTE: This issue is fixed on Capella.

|===


