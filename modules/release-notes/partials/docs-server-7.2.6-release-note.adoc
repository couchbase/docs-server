[#release-726]
== Release 7.2.6 (September 2024)

Couchbase Server 7.2.6 was released in September 2024.
This maintenance release contains the following fixes.

For details on new features and enhancements, see the  xref:introduction:whats-new.adoc[What's New page].


=== Fixed Issues

==== Cluster Manager
[#table-fixed-issues-726-cluster-manager, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-62219[MB-62219]
| You could not rotate root certificates when a new root used the same private key as the old root.
| Issue resolved.

| https://jira.issues.couchbase.com/browse/MB-62413[MB-62413]
| When a username is extracted from a client certificate, no check for the user existing locally on the cluster was made.
| The cert user will only match if her username matches an existing record on the cluster.

|===

==== Storage Engine
[#table-fixed-issues-726-storage-engine, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-62984[MB-62984]
| When a Couchbase Data Service experiences a hard failover or crashes with data loss, DCP clients (like those used with Elasticsearch and Kafka) might receive incomplete or partial snapshots of the data. This incomplete data can lead to  rare situations (edge cases) where the Data Service ends up crashing repeatedly.
| Issue resolved.

| https://jira.issues.couchbase.com/browse/MB-63286[MB-63286]
| An issue occurred, caused by a race condition in the index recovery code path, which sometimes resulted in item count mismatches and incorrect query results. The issue sometimes occurred during an Indexer restart.
| Issue resolved.

|===



==== XDCR

[#table-fixed-issues-726-xdcr, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-62005[MB-62005]
| When none of the nodes in the remote reference DNS SRV entry is reachable, XDCR could be stuck working off of a stale list of nodes.
| Now, XDCR will be able to re-bootstrap from the top DNS SRV entry

| https://jira.issues.couchbase.com/browse/MB-62006[MB-62006]
| Stale connectivity errors were not cleared.
| Stale connectivity errors are now cleared correctly.

| https://jira.issues.couchbase.com/browse/MB-62008[MB-62008]
| XDCR on Non-KV nodes may have a goroutine stuck due to the lack of listeners on a service channel
| Issue resolved.

| https://jira.issues.couchbase.com/browse/MB-62097[MB-62097]
| When the pipeline is unable to start, Prometheus metrics did not capture the errors and the error state.
| The Prometheus stats will now correctly indicate the error situation as in error, as  well as the number of errors.

| https://jira.issues.couchbase.com/browse/MB-62104[MB-62104]
| Connectivity node status map might not be synced with `cachedRefNodesList` after refresh
| When there is a rebalance (topology change) on the target cluster, XDCR will have an updated node list to keep track of the connectivity statuses of the target cluster nodes.

| https://jira.issues.couchbase.com/browse/MB-62150[MB-62150]
| Deadlock caused by `routingUpdater` when the pipeline is stopping
| The fix addresses the edge case whereby the `routingUpdater` raises a backfill-related event that gets stuck because of a race condition with closing the replication pipeline.

| https://jira.issues.couchbase.com/browse/MB-62307[MB-62307]
| Tombstones were not replicated if a binary filter is turned on.
| Issue resolved.

| https://jira.issues.couchbase.com/browse/MB-62384[MB-62384]
| In very rare situations, a document with a very large CAS could be inserted into a bucket. It is then possible for XDCR to replicate this document with malformed a CAS to other clusters.
|  XDCR now has a built-in guardrail to prevent documents with malformed CAS beyond a certain drift threshold from being replicated, and to notify the user if this situation occurs via the UI and logs.

| https://jira.issues.couchbase.com/browse/MB-62409[MB-62409]
| Connection pre-check uses the `hostname` field in `remoteRef` to get the target nodes information from the target cluster.
The feature had the following limitations:

If the input for remote reference creation is a DNS SRV,
  Connection pre-check directly uses the input hostname to connect to the target.

Connection pre-check does not  auto-check if the intent of the user is to use alternate address and alternate ports.
  If such a configuration is set up for the target cluster,
  Connection pre-check always deals with non-alternate target cluster node addresses to perform connection checks.

Connection pre-check for secure connection needs `18091` (or the secure mgmt port) as input.

| The limitations have been removed:

Remote ref creation will now automatically resolve records before proceeding to connect.

 Connection pre-check can now auto-check if the intent of the user is to use alternate address and alternate ports.

Connection pre-checknow uses secure or non-secure mgmt port (8091 or 18091) irrespective of the user input (even if no port is provided).

| https://jira.issues.couchbase.com/browse/MB-62464[MB-62464]
| Pre-check only captures actual errors.
| Pre-check enhanced such that latency can be displayed as part of the result. A warning is displayed if the latency is too high.

| https://jira.issues.couchbase.com/browse/MB-62569[MB-62569]
| When the target cluster performs a certificate rotation after a pre-check run, the subsequent pre-check call will fail due to its caching of the old certificates
| Issue resolved.

|===


==== Query Service

[#table-fixed-issues-726-query-service, cols="10,40,40"]
|===
|Issue | Description | Resolution


| https://jira.issues.couchbase.com/browse/MB-61564[MB-61564]
| Incorrect return code when attempting to create an index that already exists.
The system returns the error: `200: index already exists`.
| Issue resolved: the system will now return: `409: index already exists`.


| https://jira.issues.couchbase.com/browse/MB-62042[MB-62042]
| When the input to `STR_TO_TZ` has `'Z'` as the time zone, the output uses an hour-only format.
  (e.g., `STR_TO_TZ("2024-01-01T00:00:00Z", "America/Los_Angeles") -> "2023-12-31T16:00:00-08"`) +
  In version 6 and version 7.6+ the output is `"2023-12-31T16:00:00-08:00"`.
  This affects comparisons as the strings differ.
| The `STR_TO_TZ` function will return the output in the correct format: (e.g., `2023-12-31T16:00:00-08:00`)

| https://jira.issues.couchbase.com/browse/MB-63016[MB-63016]
| If an index is defined with a CASE statement as an index key, and the CASE statement contains a `not-equal` expression, and the same CASE statement is used in the projection clause of a query, then the covering index scan is not done properly.
| Issue resolved: we now use covering index scan appropriately.

| https://jira.issues.couchbase.com/browse/MB-63091[MB-63091]
| When a remote operation is performed â€“ (e.g., obtaining completed_requests entries from remote nodes  when selecting from `system:completed_requests`), the constructed `creds` parameter isn't properly URL-encoded.
| Issue resolved; parameter is encoded correctly.

| https://jira.issues.couchbase.com/browse/MB-63414[MB-63414]
| If memory_quota is set to a value and Query uses a non-covered array index, it can result in Request has exceeded memory quota error.
| Issue resolved.

|===


==== Eventing Service

[#table-fixed-issues-726-eventing-service, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-61877[MB-61877]
| Incorrect CRC-64 encoded value for string argument
| Fixed encoding when the input string contains a null terminator.

|===


==== Analytics Service
[#table-fixed-issues-726-analytics-service, cols="10,40,40"]
|===
|Issue | Description | Resolution

| https://jira.issues.couchbase.com/browse/MB-61493[MB-61493]
| When the Analytics Couchbase link is recovered after encountering a failure, the link status might falsely indicate that the service is still down.
| Issue resolved.

| https://jira.issues.couchbase.com/browse/MB-61764[MB-61764]
| In certain circumstances, a query can fail with an internal error during compilation when an `IN` clause is used in a subquery in combination with other conditions and aggregation operations.
The cause of the failure is due to encountering an intermediate query plan that the compiler does not account for.
| Issue resolved.
|===









