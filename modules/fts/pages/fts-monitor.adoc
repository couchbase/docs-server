= Monitor 

== Monitor runtime queries

Users of the full text search service might want to monitor the currently running active queries.
Monitoring helps get insights into slow queries, or for other debugging purposes.
FTS provides new REST endpoints to supervise the runtime queries.

/api/query

The users can use the /api/query endpoint to get the details of all the active queries in any FTS node in a cluster.
For example:

[source,shell]
---- 
curl -XGET -H "Content-Type: application/json" -u<UserName:Password> http://localhost:9200/api/query
----

.Sample Output
[source,json]
----
{ "status": "ok", "totalActiveQueryCount": 3, "filteredActiveQueries": { "queryCount": 3, "queryMap": { "10": { "QueryContext": { "query": { "query": "american" }, "size": 10, "
from
   ": 0, "timeout": 10000, "index": "DemoIndex1" }, "executionTime": "9.700851426s" }, "11": { "QueryContext": { "query": { "query": "russian" }, "size": 10, "
   from
      ": 0, "timeout": 10000, "index": "DemoIndex2" }, "executionTime": "2.216451567s" }, "9": { "QueryContext": { "query": { "query": "german" }, "size": 10, "
      from
         ": 0, "timeout": 10000, "index": "DemoIndex" }, "executionTime": "13.863849125s" } 
         
        }
    } 
}
----

The api/query endpoint takes an optional argument longerThan. With this argument, the users can filter the queries running beyond the given span of time.

For example, 

[source,shell]
----
curl -XGET -H "Content-Type: application/json" -uAdministrator:asdasd 'http://localhost:9200/api/query?longerThan=10s'
----

.Sample Output
[source,json]
----
{
    "status": "ok",
    "totalActiveQueryCount": 0,
    "filteredActiveQueries": {
        "indexName": "DemoIndex",
        "queryCount": 0,
        "queryMap": {}
    }
}
----

....
/api/query/index/{indexName}
....

The users can use the `pass:c[/api/query/index/{indexName}]` endpoint to get the details of all the active queries for any given FTS index in the system. With this endpoint, the users can also use the longerThan argument to filter the queries running beyond the given span of time.

The longerThan duration string is a signed sequence of decimal numbers, each with optional fraction and a unit suffix, such as "20s", "-1.5h" or "2h45m".
Valid time units are "ns", "us" (or "Âµs"), "ms", "s", "m", "h".
 
For example, 

[source,shell]
----
curl -XGET -H "Content-Type: application/json" -uAdministrator:asdasd 'http://localhost:9200/api/query/index/<indexName>?longerThan=1ms
----

.Sample Output
[source,json]
----
{ "status": "ok", "totalActiveQueryCount": 3, "filteredActiveQueries": { "indexName": "DemoIndex", "longerThan": "1s", "queryCount": 3, "queryMap": { "4": { "QueryContext": { "query": { "query": "ipa" }, "size": 10, "
from
   ": 0, "timeout": 10000, "index": "DemoIndex" }, "executionTime": "17.340715297s" }, "5": { "QueryContext": { "query": { "query": "german" }, "size": 10, "
   from
      ": 0, "timeout": 10000, "index": "DemoIndex" }, "executionTime": "9.561917571s" }, "6": { "QueryContext": { "query": { "query": "pale ale" }, "size": 10, "
      from
         ": 0, "timeout": 10000, "index": "DemoIndex" }, "executionTime": "1.239720897s" } 
        } 
    } 
}
----

== Monitor Search Index Statistics

Couchbase provides detailed statistics about the full text search indexes. The statistics include various metrics that explain the performance of the search query based on the selected full text search index.

Hold the mouse pointer on each chart to view the statistical details corresponding to the chart. Additionally, click the chart to expand the chart in full view.

Couchbase provides statistics for the full text search indexes on the Dashboard page and the Search page.

* Dashboard page
* Search page

=== Dashboard page

To view the statistics on the Dashboard page:

1. In the left pane, click *Dashboard*.
2. On the Dashboard page, click the *Search indexes* drop-down list and select the full text search index you want to view the statistics.

A graphical display of the statistics is as shown below:

[#fts_fts_monitoring_statistics1]
image::fts-monitoring statistics1.png[,820,align=left]

The statistics display the following graphical charts for full text search index:
* Search Mutations Remaining: The no. of mutations not yet indexed.

=== Search page

To view the statistics on the Search page:

1. In the left pane, click *Search*.
2. On the Full Text Indexes page, click the full text search *index name* in the Index Name column.
3. Click the *Search Index Stats* drop-down arrow to display the statistics.
4. (Optional) Click the *interval* drop-down list and select the time interval to view the statistics. By default, you can view the statistics for every minute.

A graphical display of the statistics is shown below:

[#fts_fts_monitoring_statistics2]
image::fts-monitoring statistics1.png[,820,align=left] 

The statistics display the following graphical charts:

* Search Query Latency: The average time to run the search query.
* Search Docs: The no. of documents scanned for the search query.
* Search Disk Size: The total disk file size occupied by the fts index
* Search Disk Files: The number of index files on the disk.
* Search Memory Segments: The no. of memory segments in the full text search index across all partitions.
* Search Disk Segments: The number of disk segments in the full text search index across all resident disk partions.
* Search Mutations Remaining: The no. of mutations not yet indexed.
* Search Partitions: The no. of partitions scanned for the search query.
* Search Partitions Expected: The no. of partitions expected to be scanned for the search query.
* Search Records to Persist: The no. of index records not yet persisted to the disk.
* Search Index Rate: The rate (In Bytes per second) of indexing plain text.
* Search Result Rate: The rate (In Bytes per second) of returning the search result.
* Search Compaction Rate: The rate (In Bytes per second) of compaction of the index segments.
* Search Query Rate: The no. of queries run per second.
* Search Query Error Rate: The no. of queries per second (Including timeouts) that resulted in an error.
* Search Slow Queries: The no. of queries that run slowly (greater than 5 seconds to run) ) per second.
* Search Query Timeout Rate: The no. of queries that timeout per second.
* Term Searchers Start Rate: The no. of term searchers started per second.




