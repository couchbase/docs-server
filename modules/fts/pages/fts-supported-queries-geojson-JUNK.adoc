= Geospatial GeoJSON JUNK WIP NOTES 

[abstract]

_Geospatial_ geojson queries both search with and return GeoJSON higher dimensional spatial structures.

== GeoJSON (type geojson) [.status]#Couchbase Server 7.1.2# 

PLACEHOLDER



CONVERT travel-sample.inventory.landmark to GeoJSON

[source, n1ql]
----
UPDATE `travel-sample`.inventory.landmark SET geo.type = "Point", geo.coordinates = [geo.lon, geo.lat] WHERE geo is not null;
UPDATE `travel-sample`.inventory.landmark UNSET geo.lat, geo.lon WHERE geo is not null;
----

CONVERT travel-sample.airport.landmark to GeoJSONand add a 10 mile object called area Raidus/Circle for noise

[source, n1ql]
----
UPDATE `travel-sample`.inventory.airport SET geo.type = "Point", geo.coordinates = [geo.lon, geo.lat] WHERE geo is not null;
UPDATE `travel-sample`.inventory.airport UNSET geo.lat, geo.lon WHERE geo is not null;
UPDATE `travel-sample`.inventory.airport SET area = { geo.coordinates, "type": "circle", "radius": "10mi"}  WHERE geo IS NOT null AND type="airport";
----

[source, json]
----
{
  "query": {
    "field": "geo",
    "geometry": {
      "shape": {
        "type": "envelope",
        "coordinates": [
          [
            1,
            50
          ],
          [
            2,
            52
          ]
        ]
      },
      "relation": "within"
    }
  },
  "size": 10,
  "from": 0
}
----


Los Angeles lat 34.05202604763014 lon -118.24370488541248

Query central point of airports within a 26 mile radius of downtown Los Angeles

[source, json]
----
{
  "fields": ["airportname"],
  "query": {
    "geometry": {
      "shape": {
        "coordinates": [-118.24370488541248, 34.0520260476301],
        "type": "circle",
        "radius": "26mi"
      },
      "relation": "within"
    },
    "field": "airport_loc"
  },
  "size": 10,
  "from": 0
}
----

QUery a 10 mile radius around each airport (for noise abatement) within a 26 mile radius of downtown Los Angeles

[source, json]
----
{
  "fields": ["*"],
  "query": {
    "geometry": {
      "shape": {
        "coordinates": [-118.24370488541248, 34.0520260476301],
        "type": "circle",
        "radius": "26mi"
      },
      "relation": "within"
    },
    "field": "area"
  },
  "size": 10,
  "from": 0
}
----

Query a  10 mile radius around each airport (for noise abatement) partially within (intersects) a 26 mile radius of downtown Los Angeles

[source, json]
----
{
  "fields": ["*"],
  "query": {
    "geometry": {
      "shape": {
        "coordinates": [-118.24370488541248, 34.0520260476301],
        "type": "circle",
        "radius": "26mi"
      },
      "relation": "intersects"
    },
    "field": "area"
  },
  "size": 10,
  "from": 0
}
----

Query central point of airports within the State of Maine

[source, json]
----
{
  "fields": ["*"],
  "query": {
    "geometry": {
      "shape": {
        "coordinates": [
          [
            [-70.7080078125,
              42.94033923363181
            ],
            [-66.62109375,
              44.68427737181225
            ],
            [-67.236328125,
              45.120052841530544
            ],
            [-67.412109375,
              45.521743896993634
            ],
            [-67.8076171875,
              45.767522962149876
            ],
            [-67.763671875,
              47.18971246448421
            ],
            [-68.6865234375,
              47.42808726171425
            ],
            [-69.3017578125,
              47.45780853075031
            ],
            [-70.9716796875,
              45.336701909968134
            ],
            [-70.9716796875,
              43.32517767999296
            ],
            [-70.7080078125,
              42.94033923363181
            ]
          ]
        ],
        "type": "Polygon"
      },
      "relation": "within"
    },
    "field": "airport_loc"
  },
  "size": 10,
  "from": 0
}
----
