= Classic Editor

[abstract]

A classic editor is an advanced tool where users can directly configure the index mapping. 

This section introduces index creations via a step by step walk through using the classic editor.  The reader should be already familiar with the basic concepts of full-text search 

This example xref:fts-creating-index-from-UI-classic-editor-geopoint.adoc#main[Creating a Geopoint Index] covers simple geospatial Search indexes of type geopoint.
However it should be noted that it only scratches the surface and does not cover all geospatial features.  

[#main]

= Creating a Geopoint Index

This section describes creating and Index on a bucket's collection across all field created on a default scope/collection.  In addition a specific field is overridden as a geospatial type of geopoint.

This is equivalent to the xref:fts-creating-index-from-UI-classic-editor-legacy.adoc#main[Creating a Legacy Index] example with two exceptions:
 
 * The index is defined using the newer collections paradigm (instead of the "legacy" default mapping).
 
 * The field *geo* is overridden from the dynamic indexing to support geospatial queries as a type *geopoint*.

To create the desired index through the Classic Editor:

* Access the *Couchbase Web Console* > *Search* page.
+
image::fts-search-page.png[,,align=left]

* Click the *Add Index* link in the upper right.
+
image::fts-add-initial.png[,600,align=left]

* To define any index on which Full Text Search a unique name for the index in the *Index Name* field, on the upper-left. Note that only alphanumeric characters, hyphens, and underscores are allowed for index names and the first character of the name must be alphabetic. 
+
Enter *test_geopoint* as the name of the Search index you are creating in the *Index Name* text-box.
+
image::fts-index-name-geopoint.png[,450,align=left]

* Select the bucket *travel-sample* from the *Bucket* pull-down menu.
+
Use the pull-down menu provided for the Bucket field, on the upper-right, and select a bucket that you are allowed to access to via the cluster's RBAC settings.
+
image::fts-index-name-and-bucket-geopoint.png[,450,align=left]

* Select the checkbox *[X] Use non-default scope/collections* 
+
This allows your index to stream mutations from one or more non-default collections under the selected bucket and scope.
+
image::fts-select-geopoint-scope-collections.png[,450,align=left]

* You will see a newly visible pull-down menu provided for the *Scope* field, under the *[X] Use non-default scope/collections* checkbox, and select a bucket that you are allowed to access to via the cluster's RBAC settings.
+
For this example leave the setting as *_default* which which is used to migrate bucket based data into the collections paradigm. 

* Under *Type Mapings*, unselect the checkbox *[ ]  default | dynamic*.
+
This is required as this type mapping (the default mapping) is only valid for the <bucket>._default._default which is typically used to upgrade a 6.X server from a bucket into a more powerful collections paradigm.  In this example we will do the equivlent but on a per collections basis.
+
image::fts-uncheck-default-mapping.png[,450,align=left]

* Click on the button *+ Add Type Mapping*

** A new section with a *Collection* pull-down, *Analyzer* pull-down and a *[ ] only index specified fields* checkbox will appear.
+
image::fts-index-menu1-nondefault-empty.png[,600,align=left]

** Select *_default* from the *Collection* pull-down, note the pull down will change to a text field prefilled with *_default._default*
+
image::fts-index-menu1-geopoint-filled.png[,600,align=left]

** Leave the *[{nbsp}{nbsp}] only index specified fields* checkbox blank or unset.
+
This will index all fields in the scope *_default* collection *_default* and not recommended for large production datasets.

** Click on the blue *ok* at the right of the section to save this mapping.

** Hover over your newly created/saved row 

** Click on the blue *+* button the right side of the row.
+ 
image::fts-index-menu1-geopoint-hover.png[,600,align=left]

** A context menu of "insert child mapping" (for sub-objects) and "insert child field" (for properties) will appear.
+
image::fts-index-menu2-geopoint-select.png[,600,align=left]

** Select *insert child field*

** another row menu will appear with the following controls: "field", "type", "text", "searchable as", "analyzer" "inherit", "index", "store", "include in _all field", "include term vectors", and "docvalues".
+
image::fts-index-menu2-geopoint-empty.png[,600,align=left]

** Set the text box *field* to *geo*, this will also update "searchable as" to *geo*.

** Change the pull-down *type* to *geopoint*.
+
By configuring the child field information form, specifically identify the object *geo* as type *geopoint* this will tell the Search indexer to recongnize top level sub-objects like:

[source, json]
----
  "geo": {
    "lat": 53.48253,
    "lon": -2.23527,
    "accuracy": "ROOFTOP"
  },
----

** Check *[X]* the boxes "store" and "include in _all field"

** Click on the blue *ok* at the right of the section to save this sub-form.
+ 
image::fts-index-menu2-nondefault-filled.png[,600,align=left]

* Save your index, left-click on the *Create Index* button near the bottom of the screen.
+
This is all you need to specify in order to create a more advanced index for test and development. No further configuration is required.
+
image::fts-index-create-button.png[,450,align=left]

* If you subsequently Edit your Index it should look like the following:
+
image::fts-edit-index-geopoint.png[,600,align=left]

NOTE: This index is an example of a potentially optimal index for use in a production environments since it creates only on index on a needed field as such it will be more performant that the first example.

== Test the Geopoint Index with a simple query

In the *Couchbase Web Console* > *Search* page.

* Click on the index you just created (named "test_geopoint") to expand the Index's controls.

* In the text area of the search box enter teh following text (this is a radius query):

[source, json]
----
{
  "from": 0,
  "size": 10,
  "query": {
    "location": {
      "lon": -2.235143,
      "lat": 53.482358
     },
      "distance": "100mi",
      "field": "geo"
    },
  "sort": [
    {
      "by": "geo_distance",
      "field": "geo",
      "unit": "mi",
      "location": {
      "lon": -2.235143,
      "lat": 53.482358
      }
    }
  ]
}
----
+
The above query-body specifies a longitude of `-2.235143` and a latitude of `53.482358`.
The target-field `geo` is specified, as is a `distance` of `100` miles: this is the radius within which target-locations must reside for their documents to be returned.  Don't worry about newlines when you paste the text.

* Click on the blue *Search* button. You will get documents from only collection landmark and due to the options you selected you will see highlighted words in your results.
+
image::fts-index-geopoint-search.png[,,align=left]

* Verify you have some results
+
image::fts-index-geopoint-search-results.png[,,align=left]

include::partial$fts-adv-index-settings-and-other-features-in-the-ui.adoc[]
