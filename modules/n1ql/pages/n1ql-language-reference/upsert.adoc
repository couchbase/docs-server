[#topic_11_9]
= UPSERT

Used to insert a new record or update an existing one.
If the document doesnâ€™t exist it will be created.
UPSERT is a combination of INSERT and UPDATE.

[.var]`upsert:`

----
UPSERT INTO keyspace-ref [insert-values | insert-select]  [ returning-clause]
----

[.var]`keyspace-ref:`

----
[(namespace-name :)]  keyspace [ [AS] alias]
----

[.var]`keyspace:`

----
identifier
----

[.var]`insert-values:`

----
 [ (  [ PRIMARY ] KEY , VALUE ) ]  values-clause [, values-clause]*
----

[.var]`values-clause:`

----
VALUES ( expression, expression )
----

[.var]`insert-select`

----
( [PRIMARY] KEY expression [ , VALUE expression ] ) select
----

[.var]`returning-clause:`

----
 RETURNING (result-expression [, result-expression]* | [RAW | ELEMENT ] expression)
----

[.var]`result-expression:`

----
[path . ]  * | expression [ [ AS ] alias ]
----

[.var]`path:`

----
identifier [ [ expression ] ] [ . path ]
----

[.var]`keyspace-ref`: Specifies the keyspace into which to upsert the document.

You can add an optional namespace-name to the keyspace-name in this way:

[.var]`namespace-name`:[.var]`keyspace-name`.

For example, `main:customer `indicates the [.param]`customer` keyspace in the [.param]`main` namespace.
If the namespace name is omitted, the default namespace in the current session is used.

[.var]`insert-values`: Specifies the values to be upserted.

[.var]`insert-select`: Specifies the values to be upserted as a SELECT statement.

[.var]`returning-clause`: Returns the data you upserted as specified in the [.var]`result_expression`.

== Example

The following statement upserts values for [.input]`odwalla-juice1` into the [.input]`product` document:

----
UPSERT INTO product (KEY, VALUE) VALUES ("odwalla-juice1", { "productId": "odwalla-juice1", 
      "unitPrice": 5.40, "type": "product", "color":"red"}) RETURNING * ;

"results": [
        {
            "color": "red",
            "productId": "odwalla-juice1",
            "type": "product",
            "unitPrice": 5.4
        }
    ]
----
