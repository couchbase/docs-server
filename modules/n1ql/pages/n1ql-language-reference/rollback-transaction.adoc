= ROLLBACK TRANSACTION
:page-topic-type: concept
:page-status: Couchbase Server 7.0
:imagesdir: ../../assets/images

// Cross-references
:transactions: xref:learn:data/transactions.adoc
:txid: xref:settings:query-settings.adoc#txid

// Related links
:begin-transaction: xref:n1ql-language-reference/begin-transaction.adoc
:set-transaction: xref:n1ql-language-reference/set-transaction.adoc
:savepoint: xref:n1ql-language-reference/savepoint.adoc
:commit-transaction: xref:n1ql-language-reference/commit-transaction.adoc
:rollback-transaction: xref:n1ql-language-reference/rollback-transaction.adoc

[abstract]
The `ROLLBACK TRANSACTION` statement enables you to rollback a transaction.

== Purpose

The `ROLLBACK TRANSACTION` statement enables you to rollback an ACID transaction.
You can rollback the entire transaction, or rollback to a previous savepoint.
Refer to {transactions}[Transactions] for further information.

This statement may only be used within a transaction.

If you are using the Query Workbench or the Query REST API, you must set the {txid}[txid] query parameter to specify the transaction ID.

If you are using the cbq shell, you don't need to specify the transaction ID.
Once you have started a transaction, all eligible statements within the cbq shell session are assumed to be part of the same transaction until you rollback or commit the transaction.

When you rollback the entire transaction, this statement removes all savepoints within the transaction.

== Syntax

[subs="normal"]
----
rollback-transaction ::= ROLLBACK [ WORK | TRAN | TRANSACTION ] [ TO SAVEPOINT __savepointname__ ]
----

image::n1ql-language-reference/rollback-transaction.png["'ROLLBACK' ( 'WORK' | 'TRAN' | 'TRANSACTION' )? ( 'TO' 'SAVEPOINT' savepointname )?"]

The `WORK`, `TRAN`, and `TRANSACTION` keywords are synonyms.
These keywords are optional; you may include one of these keywords, or omit them entirely.

=== Rollback to a Savepoint

The `TO SAVEPOINT` clause enables you to rollback to a specified savepoint.
This clause is optional.
If omitted, the entire transaction is rolled back.

savepointname::
An identifier specifying a name for the savepoint.

== Examples

[[ex-1]]
.Rollback a transaction -- cbq shell
====
.Request
[source,console]
----
cbq> \SET -txid "d81d9b4a-b758-4f98-b007-87ba262d3a51"; -- <.>
cbq> ROLLBACK TRANSACTION TO SAVEPOINT s1;
----

<.> The transaction ID generated when the transaction began.
====

[[ex-2]]
.Rollback a transaction -- REST API
====
.CURL request
[source,console]
----
$ curl http://localhost:8093/query/service \
-u Administrator:password \
-H 'Content-Type: application/json' \
-d '{
  "statement": "ROLLBACK TRANSACTION TO SAVEPOINT s1;",
  "pretty": true,
  "txid": "d81d9b4a-b758-4f98-b007-87ba262d3a51"
}'
----

This is equivalent to the request in <<ex-1>>.
====

== Related Links

* To begin a transaction, refer to {begin-transaction}[BEGIN TRANSACTION].
* To specify transaction settings, refer to {set-transaction}[SET TRANSACTION].
* To set a savepoint, refer to {savepoint}[SAVEPOINT].
* To commit a transaction, refer to {commit-transaction}[COMMIT TRANSACTION].
* Blog post: https://blog.couchbase.com/transactions-n1ql-couchbase-distributed-nosql/[N1QL Transactions^].