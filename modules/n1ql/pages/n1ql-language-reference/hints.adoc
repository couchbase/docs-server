= USE Clause
:page-status: Couchbase Server 4.0
:imagesdir: ../../assets/images

[abstract]
The `USE` clause enables you to specify that the query should use particular keys, or a particular index.

== Prerequisites

For you to select data from a document or keyspace, you must have the [.param]`query_select` privilege on the document or keyspace.
For more details about user roles, see
xref:learn:security/authorization-overview.adoc[Authorization].

== Syntax

[subs="normal"]
----
use-clause ::= <<use-keys-clause,use-keys-clause>> | <<use-index-clause,use-index-clause>>
----

[#use-keys-clause]
== USE KEYS Clause

=== Purpose

You can refer to a document's unique document key by using the `USE KEYS` clause.
Only documents having those document keys will be included as inputs to a query.

=== Syntax

image::n1ql-language-reference/use-keys-clause.png[]

[subs="normal"]
----
use-keys-clause ::= 'USE' <<use-keys-predicate,use-keys-predicate>>
----

[#use-keys-predicate]
--
[subs="normal"]
----
use-keys-predicate ::= 'PRIMARY'? KEYS expr
----
--

=== Arguments

PRIMARY:: [Optional] `USE KEYS` and `USE PRIMARY KEYS` are synonyms.

expr:: String of a document key or an array of comma-separated document keys.

=== Examples

.Select a single document by its document key
====
[source,N1QL]
----
SELECT *
FROM `travel-sample`
USE KEYS "airport_1254";
----

.Results
[source,JSON]
----
[
  {
    "travel-sample": {
      "airportname": "Calais Dunkerque",
      "city": "Calais",
      "country": "France",
      "faa": "CQF",
      "geo": {
        "alt": 12,
        "lat": 50.962097,
        "lon": 1.954764
      },
      "icao": "LFAC",
      "id": 1254,
      "type": "airport",
      "tz": "Europe/Paris"
    }
  }
]
----
====

.Select multiple documents by their document keys
====
[source,N1QL]
----
SELECT *
FROM `travel-sample`
USE KEYS ["airport_1254","airport_1255"];
----

.Results
[source,JSON]
----
[
  {
    "travel-sample": {
      "airportname": "Calais Dunkerque",
      "city": "Calais",
      "country": "France",
      "faa": "CQF",
      "geo": {
        "alt": 12,
        "lat": 50.962097,
        "lon": 1.954764
      },
      "icao": "LFAC",
      "id": 1254,
      "type": "airport",
      "tz": "Europe/Paris"
    }
  },
  {
    "travel-sample": {
      "airportname": "Peronne St Quentin",
      "city": "Peronne",
      "country": "France",
      "faa": null,
      "geo": {
        "alt": 295,
        "lat": 49.868547,
        "lon": 3.029578
      },
      "icao": "LFAG",
      "id": 1255,
      "type": "airport",
      "tz": "Europe/Paris"
    }
  }
]
----
====

== USE INDEX clause

[abstract]
The `USE INDEX` clause specifies the index to use in the query execution.

_(Introduced in Couchbase Server 3.0)_

=== Purpose

Use the `USE INDEX` clause to specify which index to use as part of the query execution.
The query engine attempts to use the specified index if the index is applicable for the query.

=== Syntax

----
USE INDEX ( index-ref [ , index-ref2 ]* ) [ USING ( VIEW | GSI ) ]
----

image::n1ql-language-reference/use-index-clause.png[]

[#use-index-clause]
--
[subs="normal"]
----
use-index-clause ::= 'USE' <<use-index-predicate,use-index-predicate>>
----
--

[#use-index-predicate]
--
[subs="normal"]
----
use-index-predicate ::= 'INDEX' '(' index-ref (',' index-ref)* ')'
----
--

[#index-ref]
--
[subs="normal"]
----
index-ref ::= index-name index-using?
----
--

=== Arguments

index-ref:: [Required] String or expression representing the index or indexes to be used for the query.

`USING`:: [Optional; default is `USING GSI`] Specifies which index form to use.
`VIEW`;; The legacy index form, which lives on the data node.

`GSI`;; The newer and faster Global Secondary Index form, which lives on an index node and can possibly be separate from a data node.

=== Examples

.Use an existing index with GSI in a query
====
Create an index of airlines and destination airports, and then use it in a query for flights originating in San Francisco.

[source,n1ql]
----
CREATE INDEX idx_destinations
ON `travel-sample` (airlineid, airline, destinationairport)
WHERE type="route";
----

[source,n1ql]
----
SELECT airlineid, airline, sourceairport, destinationairport
FROM `travel-sample` USE INDEX (idx_destinations USING GSI)
WHERE sourceairport = "SFO";
----
====

.Use an existing index with VIEW in a query
====
The usage of `VIEW` is identical as that of `GSI`.

[source,n1ql]
----
CREATE INDEX idx_destinations
ON `travel-sample` (airlineid, airline, destinationairport)
WHERE type="route";
----

[source,n1ql]
----
SELECT airlineid, airline, sourceairport, destinationairport
FROM `travel-sample` USE INDEX (idx_destinations USING VIEW)
WHERE sourceairport = "SFO";
----
====
