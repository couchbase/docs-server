= UPDATE
:page-topic-type: concept

UPDATE replaces a document that already exists with updated values.

_update:_

----
UPDATE keyspace-ref [use-keys-clause] [set-clause] [unset-clause] [where-clause] [limit-clause] [returning-clause]
----

_set-clause:_

----
SET path = expression [update-for] [ , path = expression [update-for] ]*
----

_update-for:_

----
FOR variable (IN | WITHIN) path  (, variable (IN | WITHIN) path)* [WHEN condition ] END
----

_unset-clause:_

----
UNSET path [update-for] (, path [ update-for ])*
----

_keyspace-ref:_ Specifies the keyspace for which to update the document.

You can add an optional namespace-name to the keyspace-name in this way:

namespace-name:keyspace-name.

__use-keys-clause:__Specifies the keys of the data items to be updated.
Optional.
Keys can be any expression.

__set-clause:__Specifies the value for an attribute to be changed.

_unset-clause:_ Removes the specified attribute from the document.

_update-for:_ The update for clause uses the FOR statement to iterate over a nested array and SET or UNSET the given attribute for every matching element in the array.

__where-clause:__Specifies the condition that needs to be met for data to be updated.
Optional.

__limit-clause:__Specifies the greatest number of objects that can be updated.
This clause must have a non-negative integer as its upper bound.
Optional.

__returning-clause:__Returns the data you updated as specified in the `result_expression`.

*RBAC Privileges*

User executing the UPDATE statement must have the _Query Update_ privilege on the target keyspace.
If the statement has any clauses that needs data read, such as SELECT clause, or RETURNING clause, then _Query Select_ privilege is also required on the keyspaces referred in the respective clauses.
For more details about user roles, see
xref:learn:security/authorization-overview.adoc[Authorization].

For example,

To execute the following statement, user must have the _Query Update_ privilege on `pass:c[`travel-sample`]`.

----
UPDATE `travel-sample` SET foo = 5
----

To execute the following statement, user must have the _Query Update_ privilege on the `pass:c[`travel-sample`]` and _Query Select_ privilege on `pass:c[`beer-sample`]`.

----
UPDATE `travel-sample`
SET foo = 9
WHERE city IN (SELECT RAW city FROM `beer-sample` WHERE type = "brewery")
----

To execute the following statement, user must have the _Query Update_ privilege on `pass:c[`travel-sample`]` and _Query Select_ privilege on `pass:c[`travel-sample`]`.

----
UPDATE `travel-sample`
SET city = "San Francisco"
WHERE lower(city) = "sanfrancisco"
RETURNING *
----

== Examples

NOTE: The Query Workbench may warn you that the query has no WHERE clause and will update all documents.
You can ignore this warning: the USE KEYS hint ensures that the query updates only one document.

[[example-1]]
.Set an attribute
====
The following statement sets the nickname of the landmark "Tradeston Pedestrian Bridge" to "Squiggly Bridge".

[source,n1ql]
----
UPDATE `travel-sample` USE KEYS "landmark_10090" SET nickname = "Squiggly Bridge" RETURNING `travel-sample`.nickname;
----

[source,json]
----
[
        {
    "nickname": "Squiggly Bridge"
        }
    ]
----
====

[[example-2]]
.Unset an attribute
====
This statement removes the `nickname` attribute from the `travel-sample` keyspace for the document with the key `landmark_10090`.

[source,n1ql]
----
UPDATE `travel-sample` USE KEYS "landmark_10090" UNSET nickname RETURNING `travel-sample`.name;
----

[source,json]
----
[
        {
    "name": "Tradeston Pedestrian Bridge"
        }
    ]
----
====

[[example-3]]
.Set attributes in an array
====
This statement sets the `codeshare` attribute for each element in the `schedule` array for document `route_10003` in the `travel-sample` keyspace.

[source,n1ql]
----
UPDATE `travel-sample` t USE KEYS "route_10003" SET s.codeshare = NULL FOR s IN schedule END RETURNING t;
----

[source,json]
----
[
        {
            "t": {
            "airline": "AF",
            "airlineid": "airline_137",
            "destinationairport": "ATL",
            "distance": 654.9546621929924,
            "equipment": "757 739",
            "id": 10003,
            "schedule": [
                    {
                    "codeshare": null,
                    "day": 0,
                    "flight": "AF986",
                    "utc": "22:26:00"
                    },
                ...
                    {
                    "codeshare": null,
                    "day": 6,
                    "flight": "AF540",
                    "utc": "11:07:00"
                    }
                ],
            "sourceairport": "TPA",
            "stops": 0,
            "type": "route"
        }
    }
]
----
====

[[example-4]]
.Set nested array elements
====
[source,n1ql]
----
UPDATE `travel-sample` AS h USE KEYS "hotel_10025"
SET i.ratings = OBJECT_ADD(i.ratings, "new", "new_value" ) FOR i IN reviews END
RETURNING h.reviews[*].ratings;
----

[source,json]
----
[
  {
    "ratings": [
      {
        "Cleanliness": 5,
        "Location": 4,
        "Overall": 4,
        "Rooms": 3,
        "Service": 5,
        "Value": 4,
        "new": "new_value"
      },
      {
        "Business service (e.g., internet access)": 4,
        "Check in / front desk": 4,
        "Cleanliness": 4,
        "Location": 4,
        "Overall": 4,
        "Rooms": 3,
        "Service": 3,
        "Value": 5,
        "new": "new_value"
            }
    ]
        }
    ]
----
====

[[example-5]]
.Access nested arrays
====
.Query
[source,n1ql]
----
UPDATE `travel-sample` AS h USE KEYS "hotel_10025"
UNSET i.new FOR i IN
  (ARRAY j.ratings FOR j IN reviews END)
END
RETURNING h.reviews[*].ratings;
----

.Result
[source,json]
----
[
  {
    "ratings": [
      {
        "Cleanliness": 5,
        "Location": 4,
        "Overall": 4,
        "Rooms": 3,
        "Service": 5,
        "Value": 4
      },
      {
        "Business service (e.g., internet access)": 4,
        "Check in / front desk": 4,
        "Cleanliness": 4,
        "Location": 4,
        "Overall": 4,
        "Rooms": 3,
        "Service": 3,
        "Value": 5
      }
    ]
  }
]
----
====

[[example-6]]
.Update a document with the results of a subquery
====
.Query
[source,n1ql]
----
UPDATE `travel-sample` AS a
SET hotels = 
  (SELECT  h.name, h.id 
  FROM  `travel-sample` AS h  
  WHERE h.type = "hotel" AND h.city = "Nice")
WHERE a.faa ="NCE"
RETURNING a;
----

.Result
[source,json]
----
[
  {
    "a": {
      "airportname": "Cote D\\'Azur",
      "city": "Nice",
      "country": "France",
      "faa": "NCE",
      "geo": {
        "alt": 12,
        "lat": 43.658411,
        "lon": 7.215872
      },
      "hotels": [
        {
          "id": 20419,
          "name": "Best Western Hotel Riviera Nice"
        },
        ...
        {
          "id": 20421,
          "name": "NH Nice"
        }
      ],
      "icao": "LFMN",
      "id": 1354,
      "type": "airport",
      "tz": "Europe/Paris"
    }
  }
]
----
====
