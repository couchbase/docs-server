[#topic1515]
= Installation and Configuration

[abstract]
A Couchbase-Elasticsearch data-replication system consists of three principal components: a _Couchbase Server-cluster_ of one or more nodes; an _Elasticsearch cluster_ of one or more nodes; and the _Elasticsearch Transport Plug-in_, installed in the Elasticsearch environment.
This section provides a step-by-step procedure, whereby the three components can be installed, configured, and run.

== Installation Prerequisites

The installation-procedure provided below involves the creation of a test environment, by means of _Oracle VirtualBox_; requiring _Ubuntu 14_ as operating system.
For details on setting up VirtualBox on your development-machine, and deploying a Ubuntu 14 image on it, see http://virtualbox.org[].
The instructions in this section assume that you have completed the necessary procedures, and have supervisor-privileges in the resulting virtual environment.
You will install and run Elasticsearch, the Elasticsearch Plug-in, and Couchbase Server in this environment: you should thus ensure that the virtual machine is provisioned with sufficient disk and memory resources; by means of the [.uicontrol]*Settings* panel, within the Oracle VM VirtualBox Manager.

Within the Ubuntu 14 environment, you will use both the terminal and the browser to perform installation and configuration.
Note that within the terminal window, you may need to use supervisor-privileges, by means of the `sudo` command: this command, however, is not reproduced in the examples in this document; you must prepend your console-input with it, as appropriate.

== Install and Configure Couchbase Server

Within the virtual environment you have created, using the browser, read and follow the installation and configuration instructions provided at xref:install:install-intro.adoc[Installing On-Premises].
During configuration, note that for current test-purposes:

* You need only activate the *Data* service.
Other services are not required.
+
{blank}

* You require a single bucket: which is the _beer-sample_ bucket.
This bucket will be used to provide data to Elasticsearch, during the test.
+
{blank}

Start Couchbase Server, using the instructions provided at xref:install:startup-shutdown.adoc[Couchbase Server Startup and Shutdown].

== Install Oracle Java

_Oracle_ java (rather than the standard Ubuntu-available version) is required for both Elasticsearch and the plug-in.
Ensure Oracle Java is added to your system, by bringing up a terminal window, and proceeding as follows:

. Add the required Oracle Java repository:
+
[source,bash]
----
$ apt-add-repository ppa:webupd8team/java
----

. Install Oracle Java, and establish it as the default Java for the virtual machine:
+
[source,bash]
----
$ apt-get update
$ apt-get install oracle-java8-installer
$ apt install oracle-java8-set-default
----
+
{blank}
+
During this process, when requested, accept the license-terms by selecting *Ok* or *Yes*.
+
{blank}
+
Once installation is complete, verify that Java has been successfully installed; by checking its version, with `java -version`; and its location, with `which java`.

== Install Elasticsearch 2.4.0

. Download the Elasticsearch 2.4.0 package for Ubuntu:
+
[source,bash]
----
$ wget https://download.elastic.co/elasticsearch/\
> elasticsearch/elasticsearch-2.4.0.deb
----

. Install the package:
+
[source,bash]
----
$ dpkg -i elasticsearch-2.4.0.deb
----

== Install the Elasticsearch Plug-in

. Navigate the the Elasticsearch install directory:
+
[source,bash]
----
$ cd /usr/share/elasticsearch
----

. Download and install the plug-in package:
+
[source,bash]
----
$ bin/plugin install https://github.com/couchbaselabs/\
> elasticsearch-transport-couchbase/releases/download/2.2.4.0-update1/\
> elasticsearch-transport-couchbase-2.2.4.0-update1.zip
----
+
{blank}
+
Respond to the installation-prompts as appropriate.
+
{blank}
+
When installation is successful, the message `Installed transport-couchbase into /usr/share/elasticsearch/plugins/transport/couchbase` is displayed.

== Configure and Start Elasticsearch

. In preparation for configuration-file editing, install your preferred console-based text-editor into the virtual machine environment.
+
{blank}
+
{blank}
+
For example, download _emacs_, using the following command; then, as installation proceeds, respond to system-prompts as appropriate.
+
[source,bash]
----
$ apt-get install emacs
----

. Using the editor, bring up the configuration file for Elasticsearch:
+
[source,bash]
----
emacs /etc/elasticsearch/elasticsearch.yml
----
+
{blank}
+
Add the following to the end of the file, specifying an appropriate administrator-username and password for accessing Elasticsearch:
+
{blank}
+
[source,bash]
----
couchbase.password: [password]
couchbase.username: [username]
couchbase.maxConcurrentRequests: 1024
----
+
{blank}
+
Then save the file, and exit back to the command-prompt.

. Install the Elasticsearch web-based user-interface:
+
[source,bash]
----
$ bin/plugin install mobz/elasticsearch-head
----

. Start Elasticsearch:
+
[source,bash]
----
$ /etc/init.d/elasticsearch start
----

. Configure an Elasticsearch index-template:
+
[source,bash]
----
$ curl -XPUT http://localhost:9200/_template/couchbase -d \
> @plugins/transport-couchbase/couchbase_template.json
----
+
{blank}
+
When successful, the configuration-routine provides the following response: `{"acknowledged":true}`.

. Instantiate an elasticsearch index to be applied by Elasticsearch to data from a particular Couchbase bucket (in this case, _beer-sample_, which you previously used in your set-up of Couchbase Server):
+
[source,bash]
----
$ curl -XPUT http://localhost:9200/beer-sample
----
+
{blank}
+
When index-creation is successful, a further `{"acknowledged":true}` response is provided.

You have now completed all basic installation and configuration requirements for Elasticsearch, the Elasticsearch Plug-in, and Couchbase Server.
(Note that more advanced configuration options are described later in this document.)

== Installing on Other Platforms

The procedures and code-examples that you will encounter in the next section, xref:elasticsearch-2.2/getting-started.adoc[Getting Started], all assume that you have installed and configured Elasticsearch, Couchbase Server, and the Elasticsearch Plug-in precisely as described above.

When you have completed Getting Started, and the other sections of this document, and have thus become more familiar with the plug-in and its capability, you will likely wish to perform installation on additional platforms, in preparation for or as part of a production-deployment.

Full details on the installation-procedures for Couchbase Server are described https://developer.couchbase.com/documentation/server/current/install/install-intro.html[here].
Those for Elasticsearch, https://www.elastic.co/guide/en/elasticsearch/reference/current/_installation.html[here].
Installing and configuring the plug-in on other platforms is virtually the same as described here, for Ubuntu 14.
Note that:

* The plug-in should be installed in the Elasticsearch install directory, with `bin/plugin install` \...etc.
+
{blank}

* Certain commands differ across platforms.
For example, on CentOS, to install the Elasticsearch package use `yum` (rather than `dpkg`, as used on Ubuntu).
+
{blank}

* For MacOS, to use wget: first, install `brew`; then, install `wget` with `brew install wget`.
+
{blank}

== Elasticsearch 2.1.1

Elasticsearch 2.1.1 requires a special, compatible version of the plug-in.
This can be obtained https://github.com/couchbaselabs/elasticsearch-transport-couchbase/releases/download/v2.2.1.2/elasticsearch-transport-couchbase-2.2.1.2.zip[here].

Use of this version of the plug-in requires that Java security-policy permissions be appropriately set.
See xref:elasticsearch-2.2/advanced-settings.adoc[Advanced Settings].

== Versioning and Compatibility

The following table shows the supported version-combinations for the three principal components:

.Version Compatibility
|===
| Plug-in | Couchbase | Elasticsearch

| master
| 2.5.x to 4.x
| 2.4.0

| 2.4.0.0-alpha2
| 2.5.x to 4.x
| 5.0.0.-alpha2

| 2.2.x.y
| 2.5.x to 4.x
| 2.x.y

| 2.1
| 2.5.x to 4.x
| 1.3.0 to 1.7.x

| 2.0
| 3.x, 2.5.x
| 1.3.0
|===
