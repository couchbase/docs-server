:page-pagination:

// suppress inspection "SqlResolve" for whole file
// suppress inspection "SqlNoDataSourceInspection" for whole file
= Retrieving documents

:description: In this section, you're going to look at two methods of retrieving documents from a collection.

[abstract]
{description}
You will use the administration console to build simple queries, and also write a short program to retrieve documents matching certain criteria.
Both of the methods will introduce N1QL (pronounced "nickel"), Couchbase's SQL-based query language.

include::partial$retrieve-documents-using-query-bench-section.adoc[leveloffset="+1"]

== Using the SDK

Of course, you can also retrieve documents using the JDK. In this section, you're going to use the same `N1QL` queries as part of a small Java application. Let's start with a basic record retrieval:

[source, java]
----
import com.couchbase.client.core.error.CouchbaseException;
import com.couchbase.client.java.Cluster;
import com.couchbase.client.java.json.JsonObject;
import com.couchbase.client.java.query.QueryResult;

public class ArtSchoolRetriever {

    public static void main(String[] args) {
        Cluster cluster = Cluster.connect("localhost",
                "Administrator", "password");


        retrieveCourses(cluster);

        cluster.disconnect();
    }

    private static void retrieveCourses(Cluster cluster) {

        try {
            final QueryResult result = cluster.query("select crc.* from `student-bucket`.`art-school-scope`.`course-record-collection` crc");

            for (JsonObject row : result.rowsAsObject()) {
                System.out.println("Found row: " + row);
            }

        } catch (CouchbaseException ex) {
            ex.printStackTrace();
        }
    }
}

----

If you build and run this program:

[source, bash]
----
mvn exec:java -Dexec.mainClass="ArtSchoolRetriever" -Dexec.cleanupDaemonThreads=false
----

Then you'll get a list of the classes in the output.

image::retrieve-courses-cli.png[]

You may have noticed a difference between the SQL statement we useed in the web console, and the statement used as part of the application:

[source, couchbasequery]
----
select crc.* from `student-bucket`.`art-school-scope`.`course-record-collection` crc
----

The name of the collection in the `N1QL` statement has to be fully qualified, including the name of the bucket as well as the containing scope.

You can, of course, set parameters as part of your query, as shown in the next example:

[source, java]
----
import com.couchbase.client.core.error.CouchbaseException;
import com.couchbase.client.java.Cluster;
import com.couchbase.client.java.json.JsonObject;
import com.couchbase.client.java.query.QueryOptions;
import com.couchbase.client.java.query.QueryResult;

public class ArtSchoolRetrieverParameters {

    public static void main(String[] args) {
        Cluster cluster = Cluster.connect("localhost",
                "Administrator", "password");


        retrieveCourses(cluster);

        cluster.disconnect();
    }

    private static void retrieveCourses(Cluster cluster) {

        try {
            final QueryResult result = cluster.query("select crc.* " +
                    "from `student-bucket`.`art-school-scope`.`course-record-collection` crc " +
                    "where crc.`credit-points` < $creditPoints",    // <1>
                    QueryOptions.queryOptions()
                             .parameters(JsonObject.create().put("creditPoints", 200)));    // <2>

            for (JsonObject row : result.rowsAsObject()) {
                System.out.println("Found row: " + row);
            }

        } catch (CouchbaseException ex) {
            ex.printStackTrace();
        }
    }
}

----

<1> The `N1QL` statement takes a parameters `$creditPoints` which will be substituted with a correctly typed value when the statement is called.

<2> The value to substitute is provided in the `QueryOptions` given as the second parameter in the call. The value of the map entry is the actual parameter value (in this case, 200 which we're using to test the `credit-points`).

You can use `maven` to run the program:

[source, bash]
----
mvn exec:java -Dexec.mainClass="ArtSchoolRetrieverParameters" -Dexec.cleanupDaemonThreads=false
----

== Next steps

Now you can add and search for records, the next section will consolidate what you've learned so far by demonstrating how to amend existing records by adding enrollment details. So when you're ready carry on to xref:java-tutorial/adding-enrollments.adoc[]
