include::partial$tutorial-globals.adoc[]

= Installing Couchbase: Community Edition
:description: A short tutorial that will guide the developer in downloading and installing Couchbase, then creating a database to store our student records.

:sdk-footnote: footnote:[Software Development Kit]

[abstract]
{description}

== Installation
Couchbase can be installed as either:

* A standalone application
* A Docker instance

If you're familiar with https://www.docker.com/[Docker], then it's recommended that you use Docker to install the server. Otherwise, go with the standalone installation.

[tabs]
====

Docker install::
+
--
First of all, make sure that you have Docker installed and running on your system. (You can download it from https://www.docker.com/get-started[here]).

Open a terminal window and run the following command:
[source, bash, subs="+attributes"]
----
docker run -t --name db -p 8091-8096:8091-8096 -p 11210-11211:11210-11211 couchbase/server:enterprise-{current-enterprise-version}

----

This will provision the server image, set up the storage location and run the server.
--

Standalone install::
+
--

Using any browser, navigate to https://www.couchbase.com/downloads to download the server installation pack.

Pick the `Couchbase server` option for your free trial.

image::couchbase-download-page.png[]

NOTE: You may need to fill out a brief web form before you can download the installation package.

Select `Couchbase Server`, and from there, download the community edition of the server.

image::download-couchbase-community-edition.png[]

NOTE: Make sure you download the latest version of the server software.

Once you've downloaded the software, install it on your machine. (The method for installation will depend on your operating system).

The method for running the application will, again, depend on your host operating system. In our example, we're using a Mac, so the installation will place then executable app in the standard `Applications` folder:

image::couchbase-server-in-applications-folder.png[width=500]

Double-click the icon to run the server. The server will launch, and since this is the first time it's run, it'll open up a web page inviting you to start a new cluster.

--
====

== Set up a new cluster

Each Couchbase server can run as its own cluster, or join another cluster to form a multi-node system. For the purposes of this basic tutorial, we're only going to concern ourselves with running as a single cluster.

TIP: You can always find the server's configuration page by pointing your browser at: `http://127.0.0.1:8091`

image::launch-couchbase-server-page.png[]

Press btn:[Setup New Cluster] to create your new cluster. The next page will allow you to fill in details for the cluster:

image::enter-cluster-details.png[]

Since we're going to be housing student records, let's call the cluster `student-cluster`. You'll also need an admin username and a strong yet memorable password. Since this is just a demonstration, leave the administrator username as `Admininstrator`. After you've filled in the details, press btn:[Next: Accept Terms].

On the next page, you'll find the terms and conditions for using Couchbase. If you're happy with them, then check the box and press btn:[Finish with Defaults].

You're now on the main dashboard page, a mostly blank screen displaying a message telling you that you currently have no buckets:

.Dashboard
image::student-cluster-dashboard.png[]

[sidebar]
****
*So what is a `Bucket` exactly?*

If you think in database terms, a Couchbase Bucket is analogous to a database: it's the data store where you're going to store and retrieve related information about the students.
****

You can click on the menu:Dashboard[Buckets] link to access the Buckets page, then click on btn:[Add Bucket]

image::add-bucket.png[]

And from this dialog, you can create the `student-bucket`

image::add-student-bucket.png[]

Once you have entered `student-bucket` for the bucket's name, press the btn:[Add Bucket] button to return to the main bucket list.

image::bucket-list.png[]

== Scopes and Collections

Now there's nothing stopping you from dumping every document, no matter what it's for, into the bucket. But in all but the simplest cases, it's better to provide some kind of separation. between documents of different types. Couchbase has a simple hierarchy model which allows for such separation:

[source, text]
----
Cluster
  Bucket
    Scope
      Collection
        Document-1
        Document-2
----

You're already familiar with `clusters`, `nodes` and `buckets`. Inside a bucket you can also have any number of `scopes`, and inside a `scope` you can have any number of `collections`. Scopes and collections appear to do the same thing, so we'll look at the key differences below:

[horizontal]
*scopes*:: acts as a parent to a `collection`. You can apply permissions at the scope level, which will restrict access to the collections inside it.
*collections*:: a collection can contain a set of related documents.


NOTE: Remember `scopes` and `collections` are optional: you can insert documents direcly into a `bucket` if you wish.

Rather than have our student records stored an anonymous bucket, we're going to add two collections: one will be used to store the student records, the other will be used to store the course details.

Now if we look again at the relational design of our student database:

include::partial$student-database-diagrams.adoc[tags="student-record-erd"]

we can see that our equivalent document-based system could do with a little decomposition:

include::partial$student-database-diagrams.adoc[tags="student-document-database-design"]

So, inside our `student-bucket` we've set up a scope called `art-school-scope`. Perhaps we have a number of schools and we want to restrict access to the school based on the role of the user; using scopes is the ideal way to do it.

Within the `scope` we set up two collections:

[horizontal]
`student-record-collection`:: contains the student records, and within each student record we carry a list of all
their enrolments. Again, this moves away from the standard relational decomposition since we're actually storing the
enrolments as part of the student's record, instead of implementing it as a link table between the students and the
courses.

`course-record-collection`:: The enrolment records will carry a link to the course record it applies to, so we can
retrieve other details such as the full name of the course and the number of credit points the student receives for
completing it.

NOTE: Of course, it's possible to just add the details of the course to the student's enrolment records, but this
would be very bad design. Changing the credit points on the course, for example, would involve running through every
student's enrolments and changing the credit details on each one. This is why the document model and relational model
are used in conjunction to get the best combination of robust design and performance.

Now that you understand the basics of scopes and collections, return to your admininstration screen so we can add
them to your bucket.

=== Adding the student scope

Return to the `Buckets` screen and click the btn:[Scopes & Collections] link.

image::click-scopes-and-collections.png[]

The first thing you may notice is that your bucket is created with a pre-existing scope called `_default`. You're
going to ignore this and create your own scope with a more meaningful name. Click on the btn:[Add Scope] link.

image::prepare-to-add-scope.png[]

On the next dialog, create your `art-school-scope`.

image::create-scope.png[]

Press btn:[Save] to save the new scope and return to the bucket screen. The new scope should be showing in the list.

== Adding the collections

Next, we're going to add two collections for the new scope. Click the btn:[Add Collection] link for the
`art-school-scope'.

image::add-collection-link.png[]

When the collection dialog is displayed, fill in the name of the first collection: `student-record-collection`; then
press  btn:[save]

image::add-student-record-collection.png[]

Now do the same again to create the `course-record-collection`.

== What's next â€¦?
So you have a database. Next thing to do is add stuff to it and retrieve it again. This is easy enough to do from the
administration page, but we're going to get a feel for the Couchbase SDK{sdk-footnote} by building a small command line application to add records to the database. So in the next section, you'll learn how to install the Couchbase Java SDK on your system.
