= Recover a Node

[abstract]
After a node has been failed over, it can be _recovered_: that is, added back
into the cluster from which it was failed over, by means of the _rebalance_
operation.

[#understanding-recovery]
== Understanding Recovery

After failover has occurred, before the failed over node has been rebalanced
out of the cluster, the node can be _recovered_, and thereby reintegrated
into the cluster. This is useful in circumstances where, following failover,
the unhealthy node has been fixed, and is therefore now
assumed fit for re-addition.

There are two options for recovery, which are _full_ and _delta_. These
are explained in
xref:understanding-couchbase:clusters-and-availability/recovery.adoc[Recovery].

[#examples-on-this-page-recover-node]
== Examples on This Page

The examples in the subsections below show how to perform both _full_ and
_delta_ recovery on the same failed over node in the same cluster; using the
xref:managing-clusters:managing-nodes/recover-nodes.adoc#recover-node-with-the-ui[UI],
the
xref:managing-clusters:managing-nodes/recover-nodes.adoc#recover-node-with-the-cli[CLI],
and the
xref:managing-clusters:managing-nodes/recover-nodes.adoc#recover-node-with-the-rest-api[REST
API] respectively. The examples assume:

The examples assume:

* A two-node cluster already exists, as
at the conclusion of
xref:managing-clusters:managing-nodes/join-cluster-and-rebalance.adoc[Join a
Cluster and Rebalance].

* The cluster has the Full Administrator username of
`Administrator`, and password of `password`.

[#recover-node-with-the-ui]
== Recover a Node with the UI

Proceed as follows:

. Access the Couchbase Web Console *Servers* screen, on
node `10.142.181.101`, by left-clicking on the *Servers* tab in the left-hand
navigation bar. The display is as follows:
+
[#servers-screen-with-node-added-after-rebalance]
image::managing-nodes/twoNodeClusterAfterRebalanceCompressedView.png[,800,align=middle]
+
. To see further details of each node, left-click on the row for
the node. The row expands vertically, as follows:
+
[#two-node-cluster-after-rebalance-expanded]
image::managing-nodes/twoNodeClusterAfterRebalance.png[,800,align=middle]

. To initiate failover, left-click on the *Failover* button, at the lower
right of the row for `101.142.181.102`:
+
[#failover-button]
image::managing-nodes/failoverButton.png[,140,align=middle]
+
The *Confirm Failover Dialog* now appears:
+
[#confirm-failover-dialog]
image::managing-nodes/confirmFailoverDialog.png[,400,align=middle]
+
Two radio buttons are provided, to allow selection of either *Graceful* or
*Hard* failover. *Graceful* is selected by default.

. Confirm _graceful_ failover by
left-clicking on the *Failover Node* button.
+
Graceful failover is now initiated. A progress dialog appears new the top
of the screen, summarizing overall progress; while each node-row also
features its own progress bar, indicating progress per node:
+
[#graceful-failover-fullscreen-progress]
image::managing-nodes/gracefulFailoverFullScreenProgress.png[,800,align=middle]
+
For server-level details of the graceful failover process, see the conceptual
overview provided in
xref:understanding-couchbase:clusters-and-availability/graceful-failover.adoc[Graceful
Failover].
+
When the process ends, the display is as follows:
+
[#graceful-failover-fullscreen-rebalance-needed]
image::managing-nodes/gracefulFailoverFullScreenRebalanceNeeded.png[,800,align=middle]
+
This indicates the graceful failover has successfully completed. A rebalance
is required to complete the reduction of the cluster to one node. Additionally,
the *Add Back: Full Recovery* and *Add Back: Delta Recovery* buttons are
displayed, towards the left-hand side of the row:

[#full-and-delta-recovery-buttons]
image::managing-nodes/fullAndDeltaRecoveryButtons.png[,440,align=middle]

. Select one of the two available forms of recovery, by left-clicking the
corresponding button. Note that _full_ and _delta_ recovery are described in
xref:understaning-couchbase/clusters-and-availability/recovery.adoc[Recovery].
If you select _full_, by left-clicking on the *Add Back: Full Recovery* button,
the row for `10.142.181.102` is displayed as follows:
+
[#node-row-after-full-recovery-select]
image::managing-nodes/nodeRowAfterFullRecoverySelect.png[,800,align=middle]
+
The row specifies `FULL RECOVERY pending rebalance`: therefore, left-click
the *Rebalance* button to apply full recovery.
+
Similarly, left-clicking on the *Add Back: Delta Recovery* displays
`DELTA RECOVERY pending rebalance`. Note that recovery can be aborted, by
left-clicking on the *CANCEL ADD BACK* button.

. Left-click on the *Rebalance* button. Whichever form of recovery you have
chosen, _full_ or _delta_, is performed.

[#recover-node-with-the-cli]
== Recover a Node with the CLI

[#recover-node-with-the-rest-api]
== Recover a Node with the REST API
