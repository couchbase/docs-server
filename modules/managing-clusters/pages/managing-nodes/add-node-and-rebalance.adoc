= Add a Node

[abstract]
A new Couchbase Server node can be added to an existing cluster.

[#understanding-node-addition]
== Understanding Node-Addition

_Full_ and _Cluster_ administrators can use the UI, CLI, or REST API
to add Couchbase Server nodes to existing clusters. On each node
to be added, Couchbase Server must have been _installed and started_.
The process of node-addition grants to the new node the
settings already established for the parent cluster. (See
xref:managing-clusters:managing-settings/manage-settings.adoc[Manage
Settings] for details.) The process allow services to be assigned to
the new node. If the new node was previously _initialized_ with
custom disk-paths, these are retained. All aspects of _provisioning_
that may previously have occurred on the new node are eliminated: this
includes buckets, services, and settings.

Following node-addition, _rebalance_ is required, to make the new node
and active member of the cluster.

[#examples-on-this-page-node-addition]
== Examples on This Page

The examples in the subsections below show how to add the same
node to the same one-node cluster; using the
xref:managing-clusters:managing-nodes/add-node.adoc#add-a-node-with-the-ui[UI],
the
xref:managing-clusters:managing-nodes/add-node.adoc#add-a-node-with-the-cli[CLI],
and the
xref:managing-clusters:managing-nodes/add-node.adoc#add-a-node-with-the-rest-api[REST
API] respectively. The examples assume:

* A one-node cluster already exists; and is named after its
IP address: `10.142.181.101`. It is running the Data, Query, and
Index services, and has the `travel-sample` bucket installed
(To access and install this, see
xref:settings:install-sample-buckets.adoc[Sample Buckets].)

* A new node has been started. This is named after its IP address:
`10.142.181.101`. It has not been initialized or provisioned.

* The cluster has the Full Administrator username of
`Administrator`, and password of `password`.

[#add-a-node-with-the-ui]
== Add a Node with the UI

Proceed as follows:

. Bring up Couchbase Web Console, and log into cluster `10.142.181.101`,
using the Full Administrator
username and password. Access the *Servers* tab, in the left-hand
navigation bar:
+
[#left_click_on_servers_tab]
image::managing-nodes/accessServersTab.png[,90,align=middle]
+
The *Servers* screen for the cluster is now displayed:
+
[#servers-screen-initial]
image::managing-nodes/serversScreenInitial.png[,800,align=middle]
+
This shows the name of the sole node in the cluster, `10.142.181.101`, plus
additional information, including the services hosted.

. Ensure that the node to be added has been started. This can be
accomplished by checking the IP address and port number for the
new node in the address bar of the browser. The following interface is
displayed:
+
[#new-node-welcome-screen]
image::managing-nodes/newNodeWelcomeScreen.png[,400,align=middle]
+
This indicates that Couchbase Server is installed and running on the new
node, but has not yet been provisioned. Do not use this interface: instead,
return to Couchbase Web Console for the cluster, `10.142.181.101`.

. In the *Servers* panel for the cluster, left-click on the *ADD SERVER* button,
at the upper right:
+
[#add-server-button]
image::managing-nodes/addServerButton.png[,140,align=middle]
+
The *Add Server Node* dialog is now displayed:
+
[#add-server-node-dialog]
image::managing-nodes/addServerNodeDialog.png[,400,align=middle]
+
Note the warning provided at the top of the dialog: if the node to be
added has already been provisioned, the results of such provisioning will
be eliminated and replaced on the node's addition to the current cluster.
(In fact, the node to be added in this example, has neither been
initialized nor provisioned.)

. Specify the IP address of the node to be added. There is no need to
specify a password, since the node has not yet been provisioned with one.
Uncheck all of the *Services* check-boxes except *Data*. The dialog now
appears as follows:
+
[#add-server-node-dialog-complete]
image::managing-nodes/addServerNodeDialogComplete.png[,400,align=middle]
+
Left-click on the *Add Server* button to save. The *Servers* screen is
redisplayed, with the following appearance:
+
[#servers-screen-with-node-added]
image::managing-nodes/serversScreenWithNodeAdded.png[,800,align=middle]
+
This indicates that the new node, `10.142.181.102` has been successfully
added. However, it is not yet taking traffic, and will be added following
a _rebalance_.

. To perform a rebalance, left-click on the *Rebalance* button, at the
upper right:
+
[#rebalance-button]
image::managing-nodes/rebalanceButton.png[,140,align=middle]
+
The new node is rebalanced into the cluster, meaning that whatever active and
replica vBuckets were previously distributed across the original cluster nodes
are redistributed across the superset of nodes created by the addition. The
*Servers* screen now appears as follows:
+
[#servers-screen-with-node-added-after-rebalance]
image::managing-nodes/serversScreenWithNodeAddedAfterRebalance.png[,800,align=middle]
+
This indicates that cluster `10.142.181.101` now contains two fully
functioning nodes, which are `10.142.181.101` and `10.142.181.102`.
