= XDCR Advanced Filtering

[abstract]
XDCR Advanced Filtering allows specified subsets of documents to be replicated from the source bucket.

[#configure-xdcr-filering]
== Understanding XDCR Advanced Filtering

_XDCR filtering_ allows a document to be included in or excluded from a filtered replication, based on the document's fields and values.

Case-sensitive matches can be made on:

* _id_ and _xattrs_ values, within the document's _metadata_.

* Field-names and values, within the document's _data_, nested to any degree.

Every document on which a match is successfully made is included in the filtered replication.
Other documents are _not_ included.

Match-requirements are specified by means of:

* _Regular Expressions_.
These can be used to specify case-sensitive character-matches, and thereby determine whether a field-name or value may entitle a document to be included in a replication.
See the reference information provided in xref:xdcr-reference:xdcr-regular-expressions.adoc[XDCR Regular Expressions].

* _Filtering Expressions_.
These allow comparisons and calculations to be made on the fields and values identified by means of _regular_ expressions: based on the results, a document either is or is not included in a replication.
See the reference information provided in
xref:xdcr-reference:xdcr-filtering-expressions.adoc[XDCR Filtering Expressions].

== Advanced Filtering Options

XDCR Advanced Filtering can be used to determine which subsets of the documents in a target bucket are replicated to which destinations.
This is shown by the following diagrams.

=== No Filter Applied

When no filter is applied, all documents in the specified source bucket are replicated to the specified target bucket.
For example:

image::xdcr/filter-replication-diagram-1.png[,500,align=left]

The replication _R_ specifies as its source _Source Bucket_, on the _Source Cluster_; and specifies as its target _Target Bucket_, on the _Target Cluster_.
The replication specifies no filter.

The _Source Bucket_ contains two documents, which are `airline_10` and `airport_8835`.
Since no filter is applied, both documents are suitable for replication, and are duly replicated to the _Target Bucket_.

=== Filter Applied

When a filter is applied, on those documents whose fields or values provide a successful match are included in the replication.
For example:

image::xdcr/filter-replication-diagram-2.png[,500,align=left]

The replication  _R_ specifies as its source _Source Bucket_, on the _Source Cluster_; and specifies as its target _Target Bucket_, on the _Target Cluster_.
The replication specifies a filter: this requires that a document have a `type` field, whose value is a string that contains the substring `air`, and that this be followed by the substring `l`.
For details on this kind of expression (referred to as _positive lookahead_), see the reference provided for xref:xdcr-reference:xdcr-filtering-expressions.adoc[Filtering Expressions].

The document `airline_10` has a `type` field whose value provides a successful match; therefore, the document is replicated.
The document `airport_8835` does have a `type` field, but its value does not contain a string that provides a successful match; therefore, the document is _not_ replicated.

=== Multiple Filters Applied

_Multiple Filters_ can be applied in either of two ways:

* By means of ORing, within a single replication.
This allows a document to be replicated if any one of the specified filters makes a successful match.
For information, see the reference overview for xref:xdcr-reference:xdcr-filtering-reference-intro.adoc[XDCR Advanced Filtering].

* By means of individual or multiple ORed filters, specified across multiple replications.
For example:

image::xdcr/filter-replication-diagram-3.png[,720,align=left]

The replication  _R1_ specifies as its source _Source Bucket_, on the _Source Cluster_; and specifies as its target _Target Bucket 1_, on the _Target Cluster 1_.
The replication specifies a filter: as in the previous example, this requires that a document have a `type` field, whose value is a string that contains the substring `air`, and that this be followed by the substring `l`.

The document `airline_10` has a `type` field whose value provides a successful match; therefore, the document is replicated to _Target Bucket 1_.
The document `airport_8835` does have a `type` field, but its value does not contain a string that provides a successful match; therefore, the document is _not_ replicated.

As _R1_, the replication _R2_ specifies as its source _Source Bucket_, on the _Source Cluster_.
However, it specifies as its target _Target Bucket 2_, on the _Target Cluster 2_.
The replication specifies a filter: this requires that a document have a `type` field, whose value is a string that contains the substring `air`, and that this be followed by the substring `p`.

The document `airport_8835` has a `type` field whose value provides a successful match; therefore, the document is replicated to _Target Bucket 2_.
The document `airline_10` does have a `type` field, but its value does not contain a string that provides a successful match; therefore, the document is _not_ replicated.

Thus, each of the two documents in the source is replicated to one, distinct target bucket, on its own target cluster.
Note that many variants of this example can be designed; including replicated the contents of a single source bucket to multiple target buckets on a single target cluster.
