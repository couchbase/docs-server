= XDCR with Scopes and Collections

[abstract]
When XDCR is established between a source bucket and a target bucket, data can be either _implicitly_ or _explicitly_ replicated between _collections_.

[#understanding-xdcr-collections-mapping]
== Understanding XDCR Collections-Mapping

XDCR allows only a single replication to be established between a specific source bucket and a specific target bucket.
However, within the replication, documents can be _mapped_ between different source and target _collections_.
(An overview of scopes and collections is provided in xref:learn:data/scopes-and-collections.adoc[Scopes and Collections].)

A _mapping_ is a link, established by XDCR, between a _namespace_ within the source bucket and a namespace within the target bucket.
A _namespace_ indicates the scope and collection, within the source or target bucket, within which exists data to be replicated.
Each namespace is represented as the name of the scope, followed by the name of the collection, separated by a period.
For example, if a bucket contains a scope named `HotelCollection`, and this scope contains collections named `USHotelCollection` and `UKHotelCollection`, then `HotelCollection.USHotelCollection` and `HotelCollection.UKHotelCollection` are both valid namespaces, specifying different collections within the same scope and bucket.

Between a namespace on the source cluster and a namespace on the target cluster, two kinds of collections-mapping are supported, which are _implicit_ and _explicit_:

* _Implicit_ mapping occurs whenever the source and target buckets contain an identical namespace: XDCR between these namespaces is initiated automatically, as soon as the source and target buckets alone have been specified by the administrator.

* _Explicit_ mapping occurs whenever the administrator specifies that replication should occur between namespaces that are not identical.

These forms of mapping are further described below.

[#implicit-mapping]
== Implicit Mapping

Implicit mapping occurs whenever the source and target buckets contain an identical namespace: XDCR between these namespaces is initiated automatically, as soon as the source and target buckets alone have been specified by the administrator.
This can be illustrated as follows:

image::clusters-and-availability/xdcr-implicit-mapping-diagram.png[,540,align=left]

The annotations are as follows:

. The administrator must explicitly specify a target and a source bucket, between which replication is to occur.
The buckets are typically on different clusters, in different data centers: however, they may also be on different clusters in the same data center, or even on the same cluster.

. Every bucket contains a default scope and collection, whose namespace is `_default._default`.
Implicit replication always occurs, therefore, between the default collection on the source bucket and the default collection on the target bucket.

. The source bucket contains a scope named `ScopeA`, within which a collection named `CollectionA` exists.
The target bucket also contains `CollectionA` within `ScopeA`.
Therefore, since source and target buckets contain the identical namespace, `ScopeA.CollectionA`, implicit replication occurs automatically between `ScopeA.CollectionA` on the source, and `ScopeACollectionA` on the target.

. Within `ScopeA` in the source bucket, a collection named `CollectionB` exists.
The target bucket also contains `CollectionB` within `ScopeA`.
Therefore, since source and target buckets contain the identical namespace, `ScopeA.CollectionB`, implicit replication occurs automatically between `ScopeA.CollectionB` on the source, and `ScopeACollectionB` on the target.

. The source bucket contains a scope named `ScopeB`, within which a collection named `CollectionA` exists.
The target bucket also contains `CollectionA`, within `ScopeB`.
Therefore, since source and target buckets contain the identical namespace, `ScopeB.CollectionA`, implicit replication occurs automatically between `ScopeB.CollectionA` on the source, and `ScopeB.CollectionA` on the target.

. Within `ScopeB` in the source bucket, a collection named `CollectionB` exists.
However, although the target bucket contains a scope named `ScopeB`, this does _not_ contain a collection named `CollectionB`: instead, it contains a collection named `CollectionC`.
Therefore, since `ScopeB.CollectionB` is a namespace unique to the source, no implicit mapping is established with the target, and no replication is automatically initiated.
+
Note, however, if an identical namespace is _subsequently_ established within the target bucket, a _backfill_ process is automatically applied, to replicate all appropriate data from the source to the target collection: this is described in detail below. 
