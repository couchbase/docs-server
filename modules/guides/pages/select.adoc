= Select Data with N1QL
:page-topic-type: guide
:imagesdir: ../../assets/images
:tabs:
:description: How to use a N1QL selection query to read data from a data source and return results.

[abstract]
{description}

== Introduction

The xref:n1ql:query.adoc[Query Service] enables you to create, read, update, and delete data by means of xref:n1ql:n1ql-language-reference/index.adoc[N1QL], the Couchbase Server query language.
To read data from a data source using N1QL, you must use a selection query; that is, a query using the `SELECT` statement.

== Before You Begin

If you want to try out the examples in this section, follow the instructions given in xref:getting-started:do-a-quick-install.adoc[Do a Quick Install] to install Couchbase Server, configure a cluster, and load a sample dataset.

== Query Tools

Read the following for further information about the tools available for editing and executing queries:

* xref:tools:cbq-shell.adoc[cbq: The Command Line Shell for N1QL]
+
....
cbq> 
....

* xref:tools:query-workbench.adoc[Query Workbench]
+
image::manage:manage-ui/queryTab.png[,100,align=left]

== Selecting

A selection query enables you to read information from a data source, perform operations on the data, and return the results.

To specify what the query should return, use the SELECT clause.

The following example uses the SELECT clause by itself to evaluate an expression.

[{tabs}]
====
N1QL::
+
--
.Query
[source,n1ql]
----
SELECT "Hello world";
----

.Result
[source,json]
----
[
  {
    "$1": "Hello world"
  }
]
----
--

.NET::
+
--
[source,csharp,indent=0]
----
            var result = await cluster.QueryAsync<dynamic>(
                "SELECT t.* FROM `travel-sample` t WHERE t.type=$1",
                options => options.Parameter("landmark")
            );
----
--

C::
+
--
[source,c,indent=0]
----
    std::string statement =
            "SELECT airportname, city, country FROM `" + bucket_name
                    + R"(` WHERE type="airport" AND city="New York")";

    lcb_CMDQUERY *cmd = nullptr;
    check(lcb_cmdquery_create(&cmd), "create QUERY command");
    check(lcb_cmdquery_statement(cmd, statement.c_str(), statement.size()),
            "assign statement for QUERY command");
    check(lcb_cmdquery_callback(cmd, query_callback), "assign callback for QUERY command");
    check(lcb_query(instance, &result, cmd), "schedule QUERY command");
    check(lcb_cmdquery_destroy(cmd), "destroy QUERY command");
    lcb_wait(instance, LCB_WAIT_DEFAULT);
----
--

Java::
+
--
[source,java,indent=0]
----
try {
  final QueryResult result = cluster.query("select * from `travel-sample`.inventory.airline limit 100",
      queryOptions().metrics(true));

  for (JsonObject row : result.rowsAsObject()) {
    System.out.println("Found row: " + row);
  }

  System.out.println("Reported execution time: " + result.metaData().metrics().get().executionTime());
} catch (CouchbaseException ex) {
  ex.printStackTrace();
}
----
--
====

For more information and examples, refer to xref:n1ql:n1ql-language-reference/selectclause.adoc[SELECT Clause].

== Specifying a Data Source

To specify the data source for a query, use the FROM clause.
For example, to get data from a collection, specify the path to that collection.

When you specify a FROM clause, you can use the SELECT clause to specify the fields that you want to return from that data source.
The set of fields returned by the query is known as the _projection_.

The following query gets the name and city of every airport.

====
.Query
[source,n1ql]
----
SELECT airportname, city
FROM `travel-sample`.inventory.airport;
----

.Result
[source,json]
----
[
  {
    "airportname": "Calais Dunkerque",
    "city": "Calais"
  },
  {
    "airportname": "Peronne St Quentin",
    "city": "Peronne"
  },
   ...
]
----
====

For more information and examples, refer to xref:n1ql:n1ql-language-reference/from.adoc[FROM Clause].

== Filtering

To filter the results of the query, use the WHERE clause to specify a comparison expression.
Only records that satisfy the comparison expression are returned.

For example, the following query finds the name and city of every airport in the Anchorage timezone whose altitude is greater than or equal to 2100.

====
.Query
[source,n1ql]
----
SELECT t.airportname, t.city
FROM   `travel-sample`.inventory.airport t
WHERE  tz = "America/Anchorage"
       AND geo.alt >= 2100;
----

.Result
[source,json]
----
[
   {
         "airportname": "Anaktuvuk Pass Airport",
         "city": "Anaktuvuk Pass",
   }
]
----
====

For more information and examples, refer to xref:n1ql:n1ql-language-reference/where.adoc[WHERE Clause].

== Limiting Results

To limit the number of documents returned by a query, use the `LIMIT` clause.

For example, the following query finds only 2 hotels with an empty room.

====
.Query
[source,n1ql]
----
SELECT name, address, city, country, url
FROM `travel-sample`.inventory.hotel
WHERE vacancy = true
LIMIT 2;
----

.Result
[source,json]
----
[
  {
    "address": "Capstone Road, ME7 3JE",
    "city": "Medway",
    "country": "United Kingdom",
    "name": "Medway Youth Hostel",
    "url": "http://www.yha.org.uk"
  },
  {
    "address": "6 rue aux Juifs",
    "city": "Giverny",
    "country": "France",
    "name": "The Robins",
    "url": "http://givernyguesthouse.com/robin.htm"
  }
]
----
====

For more information and examples, refer to xref:n1ql:n1ql-language-reference/limit.adoc[LIMIT Clause].

== Ordering Results

To sort the documents in the resultset by one or more fields, use the `ORDER BY` clause.

For example, the following query lists cities in descending order and then landmarks in ascending order.

====
.Query
[source,n1ql]
----
SELECT city, name
FROM `travel-sample`.inventory.landmark
ORDER BY city DESC, name ASC
LIMIT 5;
----

.Results:
[source,json]
----
[
  {
    "city": "Évreux",
    "name": "Cafe des Arts"
  },
  {
    "city": "Épinal",
    "name": "Marché Couvert (covered market)"
  },
  {
    "city": "Épinal",
    "name": "Musée de l'Image/Imagerie d'Épinal"
  },
  {
    "city": "Yosemite Valley",
    "name": "Lower Yosemite Fall"
  },
  {
    "city": "Yosemite Valley",
    "name": "Mirror Lake/Meadow"
  }
]
----
====

For more information and examples, refer to xref:n1ql:n1ql-language-reference/orderby.adoc[ORDER BY Clause].

== Next Steps

* xref:join.adoc[Querying Across Relationships]


== Related Links

In-depth explanation:

* xref:n1ql:n1ql-language-reference/selectintro.adoc[SELECT]

Reference:

* xref:n1ql:n1ql-language-reference/select-syntax.adoc[SELECT Syntax]

Tutorials:

* https://query-tutorial.couchbase.com/tutorial/#1[N1QL Query Language Tutorial^]


Querying with SDKs:

* xref:c-sdk:howtos:n1ql-queries-with-sdk.adoc[C]
| xref:dotnet-sdk:howtos:n1ql-queries-with-sdk.adoc[.NET]
| xref:go-sdk:howtos:n1ql-queries-with-sdk.adoc[Go]
| xref:java-sdk:howtos:n1ql-queries-with-sdk.adoc[Java]
| xref:nodejs-sdk:howtos:n1ql-queries-with-sdk.adoc[Node.js]
| xref:php-sdk:howtos:n1ql-queries-with-sdk.adoc[PHP]
| xref:python-sdk:howtos:n1ql-queries-with-sdk.adoc[Python]
| xref:ruby-sdk:howtos:n1ql-queries-with-sdk.adoc[Ruby]
| xref:scala-sdk:howtos:n1ql-queries-with-sdk.adoc[Scala]

