= User-defined Functions in JavaScript
:description: Extending the N1QL query language by adding your own functions written in JavaScript
:page-pagination: next
:page-edition: Enterprise Edition
:page-topic-type: guide
:page-toclevels: 2
:xrefstyle: short

[abstract]
{description}

== Introduction

N1QL includes a large number of xref:n1ql:n1ql-language-reference/index.adoc[operations and generic functions] that cover every aspect of data manipulation. 
In addition to the built-in functions, Couchbase also allows you to create your own extensions to the language using JavaScript.
Using JavaScript user-defined functions, you can:

* Create reuseable, domain-specific functions for use in your applications.
* Execute complex logic that may be difficult to do in N1QL.
* Migrate from RDBMS stored procedures.
* Use  N1QL statements embedded in your JavaScript to access and modify your data.

== JavaScript User-Defined Functions

Javascript functions in Couchbase support most of the language constructs available in https://en.wikipedia.org/wiki/ECMAScript[ECMAScript], though there are a number of restrictions related to the Couchbase environment. 
There are also additions that have been made to the language for working specifically in the Couchbase environment.

NOTE: There is an overview of the constructs available in the JavaScript engine in xref:eventing:eventing-language-constructs.adoc[]

[#libraries-and-scopes]
== Libraries and Scopes

JavaScript functions are stored inside a `library` Couchbase server. 
A library can contain one or more functions, and can also be assigned to a `scope` which allows for a libraries to partitioned for logical grouping. 

include::partial$javascript-udfs/diagrams.adoc[tags=javascript-scopes]

NOTE: You can find an introduction to scopes in our xref:tutorials:buckets-scopes-and-collections.adoc#scopes_and_collections[Couchbase Tutorials]

Furthermore, access restrictions can be applied to scopes, so that only certain groups of users will be able to access collections and libraries within that scope.

include::javascript-udfs:partial$diagrams.adoc[tags=udf-scopes-diagram]

<<scopes-for-udf>> demonstrates that the library `my-library` exists under the `inventory` scope. 
Only users with the correct access rights to the `inventory` scope will be able to run the functions contained within the `my-library`.

The user does not call the JavaScript functions (shown here as `getBusinessDays(startDate, endDate)`) directly; an *N1QL reference function* is defined to act as a proxy caller to the JavaScript UDF. 
This makes it possible to define multiple entry points to the same JavaScript function, allowing for the same function to be supplied with different parameter lists. 
(For more information on variable parameter lists, see xref:javascript-udfs:calling-javascript-from-n1ql.adoc#variadic-parameters[Calling N1QL from JavaScript]) 

NOTE: In Couchbase terminology, you would set the user's `context` to `travel-sample.inventory` in order for him/her to run the functions in `my-library`. 

== Next Steps

If you're looking to creating your own JavaScript UDFs then there are number of guides to get you started.
 
* xref:creating-javascript-library.adoc[]

* xref:calling-javascript-udf.adoc[]

* xref:remove-javascript-udf.adoc[]

If you wish to look into the constructs and available in the language itself, then you can have a look through the following pages:

* xref:javascript-udfs:javascript-udfs.adoc[]
* xref:javascript-udfs:javascript-and-json-objects.adoc[]
* xref:javascript-udfs:calling-javascript-from-n1ql.adoc[]
* xref:javascript-udfs:calling-n1ql-from-javascript.adoc[]
* xref:javascript-udfs:handling-errors-javascript-udf.adoc[]














