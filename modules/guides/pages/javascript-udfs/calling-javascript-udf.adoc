= Calling a Javascript UDF
:description: Calling a Javascript function from {sqlpp}.
:page-pagination: 
:page-edition: Enterprise Edition
:page-topic-type: guide
:page-toclevels: 2


[abstract]
{description}

== Introduction

To call a Javascript function, you first have to add the function to the server's library

This section will demonstrate how to:
 
 * Add a {sqlpp} reference function for your Javascript function.
 * Create an {sqlpp} statement to call the {sqlpp} reference.
 
== Add the {sqlpp} reference function
 
Access the `User-Defined Functions` screen from the Administrator's console. 
(There is a description of how to do this is in the xref:javascript-udfs/creating-javascript-udf.adoc#introduction-create-javascript-library[Introduction]).

Click on the **{plus} add function** link.

image::javascript-udfs/my-library-list-add-function-button.png[alt="library list"]

You will be shown a dialog which you will use to enter details of the calling function. 

image::javascript-udfs/add-function-dialog.png[ ,400]

The first thing to do is instruct the dialog that you wish to create a `Javascript` function, rather than an `inline` function, so change the `Function Type` to `Javascript`.

image::javascript-udfs/add-javascript-function-dialog.png[ ,400, alt="add Javascript function dialog"]

NOTE: In this context, you are not actually creating a new function, simply adding an existing Javascript function to a given namespace.

You can now fill in the details as follows:
{empty} +

*Function Name*:: This is the name of the function that will be used in {sqlpp} statements.
In this example, we're going to label this function as `MyAdd`.

*Namespace*:: The function can be allocated a namespace that defines how it can be accessed. 
The `global` namespace is set at the level of the bucket, so any {sqlpp} statement running in the bucket's context will be able to access. 
We call set the namespace to a particular scope, ensuring that the function is only available within that scope.
Since the `add` function is very generic, then set `Namespace` to `global`. 

*Parameters*:: Any parameters that are used in the Javascript function must also be declared here.
The javascript function `add(a,b)` takes two parameters. So create the two parameters here.
+
NOTE: The parameters act as placeholders, so they don't need to share the same names as the underlying Javascript function.

*Function Type*:: This should already be set to `javascript`. 

*Javascript Library*:: This of name of the Javascript library where your function is stored. This should be set to `my-library`.

*Library Function Name*:: The name of the Javascript function in `my-library` that this definition will call. In this case, the function is simply called `add`.

image::javascript-udfs/add-javascript-function-filled-dialog.png[ ,400, alt="Function dialog fillied in"]

Now press the btn:[Save Function] button to save the definition.

NOTE: In the background, The dialog will use the gathered information to generate and execute an {sqlpp} xref:n1ql:n1ql-language-reference/createfunction.adoc[`CREATE FUNCTION`] call to generate the function definition.

The new definition should now appear in the library list.

image::javascript-udfs/library-list-with-sqlpp-caller.png[alt="library list with completed user-defined function"]

[NOTE]
====
One advantage in defining a reference function is that the same Javascript function can be re-used in {sqlpp} functions with different names.

include::partial$javascript-udfs/diagrams-plantuml.adoc[tags="javascript-udf-multiple-references"]

====

== Calling the Javascript function

The Javascript function behaves like a standard {sqlpp} function, so can be called in any {sqlpp} statement.

Let's return to the Query Workbench and build a simple {sqlpp} statement that adds two numbers together.

Click on menu:Workbench[] to access the Query Editor.

image::javascript-udfs/workbench-menu-item.png[alt="select Workbench menu item"]

The window will switch to the Query Editor.

Enter the following statement in the editor

[source, n1ql]
----
include::example$javascript-udfs/add-statement.n1ql[]
----

image::javascript-udfs/add-statement-in-editor.png[ ,450, alt="adding statement to query editor"]

You should also set the `context` to `unset` so that we can run the query under the global context.

image::javascript-udfs/setting-context.png[alt="setting the context to unset"]

Now press the btn:[Execute] button to run the statement.

The statement will, making a call to the Javascript function, which will return the following result:

[source, json]
----
include::example$javascript-udfs/add-response.json5[]
----

As you can see, the statement returns the result wrapped in a `json` object.

In the next section, we'll take a closer look at how data is handled in Javascript user-defined functions.


== Further Reading

include::partial$javascript-udfs/further-reading.adoc[tags="query-workbench;n1ql-reference"]

