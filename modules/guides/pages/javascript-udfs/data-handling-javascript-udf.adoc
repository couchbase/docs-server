= Data handling in Javascript UDFs
:description: Moving data between Javascript UDFs and {sqlpp}.
:page-pagination: prev
:page-edition: Enterprise Edition
:page-topic-type: guide
:page-toclevels: 2

[abstract]
{description}

== Introduction

Javascript is procedural object-based language, and {sqlpp} is declarative in nature. 
Moreover, Couchbase naturally works with https://www.w3schools.com/whatis/whatis_json.asp[json] in its data handling, so the data returned from {sqlpp} statements are json objects. 

== Packing and unpacking JSON data in Javascript

If we look back at the `add` function:

[source, javascript]
----
include::example$javascript-udfs/add.js[]
----

When it's called as part of a {sqlpp} statement:

[source, n1ql]
----
include::example$javascript-udfs/add-statement.n1ql[]
----

It returns its result packaged as a `json` object instead of a Javascript number:

[source, json]
----
include::example$javascript-udfs/add-response.json5[]
----

When using the function as part of a statement call, the unpacking processing is handled by the query engine, so that a query such as:

[source, N1SQL]
----
select "true" as response where MyAdd(2000, 1) > 2000
----

will unpack the result of `MyAdd(2,2)` and apply the result to the `WHERE` clause:

[source, json]
----
[
  {
    "response": "true"
  }
]
----

== Transforming data in a Javascript UDF

If you're using a user-defined function, then the chances are that you want to perform some kind of transformation on the data received back from an embedded {sqlpp} call, then returning the transformed from your Javascript function:

include::partial$javascript-udfs/diagrams-plantuml.adoc[tags="javascript-udf-data-transformation"]

Fortunately, Javascript is very adept at working with JSON data, which is the native data formaat used by Couchbase.

The following function will retrieve all the hotels from the database and return just those that are in the country supplied as a parameter.

TIP: It would far easier to do this directly as a {sqlpp}


