= Using JavaScript Library Hierarchies
:description: Using namespaces to allocate libraries to bucket scopes.
:page-pagination: prev
:page-edition: Enterprise Edition
:page-topic-type: guide
:page-toclevels: 2

[abstract]
{description}

== Introduction

As well as being defined for global use, libraries can be restricted to the scopes within a bucket. 
This means that  access to the function can be restricted to users who have the privileges for the bucket.

== Creating a JavaScript Function Within a Scope

You can use the Query Workbench UI or the REST API to create a scoped library.

[tabs] 
====
Query Workbench::
+
--
. Select btn:[Query] to access the Query Workbench, then select btn:[UDF] Query Workbench menu.
+
image::javascript-udfs/navigate-to-udf-query.png[alt="route to the user-defined functions screen"]

. Click on the *{plus} add function library* link in the `Javascript Function Libraries` table to show the `Add Library` screen.

. Select your `Namespace` from the drop-down lists.
+
image::javascript-udfs/add-scoped-library.png[,500]
+
NOTE: The `Namespace` is made up of the bucket name and the scope.

. Enter a name for the library in the `Library Name` field.
. Add your own function to the library. 
. Save the library by pressing the btn:[Save] button.
--

REST API::
+
--
. Start a shell session.
. Run a `curl` command to create a JavaScript library within a desired scope.

[source, console]
----
include::example$javascript-udfs/create-scoped-javascript-function-with-rest.sh[]
----
<.> Parameters denote that the function should reside in the `travel-sample` bucket and under the `inventory` scope within that bucket.
--
====

== Create a {sqlpp} Referencing Function Within a Scope

The referencing function will need to be supplied with the scope where the Javascript function resides.

[tabs]
====
Query Workbench::
+
--
. Access the `UDF` screen from the administration console.
+
image::javascript-udfs/navigate-to-udf-query.png[]

. Click on the `{plus}{nbsp}add function` link from the `UDFs` screen.
+
image::javascript-udfs/my-library-list-add-function-button.png[alt="library list"]
+
which will display the `Add Function` screen.
+
image::javascript-udfs/add-function-dialog.png[ ,400]

. Use the `Namespace` drop-down lists to select the bucket and scope where your Javascript function resides.

. Fill in the `Function Name` of your referencing function.

. Leave the `Parameters` as they are.
+
NOTE: The `...` in the parameters box denotes a variable length list of parameters.
This is why you don't have to fill in this field.

. Select `Javascript` for the function type.
A field will appear in the dialog with a list of available libraries in the namespace you selected.
+
image::javascript-udfs/add-function-dialog-switch-to-javascript.png[]
+
From this list select the library containing your function. 

. Enter the name of the JavaScript function in the `Library Function Name` field.
--

REST API::
+
--
Run a `curl` command from the shell to add a reference function that calls your Javascript function.

[source, console]
----
include::example$javascript-udfs/create-scoped-sqlpp-reference-function-with-rest.sh[]
----
<.> The full scope of the referencing function is supplied in the statement.
<.> The fully-qualified path of the Javascript library is supplied as part of the statement.
--
====

== Calling a Function Defined within a Namespace

When calling a function defined within a scope, you will use the fully qualified address of the function to access it. This can be done from the Query Workbench UI, the REST API or the CBQ tool.

[tabs]
====
Query Workbench::
+
--
. Access the Query Workbench UI from the Administration Console.
+
image::javascript-udfs/select-query-tool-ui.png[,500, alt="accessing the query tool"]

. Set the context to match the namespace of the function you are calling.
+
image::javascript-udfs/switch-context-to-travel-sample.png[]

. Enter the {sqlpp} statement in the query editor to run your function:
+
[source, n1ql]
----
include::example$javascript-udfs/execute-javascript-function.n1sql[]
----
--

REST API::
+
--
. Open up a shell session.
. Execute a `curl` command to run the function:
+
[source, console]
----
include::example$javascript-udfs/execute-scoped-function.sh[]
----
--

CBQ::
+
--
include::partial$javascript-udfs/start-cbq-shell-instructions.adoc[]
--
====
