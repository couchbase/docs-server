= Creating a JavaScript UDF
:description: Using the Couchbase Query Workbench to create a user-defined function written in JavaScript
:page-pagination: 
:page-edition: Enterprise Edition
:page-topic-type: guide
:page-toclevels: 2

[abstract]
{description}

== Introduction

A JavaScript User-Defined function can be created in the Couchbase Query Workbench, or using the Couchbase REST API.

Read the following for more information on the Query Workbench and the REST API:

xref:tools:query-workbench.adoc[]

xref:rest-api:rest-intro.adoc[]

In order to create a JavaScript user-defined function, you will

. Create a JavaScript library
. Add a function to the library
. Create an {sqlpp} handler function.

== Creating a JavaScript Library

Create a JavaScript library in which you will store your function, using:

[tabs]
====
Query Workbench:: 
+
--
. Select btn:[Query] to access the Query Workbench, then select btn:[UDF] Query Workbench menu.
+
image::javascript-udfs/navigate-to-udf-query.png[alt="route to the user-defined functions screen"]

. Click on the *{plus} add function library* link in the `Javascript Function Libraries` table to show the `Add Library` screen.

. Ensure the `Namespace` is set to `global`.
. Enter a name for the library in the `Library Name` field.
+
image::javascript-udfs/add-library-screen.png[,600, alt="add screen"]

. Add your own function to the library by typing it in below the preset example.
+
image::javascript-udfs/added-get-business-days-function.png[,600, alt="added new function"]

. Save the library by pressing the btn:[Save] button.
--

REST API::
+
--
You will use the command shell `curl`command to execute REST commands.

Execute the following command to create a Javascript function.

[source, bash]
----
include::example$javascript-udfs/create-javascript-function-with-rest.sh[]
----
<.> In this example, the library is called `my-library`.
<.> Supply the username and password for your server.
<.> Supply the function for adding into the library.
--
====


== Create an {sqlpp} Reference Function

To call a JavaScript function, you first have to add a {sqlpp} function to reference it.
This can be done through the UI or the REST API.

[tabs]
====
Query Workbench:: 
+
--
. Click on the `{plus}{nbsp}add function` link from the `UDFs` screen.
+
image::javascript-udfs/my-library-list-add-function-button.png[alt="library list"]
+
which will display the `Add Function` screen.
+
image::javascript-udfs/add-function-dialog.png[ ,400]

. Fill in the details as follows:
+
*Function Name*:: This is the name of the function that will be used in {sqlpp} statements.

*Namespace*:: The function can be allocated a namespace that defines who can access it.
Users must have access rights to the namespace to run the function. 
The `global` namespace is set at the level of the bucket, so any {sqlpp} statement run by a user with access to the bucket will be able to run the function. 
We can set the namespace to a particular scope, ensuring that the function is only available within that scope.

*Parameters*:: It is possible to explicitly define the list of parameters the function is expecting. 
However, the default setting  `...` indicates a variable length parameter list, which will be matched to the JavaScript parameter list when  the function is executed.


*Function Type*:: Set this to `Javascript`. 

*Javascript Library*:: This of name of the JavaScript library where your function is stored.

*Library Function Name*:: The name of the JavaScript function in `my-library` that this definition will call.

. Press the btn:[Save Function] button to save the definition.

NOTE: In the background, The dialog will use the gathered information to generate and execute an {sqlpp} xref:n1ql:n1ql-language-reference/createfunction.adoc[`CREATE FUNCTION`] call to generate the function definition.

--

REST API::
+
--
Add the reference function to your bucket using a REST call executed from the command shell:

[source, console]
----
include::example$javascript-udfs/create-reference-function.sh[]
----
[sidebar]
=====
include::partial$javascript-udfs/create-function-breakdown.adoc[]
=====
--

CBQ Shell::
+
--
include::partial$javascript-udfs/start-cbq-shell-instructions.adoc[]
. Enter the command {sqlpp} statement to create the reference function:
+
[source, console]
----
include::example$javascript-udfs/create-reference-function.n1sql[]
----
[sidebar]
=====
include::partial$javascript-udfs/create-function-breakdown.adoc[]
=====
--
====
