= Creating a JavaScript Library
:description: Creating a JavaScript library.
:page-pagination: 
:page-edition: Enterprise Edition
:page-topic-type: guide
:page-toclevels: 2

== Introduction

In this guide you will learn how to create a library for storing JavaScript functions, and how to add a new function to the library.

include::partial$before-you-begin.adoc[]

include::partial$query-tools.adoc[]

== Creating the Library and Adding Your First Function

You can use the Query Workbench UI or the REST API to create a scoped library.
The process for creating the library is as follows:

include::partial$javascript-udfs/diagrams.adoc[tags=javascript-udf-library-creation-sequence]

*Create library*:: This creates the logical storage area where a set of functions are kept within a bucket.

*Add functions*:: The developer adds a JavaScript function to the library before saving it.

*Create Reference Function*:: The reference function registers the JavaScript function with the cluster so that it can be called as part of N1QL statements (such as `SELECT` and `EXECUTE FUNCTION`). 
Executing JavaScript UDFs is covered in xref:calling-javascript-udf.adoc[]

As shown in xref:create-library-udf-sequence[xrefstyle=short], the library is created and the first function is added in the same step.
This is the same for both the Query Workbench and the REST API.

NOTE: You cannot create a JavaScript library using N1QL.

[tabs] 
====
Query Workbench::
+
--
. Select btn:[Query] to access the Query Workbench, then select btn:[UDF] Query Workbench menu.
+
image::javascript-udfs/navigate-to-udf-query.png[alt="route to the user-defined functions screen"]

. Click on the *{plus} add function library* link in the `Javascript Function Libraries` table to show the `Add Library` screen.

. Select your `Namespace` from the drop-down lists.
In this example, the namespace has been set to the `inventory` scope inside the `travel-sample` bucket. 
You also have the option of leaving the Namespace unset, which will place the library in the global bucket-level scope.
+
image::javascript-udfs/add-scoped-library.png[,500]
+
.A Note on Namespaces
[sidebar]
****
The `Namespace` defines the `scope` of the library within the containing bucket.
(You can read about scopes in the xref:javascript-udfs.adoc#libraries-and-scopes[Introduction]).
Setting the namespace means that functions in the library can only be called users who have their context set to the same scope.
****

. Enter a name for the library in the `Library Name` field.

. Add your own function to the library, for example:
+
[source, javascript]
----
include::example$javascript-udfs/get-business-days.js[]
----
. Save the library by pressing the btn:[Save] button.
--
+
TIP: You can, of course, create an empty library and add functions to it later.

REST API::
+
--
. Start a shell session.
. Run a `curl` command to create a JavaScript library within a desired scope.

[source, console]
----
include::example$javascript-udfs/create-scoped-javascript-function-with-rest.sh[]
----
The parameters in the URL denote that the function should reside in the `travel-sample` bucket and under the `inventory` scope within that bucket.
--
====

== Creating the Reference Function

Before running a JavaScript function, you will need to create a N1QL statement that will register to the function with the cluster. 

// TODO: Check with Marco â€“ not sure this is the case.
The reference function must be defined to run within the same scope as the UDF it's calling.

include::partial$javascript-udfs/diagrams.adoc[tags=multiple-references-to-udf]

As xref:multiple-references-to-udf[xrefstyle=short] shows, you can define multiple reference functions to point at the same JavaScript function.
[tabs]
====
Query Workbench::
+
--
. Access the `UDF` screen from the administration console.
+
image::javascript-udfs/navigate-to-udf-query.png[]

. Click on the `{plus}{nbsp}add function` link from the `UDFs` screen.
+
image::javascript-udfs/my-library-list-add-function-button.png[alt="library list"]
+
which will display the `Add Function` screen.
+
image::javascript-udfs/add-function-dialog.png[ ,400]

. Use the `Namespace` drop-down lists to select the bucket and scope where your Javascript function resides.

. Fill in the `Function Name` of your referencing function.

. Leave the `Parameters` as they are.
+
NOTE: The `...` in the parameters box denotes a variable length list of parameters.
This is why you don't have to fill in this field.

. Select `Javascript` for the function type.
A field will appear in the dialog with a list of available libraries in the namespace you selected.
+
image::javascript-udfs/add-function-dialog-switch-to-javascript.png[]
+
From this list select the library containing your function. 

. Enter the name of the JavaScript function in the `Library Function Name` field.
--

REST API::
+
--
Run a `curl` command from the shell to add a reference function that calls your Javascript function.

[source, console]
----
include::example$javascript-udfs/create-scoped-n1ql-reference-function-with-rest.sh[]
----
--

N1QL::
+
--
Execute the `CREATE FUNCTION` in the CBQ Shell to create the reference function:

[source, n1ql]
----
include::example$javascript-udfs/create-scoped-reference-function.n1ql[]
----
--
====

== Further Reading

include::partial$javascript-udfs/further-reading.adoc[tags="user-defined-functions-ui;rest-create-library-call"]

