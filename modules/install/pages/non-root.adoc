= Non-Root Install and Upgrade

[#abstract]
Couchbase Server can be installed on any supported Linux distribution by users who do not have _root_ or _sudo_ privileges.
A non-root server, once installed, can be similarly upgraded.

[#understanding-non-root-installation]
== Understanding Non-Root Installation

Whereas the standard _package-based_ installation of Couchbase Server requires _root_ or _sudo_ privileges on all supported Linux distributions, an alternative, _non-root_ installation can be also performed on all such distributions: this does _not_ require _root_ or _sudo_ privileges.

The procedures for non-root installing, uninstalling, and stopping and starting are:

* Identical across all supported Linux distributions.

* In each case different from the equivalent procedure used for standard, package-based installation.

All _non-root_ procedures are described below.

[#perform-non-root-installation]
== Install

To perform a non-root installation of Couchbase Server on any supported Linux distribution, proceed as follows:

. Download the Couchbase Server RPM, using `wget` or `curl`.

. Download the https://github.com/couchbase/cb-non-package-installer[cb-non-package-installer^] binary; using `wget` or `curl`.
For example:
+
----
wget https://github.com/couchbase/cb-non-package-installer
----

. Make the binary executable.
+
----
chmod u+x ./cb-non-package-installer
----

. Choose &#8212; and if necessary, create &#8212; a directory into which installation will occur.
For example:
+
----
mkdir ./cb-install
----

. Run the `cb-non-package-installer` binary, to install Couchbase Server.
For example:
+
----
 ./cb-non-package-installer --install --install-location ./cb-install \
 --package ./couchbase-server-enterprise-6.6.0-7853-centos7.x86_64.rpm
----
+
Note that the program performs dependency checking, prior to installation.
If installation cannot proceed, due to missing dependencies, the program prints corresponding notifications to the console, and stops running.

. If dependencies have been flagged as missing, restore those dependencies by performing the necessary installations.
Then, run the `cb-non-package-installer` binary again.

When installation is complete, the following notification is displayed:

----
Successfully installed.
----

Couchbase Server can now be started: see immediately below.

[#start-stop-and-get-status]
== Start, Stop, and Get Status

To start, stop, or get status on a non-root Couchbase Server, use the `couchbase-server` command, provided in the `opt/couchbase/bin` directory, under the specified install location.
From an initial working directory, the command's directory might therefore be accessed as follows:

----
cd ./cb-install/opt/couchbase/bin
----

[#start-non-root-couchbase-server]
=== Start

To start a non-root Couchbase Server, enter the following command:

----
./couchbase-server --start
----

This starts a non-root Couchbase Server.

[#get-status-on-non-root-couchbase-server]
=== Get Status

To get status on whether a non-root Couchbase Server is running, enter the following command.

----
./couchbase-server --status
----

If a non-root Couchbase Server is running, the following is displayed:

----
Couchbase Server is running
----

If a non-root Couchbase Server is _not_ running, the following is displayed:

----
Couchbase Server is not running
----

[#stop-non-root-couchbase-server]
=== Stop

To stop a non-root Couchbase Server, enter the following command:

----
./couchbase-server --stop
----

This stops a running, non-root Couchbase Server.
The output might appear as follows:

----
2020-06-30 09:33:03 cb_dist: terminating with reason: shutdown
----

If no non-root Couchbase Server was running, no output is displayed.

[#uninstall-non-root-couchbase-server]
== Uninstall

To uninstall, stop the running non-root Couchbase Server, then remove the directory used as the install location, along with all its contents.
For example:

----
./cb-install/opt/couchbase/bin/couchbase-server --stop
cd ../../../..
rm -rf ./cb-install
----

[#perform-non-root-upgrade]
== Upgrade

To upgrade an existing non-root Couchbase Server,

. Ensure that the previous version of Couchbase Server was _configured_, as well as _installed_ (since the upgrade process will now make use of the directory structure that the previous configuration provided).

. Stop the server.

. Use the `cb-non-package-install` binary again, this time specifying the `--upgrade` flag, instead of the `--install` flag, and specifying the new package to be used for upgrade.
For example:
+
----
./cb-non-root-install --upgrade --install-location ./cb-install \
--package ./couchbase-server-enterprise-6.6.0-7854-centos7.x86_64.rpm
----

During upgrade, the following message may appear:

----
Running cbupgrade this could take some time
----
When upgrade has completed, the following notification is displayed:

----
Upgrade has completed successfully
----
