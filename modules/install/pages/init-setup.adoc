= Initializing the Cluster

[abstract]
Following installation, the Couchbase cluster must be _initialized_.
Multiple methods are available for initializing the cluster, such as using the Couchbase Web Console, Couchbase Command Line Interface (CLI), and Couchbase REST API.

[NOTE]
====
The content on this page assumes that you're using Couchbase Server Enterprise Edition (EE).
For example, it discusses features that are either not available or not supported in Community Edition (CE).
However, most of the information still generally applies to CE.
====

[#initialize-cluster-web-console]
== Initializing the Cluster Using the Couchbase Web Console

[#couchbase-port-access-info]
The Couchbase Web Console is, by default, available on port `8091`.
Therefore, if a Couchbase node can be identified on the network as `server-a`, you can access the Web Console by opening `+http://server-a:8091/+` in a xref:install-browsers.adoc[supported web browser].
Alternatively, you can use an IP address or, if you're working on the node itself, `+http://localhost:8091+`.
If you've chosen to run Couchbase on a port other than `8091`, make sure to connect on that specific port.

Once you've connected, the [.ui]*Welcome* screen appears:

[#welcome]
image::admin/welcome.png[,400,align=left]

From the [.ui]*Welcome* screen, you have the option to either set up a new cluster, or join the node to an existing cluster.
Information about joining an existing cluster is provided below, in the section <<Join an Existing Cluster>>.
To set up a new cluster, click btn:[Setup New Cluster].

[#set-up-a-new-cluster]
=== Set Up a New Cluster

The [.ui]*New Cluster* screen now appears:

[#set_up_new_cluster_01]
image::admin/setUpNewCluster01.png[,400,align=left]

The following fields are displayed:

* [.ui]*Cluster Name*: Enter a name for the cluster that is being created.

* [.ui]*Create Admin Username*: Enter a username for the first user account; the default username `Administrator` is provided.
+
This account is a xref:security:security-rbac-for-admins-and-apps.adoc:[Full Administrator] and has read-write access to all Couchbase Server resources; including the ability to create new users with defined roles and corresponding privileges.
+
Usernames cannot be more than 128 UTF-8 characters in length, and cannot contain the following characters: `( ) < > @ , ; : \ " / [ ]  ? = { }`.
Usernames that are 64 UTF-8 characters or less are ideal, as it ensures successful onscreen display in the various user interfaces.

* [.ui]*Create Password*: Enter a password for the new user account.
+
The default password policy only requires that the password be at least six characters in length.
+
[TIP]
====
Following cluster-initialization, you can modify (and indeed strengthen) the default password-policy with the `setting-password-policy` command in the Couchbase CLI.
====

Once you've filled out each field, click btn:[Next: Accept Terms].

=== Accept Terms

The [.ui]*New Cluster* screen now presents the [.ui]*Terms and Conditions*:

[#ts_and_cs_01]
image::admin/TsAndCs01.png[,400,align=left]

Read the terms and conditions.
If you accept them, check the [.ui]*I accept the terms & conditions* checkbox.

You now have two options for proceeding:

* btn:[Finish With Defaults]: Clicking this button initializes the cluster using the default settings provided by Couchbase.
+
This option is best if you're just trying out the basic features and functionality of Couchbase Server.
+
The initialization is complete once the [.ui]*Dashboard* screen appears.

* btn:[Configure Disk, Memory, Services]: Click this button to customize the cluster configuration according to your needs.
+
This guide assumes that you select this option.

[#configure-couchbase-server]
=== Configure Couchbase Server

The [.ui]*Configure* screen now appears:

[#configure_new_cluster_01]
image::admin/configureNewCluster01.png[,400,align=left]

The following fields are displayed:

* [.ui]*Host Name / IP Address*: Enter the hostname or IP address for the node on which you're configuring Couchbase Server.

* [.ui]*Data Disk Path*: Enter the location on the current node where you want the database files to be stored; an OS-specific default is provided.

* [.ui]*Indexes Disk Path*: Enter the location on the current node where you want the indexes to be stored; an OS-specific default is provided.
+
[NOTE]
====
For production environments, it is recommended that database files and indexes _not_ share the same location.
====

* [.ui]*Analytics Disk Paths*: Enter the location on the current node where you want Analytics data to be stored; an OS-specific default is provided.
+
You can enter more than one location to store Analytics data.
Click btn:[+] to specify an additional location for Analytics data, or click btn:[-] to remove a location.

* [.ui]*Java Runtime Path*: If desired, enter the location for an alternate Java Runtime Environment (JRE) on the current node that you want to use for the Analytics Service.
+
Couchbase Server is supplied with the Oracle Java 8 JRE.
If you don't specify a location for an alternate JRE, the supplied JRE is used by default.

* [.ui]*Service Memory Quotas*: Select the Couchbase xref:understanding-couchbase:services-and-indexes:services:services.adoc[services] that you want enabled on the current node, and specify how much memory should be allocated to each of those services.
+
Each service can be selected by checking the appropriate checkbox, and then specifying the amount of memory, in megabytes, to be assigned to each service.
In each case, a default memory quota is suggested, and a minimum quota is required.
+
For production systems, it is recommended that only _one_ service ever be allocated per node. Refer to the Couchbase Server xref:install:sizing-general.adoc[sizing guidelines] for help with determining appropriate service and memory allocation.
+
[NOTE]
====
The memory allocations that you specify for the current node will also be used for each subsequent node that you add to the cluster.
====

 ** [.ui]*Data*: Selection and RAM-allocation to support the Couchbase Data Service.
+
Since you're starting a new cluster, the Data Service (which is essential for the cluster) is automatically selected and its checkbox is disabled.

 ** [.ui]*Index*: Selection and RAM-allocation to support Global Secondary Indexes (GSIs).
+
This should be 256 MB or more.

 ** [.ui]*Search*: Selection and RAM-allocation to support Full Text Search.
+
This should be 256 MB or more.

 ** [.ui]*Query*: Selection to support the querying of data by means of the N1QL query language.
+
No RAM-allocation is required for this service.

 ** [.ui]*Eventing*: Selection and RAM-allocation to support the Eventing Service.
+
The memory quota should be 256 MB or more.

 ** [.ui]*Analytics*: Selection and RAM-allocation to support the Analytics Service.
+
The memory quota should be 1024 MB or more.

+
The sum of all of the memory allocations is displayed as the [.ui]*TOTAL QUOTA*. This number must be less than the displayed [.ui]*Max Allowed Quota*.

* [.ui]*Index Storage Setting*: Select either [.ui]*Standard Global Secondary* or [.ui]*Memory-Optimized*.
+
This setting is only configurable if you previously selected [.ui]*Index*.
See xref:understanding-couchbase:services-and-indexes/indexes/global-secondary-indexes.adoc[Global Secondary Indexes], for details.

* [.ui]*Enable software update notifications in the web console*: Check this checkbox to allow notifications in the Couchbase Web Console when a new version of Couchbase Server is available.
+
Configuration information transferred in the update check is anonymous and doesn't include any stored key-value data.

Once you've finished entering all of your configuration details, click btn:[Save & Finish].

The initialization is complete once the [.ui]*Dashboard* screen appears:

[#dashboard_01]
image::admin/dashboard01.png[,820,align=left]

=== New-Cluster Set-Up: Next Steps

If this is the first server in the cluster, a notification appears, stating that no buckets are currently defined.
A _bucket_ is the principal unit of data-storage used by Couchbase Server.
In order to save and subsequently access documents and other objects, you must create one or more buckets.

As specified by the notification, you can go to *Buckets*, and begin bucket-creation; or add a *sample bucket*: left-click on the links provided.
A description of how to create, edit, flush, and delete buckets can be found in the section xref:clustersetup:bucket-setup.adoc[Setting Up Buckets].
An architectural description of buckets can be found in the section xref:understanding-couchbase:buckets-memory-and-storage/buckets.adoc[Buckets].
(There are three different kinds of bucket, so you may wish to familiarize yourself with their properties, before you start bucket-creation.) Note that _sample_ buckets already contain data, and so are ready for your immediate experimentation and testing.

The buckets that you create must be accessed securely: therefore, Couchbase Server provides a system of _Role-Based Access Control_ (RBAC), which must be used by administrators and applications that wish to access buckets.
Each administrator and application is considered to be a _user_, and must perform bucket-access by passing a username and password.
For information on how to set up RBAC users so that they can access the buckets you create, see xref:security:security-authorization.adoc[Authorization].

[#join-an-existing-cluster]
=== Join an Existing Cluster

If, while the [.ui]*Welcome Screen* is still displayed, you left-click on [.ui]*Join Existing Cluster*, the [.ui]*Join Cluster* screen appears:

[#join_cluster_initial]
image::admin/joinClusterInitial.png[,390,align=left]

The interactive fields [.ui]*Cluster Host Name/IP Address*, [.ui]*Cluster Admin Username*, and [.ui]*Cluster Admin Password* require you to enter information already defined by the Full Administrator for the cluster-host: see <<Set Up a New Cluster>>, above.

When you have entered the appropriate details, you can left-click on the btn:[Join With Default Configuration] button, at the lower right, in order to join the cluster using a default configuration.
Note that the default configuration is not recommended for production environments.
To change the default configuration, or to review its details, left-click on the right-pointing arrowhead adjacent to the [.ui]*Configure Services & Settings For This Node* notice.

The screen now expands vertically, as shown below:

[#join_with_default_config]
image::admin/joinWithDefaultConfig.png[,390,align=left]

Newly displayed fields show default values for the Couchbase services (a checked box indicating that the corresponding service will be added to this node), the [.ui]*Host Name/IP Address* for the current node, and default paths for [.ui]*Data*, [.ui]*Indexes*, and [.ui]*Analytics*.
Specify hostname or IP address, services and data paths as described above, in <<Set Up a New Cluster>>.

Note that the checkboxes for the services are not accompanied by fields whereby memory quotas might be specified: this is because such quotas are expected already to have been specified by the Full Administrator (for example, during configuration of the principal cluster-host).
However, in some circumstances, node-addition may require addition of a service not previously configured: in which case memory-quota specification is indeed required, and will be prompted for.

If you make any changes to the services and settings for this node, the button at the lower right is renamed:

[#join_with_custom_configuration_button]
image::admin/joinWithCustomConfigurationButton.png[,240,align=left]

Left-click on this button, to save the configurations you have specified.

If you have specified services for this node that were not previously defined for this cluster, the [.ui]*New Service Settings* dialog now appears:

[#join_existing_new_service_settings]
image::admin/joinExistingNewServiceSettings.png[,390,align=left]

This dialog acknowledges that new services have been added to the cluster for the first time, and provides the opportunity to edit the services now featured.
If you are adding the Index service to the cluster for the first time, you may also make a selection for the [.ui]*Index Storage Setting*.
All modifications you now make are applied to each node in the cluster.

When you have made the appropriate changes, left-click on the btn:[Save Settings] button.
The Couchbase Web Console [.ui]*Dashboard* for the current node now appears â€” with a notification confirming the successful saving of a new memory quota:

[#join_cluster_memory_quota_saved]
image::admin/joinClusterMemoryQuotaSaved.png[,720,align=left]

The new node has now been successfully added to the existing cluster.

[#initialize-cluster-cli]
== Initializing the Cluster Using the CLI

Rather than using the Couchbase Web Console, you may elect to initialize your Couchbase cluster by means of the Couchbase CLI (_Command Line Interface_).

The following CLI syntax can be used for initial set-up of a single-node Couchbase Server-cluster.
It allows the establishing of administrative credentials, and of port number.
It adds all services; sets separate RAM quotas for Data, Index, Search, Eventing, and Analytics services, and sets the index storage-option (the default being to support memory-optimized global indexes):

[source,bash]
----
couchbase-cli cluster-init OPTIONS:
  --cluster-username=USER                     // new admin username
  --cluster-password=PASSWORD                 // new admin password
  --cluster-port=PORT                         // new cluster REST/http port
  --services=data,index,query,fts,analytics   // services that server runs
  --cluster-ramsize=RAMSIZEMB           // per node data service ram quota in MB
  --cluster-index-ramsize=RAMSIZEMB     // per node index service ram quota in MB
  --cluster-fts-ramsize=RAMSIZEMB       // per node fts service ram quota in MB
  --cluster-eventing-ramsize=RAMSIZEMB  // per node eventing ram quota in MB
  --cluster-analytics-ramsize=RAMSIZEMB // per node analytics ram quota in MB
  --index-storage-setting=SETTING       // index storage type [default, memopt]
----

[#initialize-cluster-rest]
== Initializing the Cluster Using the REST API

The third option for performing Couchbase cluster-initialization is provided by the Couchbase REST API.

The following REST API examples are used to set up a single-node Couchbase Server cluster with three services, administrative credentials, and a RAM quota:

*Syntax:*

Set up services:

[source,bash]
----
curl -u [admin-name]:[password] -v
  -X POST http://[localhost]:8091/node/controller/setupServices
  -d services=[kv | index | n1ql | fts]
----

Initialize a node:

[source,bash]
----
curl -v
  -X POST http://[localhost]:8091/nodes/self/controller/settings
  -d path=[location] -d index_path=[location] -d cbas_path=[location]
----

Set up your administrator-username and password:

[source,bash]
----
curl -v -X POST http://[localhost]:8091/settings/web
  -d password=[password]
  -d username=[admin-name]
  -d port=[desired-rest-api-port|SAME]
----

Set up the index RAM quota (to be applied across the entire cluster):

[source,bash]
----
curl -u username=[admin-name]&password=[password]
  -X POST http://[localhost]:8091/pools/default
  -d memoryQuota=[value] -d indexMemoryQuota=[value]
----

*Examples:*

[source,bash]
----
// Set up services. (Note that %2C is the ASCII Hex mapping to the comma character.)

curl -u Administrator:password -v -X POST http://192.168.42.101:8091/node/controller/setupServices \
-d 'services=kv%2Cn1ql%2Cindex%2Cfts'
----

[source,bash]
----
// Initialize a node. (Note that %2F is the ASCII Hex mapping to the forward-slash
// character.)

curl -v -X POST http://192.168.42.101:8091/nodes/self/controller/settings \
-d 'path=%2Fopt%2Fcouchbase%2Fvar%2Flib%2Fcouchbase%2Fdata&index_path= \
%2Fopt%2Fcouchbase%2Fvar%2Flib%2Fcouchbase%2Fdata'
----

[source,bash]
----
// Set up your administrator-username and password.

curl -v -X POST http://192.168.42.101:8091/settings/web \
-d 'password=password&username=Administrator&port=SAME'
----

[source,bash]
----
// Set up the index RAM quota (to be applied across the entire cluster).

curl -u Administrator:password -X POST  http://127.0.0.1:8091/pools/default \
-d 'memoryQuota=5000' -d 'indexMemoryQuota=269'
----
