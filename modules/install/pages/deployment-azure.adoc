= Azure Marketplace

[abstract]
Make sure that you have the prerequisites for installing Microsoft Azure.

Use the pre-installation checklist to ensure that you have all requirements:

Minimum hardware recommendations::
* 2 cores and 4 GB for development.
* 4 cores and 16 GB for production.
* For development workloads, choose instance types: D2, D11, A3, A5 or larger.
* For production workloads, choose instance types: D3, D12 or A6 or larger.

Configuration of the Azure network::
* Note that a virtual network is the most efficient way.
* Configure a Virtual Network for nodes and applications per DC/Region.
* Set up Vnet-to-Vnet connection between DCs/Regions.
* Note that PrivateIPs are faster to route than public IPs.

Configuration of Availability Sets and Server Groups for full protection::
* Ensure Protection against upgrades and rack failures.
* Configure availability set per VNet.
* Ensure that all nodes are in the same availability set.
* Ensure that all nodes are in separate groups in the Couchbase Server cluster.

Configuration of Couchbase Server::
* Use static IPs with nodes.
* Set `AzureStaticVNetIP` in Powershell or check the box in the new portal.
* Use a PrivateIP for server communication.
* Register the node PrivateIPs (ex: 10.0.x.x) with the Couchbase Web Console.
* Enable remote administration.
* Use a jump box for the front admin access, or open 18901 for the encrypted admin access (only with Couchbase Server 3.0).
* Map externally to another random port for security.
* ACL the #18091 endpoint.
* Couchbase Web Console and CLI use #18091, which is SSL encrypted.
* ACL #18091 for added security.
No need to open any other port
* Encrypt cross DC/Region traffic with SSL.

Configuration of the Couchbase Server application::
* Ensure that applications are deployed to the same Vnet.
* Use privateIPs (10.0.x.x) for websites, VM applications or cloud services.
 ** SSL based client-server communications
 ** SSL based view access: \https://couchbase_server:18092/…

Configuration of storage::
* Mount data disks and stripe across with RAID 0.
* Do not use ephemeral drive, which will be reset under node restart.
* Do not use OS drive  because it is limited in size.
* Do not use ReadWrite caching for Couchbase Server data drives, since it writes through to Azure Storage.

== Install Azure with the Wizard

To deploy Couchbase Server on Microsoft Azure, follow these steps:

. Log into your account for the Azure Management portal `manage.windowsazure.com` and select [.ui]*Virtual Machines* in the left menu.
+
image::deploy-azure01.png[,570]

. Create a new virtual machine by pressing the [.in]`+` (plus) symbol in the lower left corner:
. Follow the wizard to create a virtual machine From Gallery that was pre-installed with Windows Server 2012 R2 Datacenter.
. In the second part of the virtual machine configuration, wizard fills in the `Virtual Machine Name`.
This is the display name that will be used by Windows Azure inside the Portal.
. Choose username and password.
They are used for  Remote Desktop to the VM, which is important since you need to install Couchbase Server on the VM using Remote Desktop.
+
image::deploy-azure02.png[,570]

. Pick up the VM machine size (A1 through G5).
. In the third part of the configuration wizard, we need to pick a DNS name and Region and leave all other options unchanged Region: To lower network latency chose an area close to your location.
DNS: Please note that the DNS name needs to be unique for all Azure instances.
. In the fourth and last step, leave all settings and their defaults and select done/checkmark.
+
image::deploy-azure03.png[,570]
+
The moment the wizard is complete Azure begins the process to start the new VM: Loading, Provisioning, Start, Running.
+
image::deploy-azure04.png[,570]

. Press "Connect" in the lower left in the Dashboard tab for the newly created WM.
This will start a download of a preconfigured Remote Desktop file.
Open the file and follow the steps in "Remote Desktop" to log in to the VM.
+
image::deploy-azure05.png[,570]

. Before installing Couchbase Server, perform the following basic setup steps.
Disable [.ui]*Enhanced IE Security* and in [.ui]*Firewall Settings* make sure that the required ports are open so that the client can connect to the node.
Verify the list of ports.
+
image::deploy-azure06.png[,570]
+
image::deploy-azure07.png[,570]

. Open MS Internet Explorer and navigate to the  http://www.couchbase.com/nosql-databases/downloads[Couchbase download site^].
. Download the 64 bit Windows installer and when the download is complete start the installation.
. Open the file [.path]_C:\Windows\System32\drivers\etc\hosts_ and add a line to map the VM’s `Private IP` to `Public DNS Name`.
For Example: `100.117.124.100 cb4.cloudapp.net`
. Open the Couchbase Web Console and in the hostname field insert your DNS name followed by [.in]`.cloudapp.net.` Click [.ui]*Next*.
For example:
+
----
cb4.cloudapp.net
----

. If you would like to install sample data, do so now or later.
From here on, follow the xref:install:init-setup.adoc[cluster initialization] instructions.
. In the next setup screen, enter the `Per Node RAM Quota` and check other options as you need for your application needs.
Click [.ui]*Next*.
. In the [.ui]*Notifications* tab, fill in the required fields.
. In the last configuration window, set the Administrator password.

== Deploy a Multi-Node Cluster with ARM

With the new Azure Resource Manager (ARM), you can deploy a multi-node Couchbase Server cluster to Azure cloud.

Deploying a multi-node Couchbase Server cluster for the first time on many of the public cloud platforms could require a long array of operations that must be followed carefully.

With the new Azure Resource Manager (ARM), you can deploy a multi-node Couchbase Server cluster with a simple but powerful template.

http://www.fullscale180.com/[Full Scale 180^] worked with Microsoft to develop some of the templates for deploying close to real life examples of common solutions in the market.
Those templates can be found at https://github.com/azure/azure-quickstart-templates/[github.com^].

The https://github.com/Azure/azure-quickstart-templates/tree/master/couchbase-on-ubuntu[Couchbase Server cluster template^] is one of the templates.
It allows Azure users to deploy clusters, using different VM sizes, implementing Azure and Couchbase Server best practices.
